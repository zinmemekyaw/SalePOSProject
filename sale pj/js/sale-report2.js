!function(){Raygun.init("NTYcR74HqQRGAbW/L3gZHQ==",{excludedHostnames:[".works"],ignore3rdPartyErrors:!0}).attach(),angular.module("reports.controllers",[]),angular.module("reports.components",[]),angular.module("reports.directives",[]),angular.module("reports.factories",[]),angular.module("reports.filters",[]),angular.module("reports.services",[]),angular.module("reports",["reports.controllers","reports.components","reports.directives","reports.factories","reports.filters","reports.services","ui.router","ngSanitize","ngResource","LocalStorageModule","vend.js","vend.ui","navi","angularModalService","vendCurrencyFilter","mm.foundation.modal","mm.foundation.topbar","mm.foundation.tooltip","template/modal/backdrop.html","template/modal/window.html","template/topbar/has-dropdown.html","template/topbar/toggle-top-bar.html","template/topbar/top-bar-dropdown.html","template/topbar/top-bar-section.html","template/topbar/top-bar.html","template/tooltip/tooltip-popup.html"]).run(["$rootScope",function(e){return Raygun.withCustomData(function(){return{context:e.context,permissions:e.permissions,user:e.user,retailer:e.retailer}}),moment.updateLocale("en",{week:{dow:1}}),e.$on("$stateChangeError",function(e,t,r,n,a,i){throw i})}]).config(["$provide",function(e){return e.decorator("$exceptionHandler",["$delegate",function(e){return function(t,r){return Raygun.send(t),e(t,r)}}])}]);angular.module("reports").config(["$stateProvider","$urlRouterProvider","$locationProvider",function(e,t,r){var n;r.html5Mode(!0);var a=document.head.getElementsByTagName("base");n=0===a.length?"":a[0].href;var i=function(e){return"".concat(n).concat(e)},o=function(e){return e};o.$inject=["BootstrapService"];var s=function(e){return e};s.$inject=["ReportDefinitionsService"];var l=function(e){return e};l.$inject=["AggregateDefinitionsService"];var c=function(e){return e};c.$inject=["GranularityDefinitionsService"];var u=function(e){return e.retrieveGiftCardStatus()};u.$inject=["GiftCardStatusService"];var d=function(e,t,r){r.canViewDashboard()||t.go("reports.show")};d.$inject=["bootstrap","$state","PermissionsService"],e.state("dashboard",{url:"/",templateUrl:i("partials/dashboard.html"),controller:"DashboardCtrl",resolve:{bootstrap:o,granularities:c,permissions:d,giftCardStatus:u,granularityDateSelection:["GranularityDateSelection","granularities",function(e,t){return new e({selectedDate:new Date,granularity:t.findByKey("day"),periodType:"current_granularity",restrictFutureEndDate:"day"})}],liveUpdate:function(){return{timeout:null,timeoutQueued:!1}}},onExit:["$timeout","liveUpdate",function(e,t){e.cancel(t.timeout)}]}).state("giftcards",{url:"/gift_cards",templateUrl:"partials/gift_cards.html",controller:"GiftCardsCtrl",controllerAs:"giftCardsCtrl",resolve:{bootstrap:o}}).state("product_movements",{url:"/product_movements/:productId?startDate&endDate&event&outlet",templateUrl:"partials/product_movements.html",controller:"ProductMovementsCtrl",controllerAs:"$ctrl",resolve:{bootstrap:o,product:["apiResource","$stateParams",function(e,t){return e.get("products",t.productId)}],outlets:["apiResource",function(e){return e.get("outlets",null,{page_size:1e3})}]}}).state("storecredit",{url:"/store_credit",templateUrl:"partials/store_credit.html",controller:"StoreCreditCtrl",controllerAs:"storeCreditCtrl",resolve:{bootstrap:o}}).state("reports",{abstract:!0,templateUrl:i("partials/reports.html")}).state("reports.show",{url:"/:slug?definition",views:{controls:{templateUrl:i("partials/report_controls.html"),controller:"ReportControlsCtrl"},datatable:{templateUrl:i("partials/report_datatable.html"),controller:"ReportDatatableCtrl"}},resolve:{bootstrap:o,reports:s,metrics:l,granularities:c,giftCardStatus:u,datatableDefinition:["$stateParams","bootstrap","ReportRouteService",function(e,t,r){return r.fromRouteParams(e)}]}}),t.otherwise("/")}]);var e=function(){this.__data__=[],this.size=0};var t=function(e,t){return e===t||e!=e&&t!=t};var r=function(e,r){for(var n=e.length;n--;)if(t(e[n][0],r))return n;return-1},n=Array.prototype.splice;var a=function(e){var t=this.__data__,a=r(t,e);return!(a<0||(a==t.length-1?t.pop():n.call(t,a,1),--this.size,0))};var i=function(e){var t=this.__data__,n=r(t,e);return n<0?void 0:t[n][1]};var o=function(e){return r(this.__data__,e)>-1};var s=function(e,t){var n=this.__data__,a=r(n,e);return a<0?(++this.size,n.push([e,t])):n[a][1]=t,this};function l(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}l.prototype.clear=e,l.prototype.delete=a,l.prototype.get=i,l.prototype.has=o,l.prototype.set=s;var c=l;var u=function(){this.__data__=new c,this.size=0};var d=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r};var f=function(e){return this.__data__.get(e)};var p=function(e){return this.__data__.has(e)},v={};(function(e){var t="object"==typeof e&&e&&e.Object===Object&&e;v=t}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var g="object"==typeof self&&self&&self.Object===Object&&self,h=v||g||Function("return this")(),m=h.Symbol,y=Object.prototype,b=y.hasOwnProperty,w=y.toString,D=m?m.toStringTag:void 0;var _=function(e){var t=b.call(e,D),r=e[D];try{e[D]=void 0;var n=!0}catch(i){}var a=w.call(e);return n&&(t?e[D]=r:delete e[D]),a},C=Object.prototype.toString;var S=function(e){return C.call(e)},k="[object Null]",R="[object Undefined]",T=m?m.toStringTag:void 0;var x=function(e){return null==e?void 0===e?R:k:T&&T in Object(e)?_(e):S(e)};var M=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)},O="[object AsyncFunction]",A="[object Function]",P="[object GeneratorFunction]",E="[object Proxy]";var j,F=function(e){if(!M(e))return!1;var t=x(e);return t==A||t==P||t==O||t==E},I=h["__core-js_shared__"],G=(j=/[^.]+$/.exec(I&&I.keys&&I.keys.IE_PROTO||""))?"Symbol(src)_1."+j:"";var B=function(e){return!!G&&G in e},N=Function.prototype.toString;var V=function(e){if(null!=e){try{return N.call(e)}catch(t){}try{return e+""}catch(t){}}return""},L=/^\[object .+?Constructor\]$/,U=Function.prototype,q=Object.prototype,K=U.toString,z=q.hasOwnProperty,Y=RegExp("^"+K.call(z).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var H=function(e){return!(!M(e)||B(e))&&(F(e)?Y:L).test(V(e))};var W=function(e,t){return null==e?void 0:e[t]};var Q=function(e,t){var r=W(e,t);return H(r)?r:void 0},X=Q(h,"Map"),Z=Q(Object,"create");var J=function(){this.__data__=Z?Z(null):{},this.size=0};var ee=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},te="__lodash_hash_undefined__",re=Object.prototype.hasOwnProperty;var ne=function(e){var t=this.__data__;if(Z){var r=t[e];return r===te?void 0:r}return re.call(t,e)?t[e]:void 0},ae=Object.prototype.hasOwnProperty;var ie=function(e){var t=this.__data__;return Z?void 0!==t[e]:ae.call(t,e)},oe="__lodash_hash_undefined__";var se=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=Z&&void 0===t?oe:t,this};function le(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}le.prototype.clear=J,le.prototype.delete=ee,le.prototype.get=ne,le.prototype.has=ie,le.prototype.set=se;var ce=le;var ue=function(){this.size=0,this.__data__={hash:new ce,map:new(X||c),string:new ce}};var de=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};var fe=function(e,t){var r=e.__data__;return de(t)?r["string"==typeof t?"string":"hash"]:r.map};var pe=function(e){var t=fe(this,e).delete(e);return this.size-=t?1:0,t};var ve=function(e){return fe(this,e).get(e)};var ge=function(e){return fe(this,e).has(e)};var he=function(e,t){var r=fe(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this};function me(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}me.prototype.clear=ue,me.prototype.delete=pe,me.prototype.get=ve,me.prototype.has=ge,me.prototype.set=he;var ye=me,be=200;var we=function(e,t){var r=this.__data__;if(r instanceof c){var n=r.__data__;if(!X||n.length<be-1)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new ye(n)}return r.set(e,t),this.size=r.size,this};function De(e){var t=this.__data__=new c(e);this.size=t.size}De.prototype.clear=u,De.prototype.delete=d,De.prototype.get=f,De.prototype.has=p,De.prototype.set=we;var _e=De,Ce="__lodash_hash_undefined__";var Se=function(e){return this.__data__.set(e,Ce),this};var ke=function(e){return this.__data__.has(e)};function Re(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new ye;++t<r;)this.add(e[t])}Re.prototype.add=Re.prototype.push=Se,Re.prototype.has=ke;var Te=Re;var xe=function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1};var Me=function(e,t){return e.has(t)},Oe=1,Ae=2;var Pe=function(e,t,r,n,a,i){var o=r&Oe,s=e.length,l=t.length;if(s!=l&&!(o&&l>s))return!1;var c=i.get(e);if(c&&i.get(t))return c==t;var u=-1,d=!0,f=r&Ae?new Te:void 0;for(i.set(e,t),i.set(t,e);++u<s;){var p=e[u],v=t[u];if(n)var g=o?n(v,p,u,t,e,i):n(p,v,u,e,t,i);if(void 0!==g){if(g)continue;d=!1;break}if(f){if(!xe(t,function(e,t){if(!Me(f,t)&&(p===e||a(p,e,r,n,i)))return f.push(t)})){d=!1;break}}else if(p!==v&&!a(p,v,r,n,i)){d=!1;break}}return i.delete(e),i.delete(t),d},Ee=h.Uint8Array;var $e=function(e){var t=-1,r=Array(e.size);return e.forEach(function(e,n){r[++t]=[n,e]}),r};var je=function(e){var t=-1,r=Array(e.size);return e.forEach(function(e){r[++t]=e}),r},Fe=1,Ie=2,Ge="[object Boolean]",Be="[object Date]",Ne="[object Error]",Ve="[object Map]",Le="[object Number]",Ue="[object RegExp]",qe="[object Set]",Ke="[object String]",ze="[object Symbol]",Ye="[object ArrayBuffer]",He="[object DataView]",We=m?m.prototype:void 0,Qe=We?We.valueOf:void 0;var Xe=function(e,r,n,a,i,o,s){switch(n){case He:if(e.byteLength!=r.byteLength||e.byteOffset!=r.byteOffset)return!1;e=e.buffer,r=r.buffer;case Ye:return!(e.byteLength!=r.byteLength||!o(new Ee(e),new Ee(r)));case Ge:case Be:case Le:return t(+e,+r);case Ne:return e.name==r.name&&e.message==r.message;case Ue:case Ke:return e==r+"";case Ve:var l=$e;case qe:var c=a&Fe;if(l||(l=je),e.size!=r.size&&!c)return!1;var u=s.get(e);if(u)return u==r;a|=Ie,s.set(e,r);var d=Pe(l(e),l(r),a,i,o,s);return s.delete(e),d;case ze:if(Qe)return Qe.call(e)==Qe.call(r)}return!1};var Ze=function(e,t){for(var r=-1,n=t.length,a=e.length;++r<n;)e[a+r]=t[r];return e},Je=Array.isArray;var et=function(e,t,r){var n=t(e);return Je(e)?n:Ze(n,r(e))};var tt=function(e,t){for(var r=-1,n=null==e?0:e.length,a=0,i=[];++r<n;){var o=e[r];t(o,r,e)&&(i[a++]=o)}return i};var rt=function(){return[]},nt=Object.prototype.propertyIsEnumerable,at=Object.getOwnPropertySymbols,it=at?function(e){return null==e?[]:(e=Object(e),tt(at(e),function(t){return nt.call(e,t)}))}:rt;var ot=function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n};var st=function(e){return null!=e&&"object"==typeof e},lt="[object Arguments]";var ct=function(e){return st(e)&&x(e)==lt},ut=Object.prototype,dt=ut.hasOwnProperty,ft=ut.propertyIsEnumerable,pt=ct(function(){return arguments}())?ct:function(e){return st(e)&&dt.call(e,"callee")&&!ft.call(e,"callee")};var vt=function(){return!1},gt={exports:{}},ht="object"==typeof gt.exports&&gt.exports&&!gt.exports.nodeType&&gt.exports,mt=ht&&gt&&!gt.nodeType&&gt,yt=mt&&mt.exports===ht?h.Buffer:void 0,bt=(yt?yt.isBuffer:void 0)||vt;gt.exports=bt,gt=gt.exports;var wt=9007199254740991,Dt=/^(?:0|[1-9]\d*)$/;var _t=function(e,t){var r=typeof e;return!!(t=null==t?wt:t)&&("number"==r||"symbol"!=r&&Dt.test(e))&&e>-1&&e%1==0&&e<t},Ct=9007199254740991;var St=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=Ct},kt={};kt["[object Float32Array]"]=kt["[object Float64Array]"]=kt["[object Int8Array]"]=kt["[object Int16Array]"]=kt["[object Int32Array]"]=kt["[object Uint8Array]"]=kt["[object Uint8ClampedArray]"]=kt["[object Uint16Array]"]=kt["[object Uint32Array]"]=!0,kt["[object Arguments]"]=kt["[object Array]"]=kt["[object ArrayBuffer]"]=kt["[object Boolean]"]=kt["[object DataView]"]=kt["[object Date]"]=kt["[object Error]"]=kt["[object Function]"]=kt["[object Map]"]=kt["[object Number]"]=kt["[object Object]"]=kt["[object RegExp]"]=kt["[object Set]"]=kt["[object String]"]=kt["[object WeakMap]"]=!1;var Rt=function(e){return st(e)&&St(e.length)&&!!kt[x(e)]};var Tt=function(e){return function(t){return e(t)}},xt={exports:{}},Mt="object"==typeof xt.exports&&xt.exports&&!xt.exports.nodeType&&xt.exports,Ot=Mt&&xt&&!xt.nodeType&&xt,At=Ot&&Ot.exports===Mt&&v.process,Pt=function(){try{var e=Ot&&Ot.require&&Ot.require("util").types;return e||At&&At.binding&&At.binding("util")}catch(t){}}();xt.exports=Pt;var Et=(xt=xt.exports)&&xt.isTypedArray,$t=Et?Tt(Et):Rt,jt=Object.prototype.hasOwnProperty;var Ft=function(e,t){var r=Je(e),n=!r&&pt(e),a=!r&&!n&&gt(e),i=!r&&!n&&!a&&$t(e),o=r||n||a||i,s=o?ot(e.length,String):[],l=s.length;for(var c in e)!t&&!jt.call(e,c)||o&&("length"==c||a&&("offset"==c||"parent"==c)||i&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||_t(c,l))||s.push(c);return s},It=Object.prototype;var Gt=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||It)};var Bt=function(e,t){return function(r){return e(t(r))}},Nt=Bt(Object.keys,Object),Vt=Object.prototype.hasOwnProperty;var Lt=function(e){if(!Gt(e))return Nt(e);var t=[];for(var r in Object(e))Vt.call(e,r)&&"constructor"!=r&&t.push(r);return t};var Ut=function(e){return null!=e&&St(e.length)&&!F(e)};var qt=function(e){return Ut(e)?Ft(e):Lt(e)};var Kt=function(e){return et(e,qt,it)},zt=1,Yt=Object.prototype.hasOwnProperty;var Ht=function(e,t,r,n,a,i){var o=r&zt,s=Kt(e),l=s.length;if(l!=Kt(t).length&&!o)return!1;for(var c=l;c--;){var u=s[c];if(!(o?u in t:Yt.call(t,u)))return!1}var d=i.get(e);if(d&&i.get(t))return d==t;var f=!0;i.set(e,t),i.set(t,e);for(var p=o;++c<l;){var v=e[u=s[c]],g=t[u];if(n)var h=o?n(g,v,u,t,e,i):n(v,g,u,e,t,i);if(!(void 0===h?v===g||a(v,g,r,n,i):h)){f=!1;break}p||(p="constructor"==u)}if(f&&!p){var m=e.constructor,y=t.constructor;m!=y&&"constructor"in e&&"constructor"in t&&!("function"==typeof m&&m instanceof m&&"function"==typeof y&&y instanceof y)&&(f=!1)}return i.delete(e),i.delete(t),f},Wt=Q(h,"DataView"),Qt=Q(h,"Promise"),Xt=Q(h,"Set"),Zt=Q(h,"WeakMap"),Jt=V(Wt),er=V(X),tr=V(Qt),rr=V(Xt),nr=V(Zt),ar=x;(Wt&&"[object DataView]"!=ar(new Wt(new ArrayBuffer(1)))||X&&"[object Map]"!=ar(new X)||Qt&&"[object Promise]"!=ar(Qt.resolve())||Xt&&"[object Set]"!=ar(new Xt)||Zt&&"[object WeakMap]"!=ar(new Zt))&&(ar=function(e){var t=x(e),r="[object Object]"==t?e.constructor:void 0,n=r?V(r):"";if(n)switch(n){case Jt:return"[object DataView]";case er:return"[object Map]";case tr:return"[object Promise]";case rr:return"[object Set]";case nr:return"[object WeakMap]"}return t});var ir=ar,or=1,sr="[object Arguments]",lr="[object Array]",cr="[object Object]",ur=Object.prototype.hasOwnProperty;var dr=function(e,t,r,n,a,i){var o=Je(e),s=Je(t),l=o?lr:ir(e),c=s?lr:ir(t),u=(l=l==sr?cr:l)==cr,d=(c=c==sr?cr:c)==cr,f=l==c;if(f&&gt(e)){if(!gt(t))return!1;o=!0,u=!1}if(f&&!u)return i||(i=new _e),o||$t(e)?Pe(e,t,r,n,a,i):Xe(e,t,l,r,n,a,i);if(!(r&or)){var p=u&&ur.call(e,"__wrapped__"),v=d&&ur.call(t,"__wrapped__");if(p||v){var g=p?e.value():e,h=v?t.value():t;return i||(i=new _e),a(g,h,r,n,i)}}return!!f&&(i||(i=new _e),Ht(e,t,r,n,a,i))};var fr=function e(t,r,n,a,i){return t===r||(null==t||null==r||!st(t)&&!st(r)?t!=t&&r!=r:dr(t,r,n,a,e,i))},pr=1,vr=2;var gr=function(e,t,r,n){var a=r.length,i=a,o=!n;if(null==e)return!i;for(e=Object(e);a--;){var s=r[a];if(o&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}for(;++a<i;){var l=(s=r[a])[0],c=e[l],u=s[1];if(o&&s[2]){if(void 0===c&&!(l in e))return!1}else{var d=new _e;if(n)var f=n(c,u,l,e,t,d);if(!(void 0===f?fr(u,c,pr|vr,n,d):f))return!1}}return!0};var hr=function(e){return e==e&&!M(e)};var mr=function(e){for(var t=qt(e),r=t.length;r--;){var n=t[r],a=e[n];t[r]=[n,a,hr(a)]}return t};var yr=function(e,t){return function(r){return null!=r&&r[e]===t&&(void 0!==t||e in Object(r))}};var br=function(e){var t=mr(e);return 1==t.length&&t[0][2]?yr(t[0][0],t[0][1]):function(r){return r===e||gr(r,e,t)}},wr="[object Symbol]";var Dr=function(e){return"symbol"==typeof e||st(e)&&x(e)==wr},_r=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Cr=/^\w*$/;var Sr=function(e,t){if(Je(e))return!1;var r=typeof e;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!Dr(e))||Cr.test(e)||!_r.test(e)||null!=t&&e in Object(t)},kr="Expected a function";function Rr(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError(kr);var r=function(){var n=arguments,a=t?t.apply(this,n):n[0],i=r.cache;if(i.has(a))return i.get(a);var o=e.apply(this,n);return r.cache=i.set(a,o)||i,o};return r.cache=new(Rr.Cache||ye),r}Rr.Cache=ye;var Tr=Rr,xr=500;var Mr=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Or=/\\(\\)?/g,Ar=function(e){var t=Tr(e,function(e){return r.size===xr&&r.clear(),e}),r=t.cache;return t}(function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(Mr,function(e,r,n,a){t.push(n?a.replace(Or,"$1"):r||e)}),t});var Pr=function(e,t){for(var r=-1,n=null==e?0:e.length,a=Array(n);++r<n;)a[r]=t(e[r],r,e);return a},Er=1/0,$r=m?m.prototype:void 0,jr=$r?$r.toString:void 0;var Fr=function e(t){if("string"==typeof t)return t;if(Je(t))return Pr(t,e)+"";if(Dr(t))return jr?jr.call(t):"";var r=t+"";return"0"==r&&1/t==-Er?"-0":r};var Ir=function(e){return null==e?"":Fr(e)};var Gr=function(e,t){return Je(e)?e:Sr(e,t)?[e]:Ar(Ir(e))},Br=1/0;var Nr=function(e){if("string"==typeof e||Dr(e))return e;var t=e+"";return"0"==t&&1/e==-Br?"-0":t};var Vr=function(e,t){for(var r=0,n=(t=Gr(t,e)).length;null!=e&&r<n;)e=e[Nr(t[r++])];return r&&r==n?e:void 0};var Lr=function(e,t,r){var n=null==e?void 0:Vr(e,t);return void 0===n?r:n};var Ur=function(e,t){return null!=e&&t in Object(e)};var qr=function(e,t,r){for(var n=-1,a=(t=Gr(t,e)).length,i=!1;++n<a;){var o=Nr(t[n]);if(!(i=null!=e&&r(e,o)))break;e=e[o]}return i||++n!=a?i:!!(a=null==e?0:e.length)&&St(a)&&_t(o,a)&&(Je(e)||pt(e))};var Kr=function(e,t){return null!=e&&qr(e,t,Ur)},zr=1,Yr=2;var Hr=function(e,t){return Sr(e)&&hr(t)?yr(Nr(e),t):function(r){var n=Lr(r,e);return void 0===n&&n===t?Kr(r,e):fr(t,n,zr|Yr)}};var Wr=function(e){return e};var Qr=function(e){return function(t){return null==t?void 0:t[e]}};var Xr=function(e){return function(t){return Vr(t,e)}};var Zr=function(e){return Sr(e)?Qr(Nr(e)):Xr(e)};var Jr=function(e){return"function"==typeof e?e:null==e?Wr:"object"==typeof e?Je(e)?Hr(e[0],e[1]):br(e):Zr(e)};var en=function(e,t,r,n){for(var a=e.length,i=r+(n?1:-1);n?i--:++i<a;)if(t(e[i],i,e))return i;return-1};var tn=function(e){return e!=e};var rn=function(e,t,r){for(var n=r-1,a=e.length;++n<a;)if(e[n]===t)return n;return-1};var nn=function(e,t,r){return t==t?rn(e,t,r):en(e,tn,r)};var an=function(e,t){return!(null==e||!e.length)&&nn(e,t,0)>-1};var on=function(e,t,r){for(var n=-1,a=null==e?0:e.length;++n<a;)if(r(t,e[n]))return!0;return!1};var sn=function(){},ln=Xt&&1/je(new Xt([,-0]))[1]==1/0?function(e){return new Xt(e)}:sn,cn=200;var un=function(e,t,r){var n=-1,a=an,i=e.length,o=!0,s=[],l=s;if(r)o=!1,a=on;else if(i>=cn){var c=t?null:ln(e);if(c)return je(c);o=!1,a=Me,l=new Te}else l=t?[]:s;e:for(;++n<i;){var u=e[n],d=t?t(u):u;if(u=r||0!==u?u:0,o&&d==d){for(var f=l.length;f--;)if(l[f]===d)continue e;t&&l.push(d),s.push(u)}else a(l,d,r)||(l!==s&&l.push(d),s.push(u))}return s};var dn,fn=function(e,t){return e&&e.length?un(e,Jr(t,2)):[]},pn=(dn=fn)&&dn.__esModule?dn:{default:dn};function vn(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var gn=function(){function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._$attrs=t,this._xeroResource=r,this._FlashNotification=n,this.resendingFailedGiftCards=!1,this.resyncSuccess=!1,this._defaultStatusMessages={401:{header:"Authorization Failed",message:"Check that your Xero and Vend accounts are linked.",link:{href:"/setup/xero",label:"Reconnect with Xero."}},503:{header:"Xero is unavailable",message:"The sync failed becuase we couldâ€™nt reach Xero when we tried. Resync to Xero to try again."}}}var t,r,n;return t=e,(r=[{key:"$onInit",value:function(){this.summariseFailedPostings()}},{key:"$postLink",value:function(){this._$attrs.$addClass("vr-gift-cards-failed-postings")}},{key:"resendFailedGiftCards",value:function(){var e=this;this.resendingFailedGiftCards=!0,this._xeroResource.resendFailedGiftCards().then(function(){e.resyncSuccess=!0}).catch(function(){e._FlashNotification.display("There was a problem resyncing gift cards to Xero. Please try again.")}).finally(function(){e.resendingFailedGiftCards=!1})}},{key:"summariseFailedPostings",value:function(){var e=this,t=(0,pn.default)(this.failedXeroPosts,function(e){return[e.xero_status,e.xero_message].join()});this.failedMessages=t.map(function(t){var r=t.xero_status;switch(r){case"401":case"503":return e._defaultStatusMessages[r];default:return"Account code must be specified"===t.xero_message?{header:"Xero Mapping",message:"These sync failed because there is no Xero account mapped to 'Gift Card Expiry Revenue'.",link:{href:"/setup/xero",label:"Map account in Xero setup."}}:{header:"Bad Request",message:t.xero_message}}})}}])&&vn(t.prototype,r),n&&vn(t,n),e}();gn.$inject=["$attrs","xeroResource","FlashNotification"],angular.module("reports.components").component("vrGiftCardsFailedPostings",{templateUrl:"partials/gift_cards/failed_xero_postings.html",controller:gn,bindings:{failedXeroPosts:"<"}});var hn=function(e){return e&&e.__esModule?e:{default:e}}(fn);function mn(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var yn=function(){function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._$attrs=t,this._manualStoreCreditResource=r,this._FlashNotification=n,this.resendingFailedManualStoreCredits=!1,this.resyncSuccess=!1,this._defaultStatusMessages={401:{header:"Authorization Failed",message:"Check that your Xero and Vend accounts are linked.",link:{href:"/setup/xero",label:"Reconnect with Xero."}},503:{header:"Xero is unavailable",message:"The sync failed becuase we couldâ€™nt reach Xero when we tried. Resync to Xero to try again."}}}var t,r,n;return t=e,(r=[{key:"$onInit",value:function(){this.summariseFailedPostings()}},{key:"$postLink",value:function(){this._$attrs.$addClass("vr-store-credits-failed-postings")}},{key:"resendFailedStoreCredits",value:function(){var e=this;this.resendingFailedManualStoreCredits=!0,this._manualStoreCreditResource.resendFailedManualStoreCredits().then(function(){e.resyncSuccess=!0}).catch(function(){e._FlashNotification.display("There was a problem resyncing manual store credits to Xero. Please try again.")}).finally(function(){e.resendingFailedManualStoreCredits=!1})}},{key:"summariseFailedPostings",value:function(){var e=this,t=(0,hn.default)(this.failedPosts,function(e){return[e.xero_status,e.xero_message].join()});this.failedMessages=t.map(function(t){var r=t.xero_status;switch(r){case"401":case"503":return e._defaultStatusMessages[r];default:return{header:"Bad Request",message:t.xero_message}}})}}])&&mn(t.prototype,r),n&&mn(t,n),e}();yn.$inject=["$attrs","xeroManualStoreCreditResource","FlashNotification"],angular.module("reports.components").component("vrStoreCreditsFailedPostings",{templateUrl:"partials/manual_store_credits/failed_xero_postings.html",controller:yn,bindings:{failedPosts:"<"}});angular.module("reports.controllers").controller("DashboardCtrl",["$scope","$timeout","AggregateDefinitionsService","DashboardDefinitionsService","DefinitionEventData","DimensionDefinitionsService","DisplayWidthService","GranularityDateSelection","Metrics","PermissionsService","ReportData","ReportDatatable","ReportRouteService","UserConfig","vdTracking","granularityDateSelection","liveUpdate",function(e,t,r,n,a,i,o,s,l,c,u,d,f,p,v,g,h){var m=!0,y={moduleName:"Report Dashboard"},b=new p;e.widgets=b.widgets,e.displayIsMediumOrLarger=!o.isSmall(),e.canAccessDashboard=c.canAccessDashboard(),e.canAccessDashboard||(m=!1),e.productDatatableConfig={showMetadataFilters:!1,showColumnHeaders:!1,showMetricAggregates:!1,showMetricSummary:!1,showMetrics:!1,loadMoreText:"View Full Report",sparklineOptions:{show:!0,cellAggregate:"total_revenue"},formatterOptions:{currency:{decimalPlaces:2}},loadMore:function(){var t=angular.copy(e.productDefinition);t.granularityDateSelection.update({periodCount:1}),f.update(t,!0)}},e.userDatatableConfig={showColumnHeaders:!1,showMetricAggregates:!1,showMetricSummary:!1,showMetrics:!1,loadMoreText:"View Full Report",formatterOptions:{currency:{decimalPlaces:2}},loadMore:function(){var t=angular.copy(e.userDefinition);t.granularityDateSelection.update({periodCount:1}),f.update(t,!0)}};var w=function(){return m&&0===moment().diff(e.granularityDateSelection.getSelectedMoment(),"days")},D=function(){Visibility.hidden()?h.timeoutQueued=!1:(C(),k(),R())},_=function(){t.cancel(h.timeout),w()&&!Visibility.hidden()?(h.timeout=t(D,12e4),h.timeoutQueued=!0):h.timeoutQueued=!1};e.granularityDateSelection=g,e.productDefinition=n.products(e.granularityDateSelection),e.userDefinition=n.users(e.granularityDateSelection);e.$watch("granularityDateSelection.getSelectedDate()",function(t,r){e.period=g.update({periodCount:8})},!0),e.views=[];var C=function(){l.increment("dashboard_refresh");var t=l.newTimer("dashboard_refresh"),a=u.get(n.outlets(e.granularityDateSelection).queryDefinition());e.views=[];for(var i=0;i<e.widgets.length;i++){var o=e.widgets[i],s=r.findByKey(o.aggregate);s&&(e.views[i]=a.view(o.name,s),e.views[i].widget=o,e.views[i].granularity=e.granularityDateSelection.granularity.key)}a.then(function(){t.end(),_()})},S=function(){return new s({selectedDate:g.getSelectedDate(),granularity:g.granularity,periodType:"current_granularity",periodCount:1}).createPeriod().localAsUTC()},k=function(){if(e.displayIsMediumOrLarger){e.productDefinition.report.dimensions.column=[i.findByKey(g.granularity.key)];var t=e.productDefinition.queryDefinition(10);t.setOrderPeriod(S());var r=u.get(t);e.productDatatable=new d(r,!0),r.then(function(){(r=T(r))&&0!==r.table.rows.length||(e.productDatatable.noResults=!0,e.productDatatable.canLoadMore=!1),_()})}},R=function(){if(e.displayIsMediumOrLarger){e.userDefinition.report.dimensions.column=[i.findByKey(g.granularity.key)];var t=e.userDefinition.queryDefinition(10);t.setOrderPeriod(S());var r=u.get(t);e.userDatatable=new d(r,!0),r.then(function(){(r=T(r))&&0!==r.table.rows.length||(e.userDatatable.noResults=!0,e.userDatatable.canLoadMore=!1),_()})}},T=function(e){var t;if(e.table){for(var r=e.table.headers.columns.length-1,n=[],a=[],i=[],o=[],s=0;s<e.table.rows.length;s++){t=e.table.rows[s];var l=e.table.headers.rows[s],c=e.table.headers.row_ids[s];t[r][0].item_count>0&&(n.push(l),i.push(c),a.push(t),o.push(t[r]))}return e.table.rows=a,e.table.headers.rows=n,e.table.headers.row_ids=i,e.table.aggregates.row=o,e}},x=Visibility.change(function(){Visibility.hidden()||h.timeoutQueued||D()});e.$on("$destroy",function(){return Visibility.unbind(x)}),e.addWidget=function(e){b.addWidget(e),C()},e.removeWidget=function(e){b.removeWidget(e),C()},e.$watch("period",function(){C(),R(),k()},!0),e.$watch("productDefinition.order",function(e,t){e!==t&&k()},!0),e.$watch("userDefinition.order",function(e,t){e!==t&&R()},!0),e.$watch("granularityDateSelection.granularity.key",function(t,r){var n,i;t!==r&&(n=new a(e.productDefinition),(i=angular.copy(y)).eventName="Granularity Changed",i.metadata=n.getEventMetadata(),i.metadata.granularity=e.granularityDateSelection.granularity.key,v.trackUserEvent(i),D())},!0)}]);angular.module("reports.controllers").controller("displayOptionsCtrl",["$scope","$modalInstance",function(e,t){e.cancel=function(){return t.dismiss()},e.save=function(e){return t.close(e)}}]);var bn=function(e,t,r,n,a,i){var o=this;if(this.giftCardData={waitingOnInitialData:!0,queryGiftCardWaiting:!1,giftCards:[],giftCardsEnabled:!0,giftCardTotals:[],customFilter:{filterApplied:!1,searchCriteria:""}},this.userCanAccessGiftCardReports=Boolean(a.enabledFeatures.plan_component_gift_card),this._retrieveGiftCardsAndTotals=function(){return e.all({results:t.getDefaultList(),totals:t.getTotals()}).catch(function(t){return 422===t.status&&(o.giftCardData.giftCardsEnabled=!1),e.reject()})},this._calculateGiftCardTotals=function(e){e.giftCardsInCirculation=e.gift_cards_in_circulation,e.outstandingBalance=e.outstanding_balance,e.totalValueRedeemed=-1*e.total_value_redeemed,e.totalValueSold=e.total_value_sold,o.giftCardData.giftCardTotals=e},this._retrieveGiftCardData=function(){var t={giftCards:o._retrieveGiftCardsAndTotals()};return t.failedXeroPosts=i.getFailedGiftCards().then(function(e){return e}).catch(function(){}),e.all(t).then(function(e){var t=e.giftCards,r=e.failedXeroPosts;o.giftCardData.giftCards=t.results,o._calculateGiftCardTotals(t.totals),o.giftCardData.failedXeroPosts=r}).catch(function(){return r.display("Sorry, we couldnâ€™t fetch some data. Please refresh this page and try again.")}).finally(function(){o.giftCardData.waitingOnInitialData=!1})},this.userCanAccessGiftCardReports)this._retrieveGiftCardData(),n.trackUserEvent({moduleName:"Gift Cards Report",eventName:"Report viewed"});else{var s=function(e){return{moduleName:"Account",eventName:e,metadata:{feature:"gift-cards",source:"gift-card-report"}}};n.trackUserEvent(s("Feature promo displayed")),this.trackLinksData=s("Plans displayed")}return this};bn.$inject=["$q","giftCardResource","FlashNotification","vdTracking","FeatureService","xeroResource"],angular.module("reports.controllers").controller("GiftCardsCtrl",bn);var wn=function(e){var t=null==e?0:e.length;return t?e[t-1]:void 0},Dn=function(){try{var e=Q(Object,"defineProperty");return e({},"",{}),e}catch(t){}}();var _n=function(e,t,r){"__proto__"==t&&Dn?Dn(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r};var Cn=function(e,r,n){(void 0===n||t(e[r],n))&&(void 0!==n||r in e)||_n(e,r,n)};var Sn=function(e){return function(t,r,n){for(var a=-1,i=Object(t),o=n(t),s=o.length;s--;){var l=o[e?s:++a];if(!1===r(i[l],l,i))break}return t}}(),kn={exports:{}},Rn="object"==typeof kn.exports&&kn.exports&&!kn.exports.nodeType&&kn.exports,Tn=Rn&&kn&&!kn.nodeType&&kn,xn=Tn&&Tn.exports===Rn?h.Buffer:void 0,Mn=xn?xn.allocUnsafe:void 0;kn.exports=function(e,t){if(t)return e.slice();var r=e.length,n=Mn?Mn(r):new e.constructor(r);return e.copy(n),n},kn=kn.exports;var On=function(e){var t=new e.constructor(e.byteLength);return new Ee(t).set(new Ee(e)),t};var An=function(e,t){var r=t?On(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)};var Pn=function(e,t){var r=-1,n=e.length;for(t||(t=Array(n));++r<n;)t[r]=e[r];return t},En=Object.create,$n=function(){function e(){}return function(t){if(!M(t))return{};if(En)return En(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}(),jn=Bt(Object.getPrototypeOf,Object);var Fn=function(e){return"function"!=typeof e.constructor||Gt(e)?{}:$n(jn(e))};var In=function(e){return st(e)&&Ut(e)},Gn="[object Object]",Bn=Function.prototype,Nn=Object.prototype,Vn=Bn.toString,Ln=Nn.hasOwnProperty,Un=Vn.call(Object);var qn=function(e){if(!st(e)||x(e)!=Gn)return!1;var t=jn(e);if(null===t)return!0;var r=Ln.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&Vn.call(r)==Un};var Kn=function(e,t){if("__proto__"!=t)return e[t]},zn=Object.prototype.hasOwnProperty;var Yn=function(e,r,n){var a=e[r];zn.call(e,r)&&t(a,n)&&(void 0!==n||r in e)||_n(e,r,n)};var Hn=function(e,t,r,n){var a=!r;r||(r={});for(var i=-1,o=t.length;++i<o;){var s=t[i],l=n?n(r[s],e[s],s,r,e):void 0;void 0===l&&(l=e[s]),a?_n(r,s,l):Yn(r,s,l)}return r};var Wn=function(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t},Qn=Object.prototype.hasOwnProperty;var Xn=function(e){if(!M(e))return Wn(e);var t=Gt(e),r=[];for(var n in e)("constructor"!=n||!t&&Qn.call(e,n))&&r.push(n);return r};var Zn=function(e){return Ut(e)?Ft(e,!0):Xn(e)};var Jn=function(e){return Hn(e,Zn(e))};var ea=function(e,t,r,n,a,i,o){var s=Kn(e,r),l=Kn(t,r),c=o.get(l);if(c)Cn(e,r,c);else{var u=i?i(s,l,r+"",e,t,o):void 0,d=void 0===u;if(d){var f=Je(l),p=!f&&gt(l),v=!f&&!p&&$t(l);u=l,f||p||v?Je(s)?u=s:In(s)?u=Pn(s):p?(d=!1,u=kn(l,!0)):v?(d=!1,u=An(l,!0)):u=[]:qn(l)||pt(l)?(u=s,pt(s)?u=Jn(s):M(s)&&!F(s)||(u=Fn(l))):d=!1}d&&(o.set(l,u),a(u,l,n,i,o),o.delete(l)),Cn(e,r,u)}};var ta=function e(t,r,n,a,i){t!==r&&Sn(r,function(o,s){if(M(o))i||(i=new _e),ea(t,r,s,n,e,a,i);else{var l=a?a(Kn(t,s),o,s+"",t,r,i):void 0;void 0===l&&(l=o),Cn(t,s,l)}},Zn)};var ra=function(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)},na=Math.max;var aa=function(e,t,r){return t=na(void 0===t?e.length-1:t,0),function(){for(var n=arguments,a=-1,i=na(n.length-t,0),o=Array(i);++a<i;)o[a]=n[t+a];a=-1;for(var s=Array(t+1);++a<t;)s[a]=n[a];return s[t]=r(o),ra(e,this,s)}};var ia=function(e){return function(){return e}},oa=Dn?function(e,t){return Dn(e,"toString",{configurable:!0,enumerable:!1,value:ia(t),writable:!0})}:Wr,sa=800,la=16,ca=Date.now;var ua=function(e){var t=0,r=0;return function(){var n=ca(),a=la-(n-r);if(r=n,a>0){if(++t>=sa)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}(oa);var da=function(e,t){return ua(aa(e,t,Wr),e+"")};var fa=function(e,r,n){if(!M(n))return!1;var a=typeof r;return!!("number"==a?Ut(n)&&_t(r,n.length):"string"==a&&r in n)&&t(n[r],e)};var pa=function(e){return da(function(t,r){var n=-1,a=r.length,i=a>1?r[a-1]:void 0,o=a>2?r[2]:void 0;for(i=e.length>3&&"function"==typeof i?(a--,i):void 0,o&&fa(r[0],r[1],o)&&(i=a<3?void 0:i,a=1),t=Object(t);++n<a;){var s=r[n];s&&e(t,s,n,i)}return t})},va=pa(function(e,t,r){ta(e,t,r)}),ga={};Object.defineProperty(ga,"__esModule",{value:!0}),ga.default=void 0;var ha=[{name:"Supplier Order",type:"supplier_order"},{name:"Transfer",type:"transfer"},{name:"Supplier Return",type:"supplier_return"},{name:"Inventory Count",type:"stocktake"},{name:"Sale",type:"sale"},{name:"Sale Return",type:"return"},{name:"Inventory Edit",type:"product_edit"}];ga.default=ha;var ma=wa(wn),ya=wa(va),ba=wa(ga);function wa(e){return e&&e.__esModule?e:{default:e}}function Da(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var _a=function(e,t,r,n,a,i,o,s,l,c){var u=this,d=["outlets","sales","suppliers","customers","products"];this.isLoadingNewReport=!0,this.isLoadingMore=!1,this.movementsPayload={movements:[],product:this.product},d.forEach(function(e){u.movementsPayload[e]={}}),this.dateSelection=new i({periodType:"range",startDate:t.startDate||moment().subtract("1","week"),endDate:t.endDate||moment(),granularity:o.findByKey("range")}),this.datePickerConfig={range:!0},this.product=r,this.outletOptions=[{name:"All",value:""}].concat(Da(n)),this.eventOptions=[{name:"All",value:""}].concat(Da(ba.default));var f,p;this.movementFilters={outlet:(t.outlet&&(p=u.outletOptions.find(function(e){return e.id===t.outlet})),null==p&&(p=u.outletOptions[0]),p),event:(t.event&&(f=u.eventOptions.find(function(e){return e.type===t.event})),null==f&&(f=u.eventOptions[0]),f)},this._retrieveMovements=function(e){null==e&&(e=!0),u.isLoadingNewReport=!0,u._updateRoute(e),l.trackUserEvent({moduleName:"Product Movements Report",eventName:"Report viewed"}),s.getMovements(u.product.id,{start:u.dateSelection.period.start.toISOString(),finish:u.dateSelection.period.end.toISOString(),include:d,location_id:null!=u.movementFilters.outlet?u.movementFilters.outlet.id:void 0,event_type:null!=u.movementFilters.event?u.movementFilters.event.type:void 0,include_variants:1,include_after_levels:1,page_size:101,before:u.loadMoreId}).then(function(e){var t;(e.data.length>100?(e.data.pop(),u.lastMovementId=(0,ma.default)(e.data).id,u.showLoadMore=!0):u.showLoadMore=!1,u.loadMoreId)?(t=u.movementsPayload.movements).push.apply(t,Da(e.data||[])):u.movementsPayload.movements=e.data;d.forEach(function(t){(0,ya.default)(u.movementsPayload[t],e.related[t])})}).catch(function(){return a.display("Something went wrong while trying to fetch your report data. Refresh to try again.")}).finally(function(){u.isLoadingNewReport=!1,u.isLoadingMore=!1})},this.loadMore=function(){u.loadMoreId=u.lastMovementId,u.isLoadingMore=!0,u._retrieveMovements(!1)},this._updateRoute=function(t){e.go("product_movements",{startDate:c.slugify(u.dateSelection.getPeriodStartDate()),endDate:c.slugify(u.dateSelection.getPeriodEndDate()),event:null!=u.movementFilters.event?u.movementFilters.event.type:void 0,outlet:null!=u.movementFilters.outlet?u.movementFilters.outlet.id:void 0},{notify:!1,location:!!t||"replace"})},this.submit=function(){u.loadMoreId=null,u._retrieveMovements(!0)},this._retrieveMovements(!1)};_a.$inject=["$state","$stateParams","product","outlets","FlashNotification","GranularityDateSelection","GranularityDefinitionsService","productMovementsResource","vdTracking","DatetimeService"],angular.module("reports.controllers").controller("ProductMovementsCtrl",_a);var Ca=function(e){return function(t,r,n){var a=Object(t);if(!Ut(t)){var i=Jr(r,3);t=qt(t),r=function(e){return i(a[e],e,a)}}var o=e(t,r,n);return o>-1?a[i?t[o]:o]:void 0}},Sa=NaN,ka=/^\s+|\s+$/g,Ra=/^[-+]0x[0-9a-f]+$/i,Ta=/^0b[01]+$/i,xa=/^0o[0-7]+$/i,Ma=parseInt;var Oa=function(e){if("number"==typeof e)return e;if(Dr(e))return Sa;if(M(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=M(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(ka,"");var r=Ta.test(e);return r||xa.test(e)?Ma(e.slice(2),r?2:8):Ra.test(e)?Sa:+e},Aa=1/0,Pa=1.7976931348623157e308;var Ea=function(e){return e?(e=Oa(e))===Aa||e===-Aa?(e<0?-1:1)*Pa:e==e?e:0:0===e?e:0};var $a=function(e){var t=Ea(e),r=t%1;return t==t?r?t-r:t:0},ja=Math.max;var Fa=function(e,t,r){var n=null==e?0:e.length;if(!n)return-1;var a=null==r?0:$a(r);return a<0&&(a=ja(n+a,0)),en(e,Jr(t,3),a)},Ia=Ca(Fa);var Ga=function(e,t,r){var n=-1,a=e.length;t<0&&(t=-t>a?0:a+t),(r=r>a?a:r)<0&&(r+=a),a=t>r?0:r-t>>>0,t>>>=0;for(var i=Array(a);++n<a;)i[n]=e[n+t];return i};var Ba=function(e,t){return t.length<2?e:Vr(e,Ga(t,0,-1))};var Na=function(e,t){return t=Gr(t,e),null==(e=Ba(e,t))||delete e[Nr(wn(t))]},Va=Array.prototype.splice;var La=function(e,t){for(var r=e?t.length:0,n=r-1;r--;){var a=t[r];if(r==n||a!==i){var i=a;_t(a)?Va.call(e,a,1):Na(e,a)}}return e};var Ua=function(e,t){var r=[];if(!e||!e.length)return r;var n=-1,a=[],i=e.length;for(t=Jr(t,3);++n<i;){var o=e[n];t(o,n,e)&&(r.push(o),a.push(n))}return La(e,a),r},qa=za(Ia),Ka=za(Ua);function za(e){return e&&e.__esModule?e:{default:e}}angular.module("reports.controllers").controller("ReportControlsCtrl",["$scope","DimensionDefinitionsService","GranularityDateSelection","FilterDefinitionsService","Metrics","ReportRouteService","PersistedOptions","granularities","metrics","reports","datatableDefinition",function(e,t,r,n,a,i,o,s,l,c,u){e.datatableDefinition=u,e.reports=c.all(),e.selectedReport=e.datatableDefinition.report,e.includeProductsCheckbox={id:"include-products",label:"Show products"},e.reportType=function(){switch(e.selectedReport.type){case"payment":return"Payments Report";case"inventory":return"Inventory Report";case"tax":return"Tax Report";default:return"Sales Report"}},e.$watch("selectedReport",function(t,r){t!==r&&(f(),e.datatableDefinition.report=t,p())}),e.$watchCollection("datatableDefinition.optionalAggregates",function(e,t){e!==t&&((new o).setDatatableOption("optionalAggregates",e),v())}),e.$watchCollection("datatableDefinition.dimensionMetadata",function(e,t){e!==t&&((new o).setDatatableOption("metadata",e),v())}),e.$watch("datatableDefinition.report",function(t,r){t!==r&&(t&&a.increment("report_type",{tags:["type:".concat(t.key)]}),e.ready=!0,v())});var d=function(){return e.datatableDefinition.loadAvailableOptions()},f=function(){if(e.selectedReport.hasDateFilter()){var t=e.selectedReport.config.datePicker,n=e.datatableDefinition;if(!t[["all","range","single"].includes(n.granularityDateSelection.granularity.key)?n.granularityDateSelection.granularity.key:"compare"])if(t.all)n.granularityDateSelection=r.getAllSelection();else if(t.compare)n.granularityDateSelection=r.getCompareSelection();else if(t.single)n.granularityDateSelection=r.getSingleSelection();else{var a,i;t.startMonth&&(i=moment().startOf("month")),t.minDate&&(a=moment(t.minDate).toDate()),n.granularityDateSelection=r.getRangeSelection(i,a)}}};f();var p=function(){var r,a;!function(){var t=e.selectedReport;e.metrics=l.forReport(t);var r=e.datatableDefinition.metric&&e.datatableDefinition.metric.key;(0,qa.default)(e.metrics,function(e){return e.key===r})||(e.datatableDefinition.metric=(0,qa.default)(e.metrics,function(e){return e.default}))}(),function(){e.availableFilters=n.limit(e.datatableDefinition.report);var t={},r=!0,a=!1,i=void 0;try{for(var o,s=e.availableFilters[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var l=o.value;t[l.key]=!0}}catch(c){a=!0,i=c}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}e.datatableDefinition.filters=(0,Ka.default)(e.datatableDefinition.filters,function(e){return t[e.type]})}(),r=e.datatableDefinition.report.dimensions.rowOptional||[],a=t.keySet(r),e.datatableDefinition.canIncludeProducts=a.includes("product"),d()};p(),e.$watch("datatableDefinition.metric",function(e,t){e!==t&&(e&&a.increment("report_metric",{tags:["type:".concat(e.key)]}),v())},!0),e.granularities=s.all(),e.$watchCollection("datatableDefinition.granularityDateSelection",function(e,t){e!==t&&v()}),e.$watchGroup(["datatableDefinition.options","datatableDefinition.groupVariants","datatableDefinition.order[0].direction","datatableDefinition.order[0].dimension","datatableDefinition.order[0].metric"],function(e,t){e!==t&&v()},!0),e.$watch("datatableDefinition.includeProducts",function(e,t){e!==t&&(d(),v())},!0);var v=function(){return i.update(u)};v()}]);angular.module("reports.controllers").controller("ReportDatatableCtrl",["$scope","ReportDatatable","ReportData","DimensionDefinitionsService","DefinitionEventData","vdTracking","datatableDefinition",function(e,t,r,n,a,i,o){var s={moduleName:"Report Datatable"};e.order={},e.pageSize=100;var l=null;e.datatableDefinition=o,e.config={formatterOptions:{currency:{decimalPlaces:2},whole_number:{decimalPlaces:0,round:!0},number:{decimalPlaces:1}}};var c=function(){var t=e.datatableDefinition.queryDefinition(e.pageSize,e.currentSize),a=n.findByKey(e.datatableDefinition.granularityDateSelection.granularity.key);return a&&e.datatableDefinition.report.hasDateFilter()&&t.addDimension("column",a),l=(new Date).getTime(),r.get(t)};e.config.loadMore=function(){e.currentSize=e.currentSize+e.pageSize;var t=c();t&&e.reportDatatable.loadMore(t,e.order)};var u=function(){if(!((new Date).getTime()-l<200&&null!==l)){var r,n;null!==l&&(r=new a(e.datatableDefinition),(n=angular.copy(s)).eventName="Report viewed",n.metadata=r.getEventMetadata(),i.trackUserEvent(n)),e.currentSize=0;var o=c();e.reportDatatable=new t(o,!0)}};u(),e.$watchGroup(["datatableDefinition.report.key","datatableDefinition.metric","datatableDefinition.dimensionMetadata","datatableDefinition.optionalAggregates","datatableDefinition.filters.length","datatableDefinition.order[0].direction","datatableDefinition.order[0].metric","datatableDefinition.order[0].dimension","datatableDefinition.granularityDateSelection.granularity.key","datatableDefinition.granularityDateSelection.period","datatableDefinition.includeProducts"],function(e,t){for(var r=!1,n=0;n<e.length;n++){if(e[n]!==t[n]){r=!0;break}}r&&u()}),e.$watch("datatableDefinition.options",function(e,t){e!==t&&u()},!0)}]);var Ya=function(e,t,r,n,a,i){var o=this,s={moduleName:"Store Credit Report"};return this.storeCreditEnabled=t.retailer.attributes.has_store_credit,this.storeCreditData={waiting:!0,storeCreditRecords:[],storeCreditTotals:[],failedPosts:[]},this._getStoreCreditTotals=function(){return e.all({results:n.getAll(),totals:n.getTotals()}).catch(function(t){return 422===t.status&&(o.storeCreditEnabled=!1),e.reject()}).finally(function(){o.storeCreditData.waiting=!1})},this._calculateStoreCreditTotals=function(e){var t=o.storeCreditData.storeCreditTotals;t.outstandingBalance=e.outstanding_balance,t.totalValueIssued=e.total_value_issued,t.totalValueRedeemed=-1*e.total_value_redeemed,o.storeCreditData.storeCreditTotals=t},this._retrieveStoreCreditReportData=function(){var t={storeCredits:o._getStoreCreditTotals()};return t.failedPosts=i.getFailedPosting().then(function(e){return e}).catch(function(){}),e.all(t).then(function(e){var t=e.storeCredits,r=e.failedPosts;o.storeCreditData.storeCreditRecords=t.results,o._calculateStoreCreditTotals(t.totals),o.storeCreditData.failedPosts=r}).catch(function(){return r.display("Sorry, we couldnâ€™t fetch some data. Please refresh this page and try again.")}).finally(function(){o.storeCreditData.waiting=!1})},this.storeCreditEnabled&&(this._retrieveStoreCreditReportData(),s.eventName="Report viewed",a.trackUserEvent(s)),this};Ya.$inject=["$q","$rootScope","FlashNotification","storeCreditResource","vdTracking","xeroManualStoreCreditResource"],angular.module("reports.controllers").controller("StoreCreditCtrl",Ya);angular.module("reports.directives").directive("vrBasicReportTableDataLoader",function(){return{scope:{columns:"="},restrict:"A",bindToController:!0,controllerAs:"vrBasicReportTableDataLoaderCtrl",template:'\x3c!-- Table data loader while syncing data --\x3e\n\n<td colspan="{{vrBasicReportTableDataLoaderCtrl.columns}}" class="vd-align-center">\n    <div class="vd-loader"></div>\n</td>',controller:function(){}}});angular.module("reports.directives").directive("vrBasicReportTableSummaryItem",function(){return{scope:{name:"=",valueIsCurrency:"=",value:"=",lastRow:"="},restrict:"E",bindToController:!0,controllerAs:"vrBasicReportTableSummaryItemCtrl",template:'\x3c!-- Table summary item --\x3e\n    <table class="vd-table">\n      <tbody>\n        <tr ng-class="{ \'vd-no-border-b\': vrBasicReportTableSummaryItemCtrl.lastRow }">\n          <td class="vd-header vd-no-pad-l">{{ ::vrBasicReportTableSummaryItemCtrl.name }}</td>\n          <td ng-if="vrBasicReportTableSummaryItemCtrl.valueIsCurrency"\n            class="vd-no-pad-r vd-align-right vd-tight">\n            {{ vrBasicReportTableSummaryItemCtrl.value | vdCurrencyFilter }}\n          </td>\n          <td ng-if="!vrBasicReportTableSummaryItemCtrl.valueIsCurrency"\n            class="vd-no-pad-r vd-align-right vd-tight">\n            {{ vrBasicReportTableSummaryItemCtrl.value }}\n          </td>\n        </tr>\n      </tbody>\n    </table>',controller:function(){}}});angular.module("reports.directives").directive("vrGiftCardsReportSearch",function(){return{scope:{giftCardData:"="},restrict:"E",bindToController:!0,controllerAs:"vrGiftCardsReportSearchCtrl",template:'\x3c!-- Gift card search --\x3e\n<form ng-submit="vrGiftCardsReportSearchCtrl.giftCardSearchQuery(vrGiftCardsReportSearchCtrl.searchCriteria)">\n    <div class="vd-g-row vd-flex--justify-end">\n      <div class="vd-g-col vd-g-s-6">\n        <div class="vd-field vd-field--short">\n          <div class="vd-label">Gift card number</div>\n          <div class="vd-value">\n            <input ng-model="vrGiftCardsReportSearchCtrl.searchCriteria"\n              class="vd-input vd-input--icon-left"\n              placeholder="Search for a gift card number"\n              autofocus>\n            <i class="fa fa-search vd-input-icon vd-input-icon--left"></i>\n          </div>\n        </div>\n      </div>\n\n      \x3c!-- Gift card search actions --\x3e\n      <div class="vd-g-col vd-g-s-6">\n        <div class="vd-label">&nbsp;</div>\n        <div vd-flex vd-flex-justify="end" vd-flex-align="center">\n          <vd-button ng-if="vrGiftCardsReportSearchCtrl.searchCriteria"\n            type="button"\n            category="tertiary" modifier="text"\n            ng-click="vrGiftCardsReportSearchCtrl.clearFilter()">\n            Clear Filter\n          </vd-button>\n          <vd-button\n            ng-disabled="vrGiftCardsReportSearchCtrl.isInValidSearchCriteria()">\n            Apply Filter\n          </vd-button>\n        </div>\n      </div>\n    </div>\n</form>',controller:["giftCardResource","FlashNotification",function(e,t){var r=this,n="Something went wrong while trying to fetch your report data. - Refresh to try again.";this.isInValidSearchCriteria=function(){return null==r.searchCriteria},this.giftCardSearchQuery=function(a){if(r.giftCardData.queryGiftCardWaiting=!0,""===a&&r.clearFilter(),a)return e.searchQuery(a).then(function(e){r.giftCardData.giftCards=e.data}).catch(function(){return t.display(n)}).finally(function(){r.giftCardData.queryGiftCardWaiting=!1,r.giftCardData.customFilter.filterApplied=!0,r.giftCardData.customFilter.searchCriteria=a})},this.clearFilter=function(){return r.giftCardData.queryGiftCardWaiting=!0,e.getDefaultList().then(function(e){r.searchCriteria=null,r.giftCardData.giftCards=e}).catch(function(){return t.display(n)}).finally(function(){r.giftCardData.queryGiftCardWaiting=!1,r.giftCardData.customFilter.filterApplied=!1,r.giftCardData.customFilter.searchCriteria=""})}}]}});angular.module("reports.directives").directive("vrGiftCardsReportTableSummary",function(){return{scope:{giftCardData:"="},restrict:"E",bindToController:!0,controllerAs:"vrGiftCardsReportTableSummaryCtrl",template:'<vd-section>\n    <div class="vd-flex">\n      <div class="vd-col-6 vd-prl">\n        <vr-basic-report-table-summary-item\n          name="\'Total Value Sold\'"\n          value-is-currency="true"\n          value="vrGiftCardsReportTableSummaryCtrl.giftCardData.giftCardTotals.totalValueSold">\n        </vr-basic-report-table-summary-item>\n      </div>\n\n      <div class="vd-col-6 vd-pll">\n        <vr-basic-report-table-summary-item\n          name="\'Total Value Redeemed\'"\n          value-is-currency="true"\n          value="vrGiftCardsReportTableSummaryCtrl.giftCardData.giftCardTotals.totalValueRedeemed">\n        </vr-basic-report-table-summary-item>\n      </div>\n    </div>\n\n    <div class="vd-flex">\n      <div class="vd-col-6 vd-prl">\n        <vr-basic-report-table-summary-item\n          name="\'Outstanding Balance\'"\n          value-is-currency="true"\n          value="vrGiftCardsReportTableSummaryCtrl.giftCardData.giftCardTotals.outstandingBalance"\n          last-row="true">\n        </vr-basic-report-table-summary-item>\n      </div>\n\n      <div class="vd-col-6 vd-pll">\n        <vr-basic-report-table-summary-item\n          name="\'Gift Cards in Circulation\'"\n          value="vrGiftCardsReportTableSummaryCtrl.giftCardData.giftCardTotals.giftCardsInCirculation"\n          last-row="true">\n        </vr-basic-report-table-summary-item>\n      </div>\n    </div>\n</vd-section>',controller:function(){return this}}});angular.module("reports.directives").directive("vrGiftCardsReportTable",function(){return{scope:{giftCardData:"="},restrict:"E",bindToController:!0,controllerAs:"vrGiftCardsReportTableCtrl",template:'\x3c!-- Gift card search --\x3e\n<vd-section type="tertiary">\n    <vr-gift-cards-report-search gift-card-data="vrGiftCardsReportTableCtrl.giftCardData">\n    </vr-gift-cards-report-search>\n</vd-section>\n\n<vd-section>\n    \x3c!-- Gift card summary section --\x3e\n    <vr-gift-cards-report-table-summary gift-card-data="vrGiftCardsReportTableCtrl.giftCardData">\n    </vr-gift-cards-report-table-summary>\n\n    <vd-section type="tertiary" ng-if="vrGiftCardsReportTableCtrl.giftCardData.failedXeroPosts.length">\n      <vr-gift-cards-failed-postings\n        failed-xero-posts="vrGiftCardsReportTableCtrl.giftCardData.failedXeroPosts">\n        </vr-gift-cards-failed-postings>\n    </vd-section>\n</vd-section>\n\n<vd-section>\n    \x3c!-- On page load filter message --\x3e\n    <ng-pluralize ng-if="!vrGiftCardsReportTableCtrl.giftCardData.customFilter.filterApplied"\n      class="vd-text--secondary vd-text--sub vd-mbm"\n      count="vrGiftCardsReportTableCtrl.giftCardData.giftCards.length"\n      when="{\'1\': \'Showing 1 gift card.\',\n             \'other\': \'Showing {{vrGiftCardsReportTableCtrl.giftCardData.giftCards.length}} gift cards.\'\n            }">\n    </ng-pluralize>\n\n    \x3c!-- Custom filter message --\x3e\n    <ng-pluralize ng-if="vrGiftCardsReportTableCtrl.giftCardData.customFilter.filterApplied"\n      class="vd-text--secondary vd-text--sub vd-mbm"\n      count="vrGiftCardsReportTableCtrl.giftCardData.giftCards.length"\n      when="{\'1\': \'Showing 1 gift card that starts with\n              &quot;{{vrGiftCardsReportTableCtrl.giftCardData.customFilter.searchCriteria}}&quot;.\',\n             \'other\': \'Showing {{vrGiftCardsReportTableCtrl.giftCardData.giftCards.length}} gift cards that start with\n              &quot;{{vrGiftCardsReportTableCtrl.giftCardData.customFilter.searchCriteria}}&quot;.\'\n            }">\n    </ng-pluralize>\n\n    \x3c!-- Gift card table section --\x3e\n    <table class="vd-table vd-table--compact vd-table--fixed vd-table--report vd-table--expandable">\n      <thead>\n        <tr>\n          <th>Gift card number</th>\n          <th vd-align="right">Total sold</th>\n          <th vd-align="right">Total redeemed</th>\n          <th vd-align="right">Balance</th>\n        </tr>\n      </thead>\n      <tbody vr-gift-cards-report-table-row gift-card-data="vrGiftCardsReportTableCtrl.giftCardData">\n      </tbody>\n    </table>\n</vd-section>',controller:function(){return this}}});angular.module("reports.directives").directive("vrGiftCardsReportTableExpanded",function(){return{scope:{selectedGiftCard:"="},restrict:"E",bindToController:!0,controllerAs:"vrGiftCardsReportTableExpandedCtrl",template:'<table class="vd-table vd-table--compact vd-table--fixed">\n    <thead>\n      <tr class="vd-no-border-t vd-no-border-l vd-no-border-r vd-border-b">\n        <th class="vd-no-pad-t vd-text--secondary vd-text--sub">Date</th>\n        <th class="vd-no-pad-t vd-text--secondary vd-text--sub">Status</th>\n        <th class="vd-no-pad-t vd-text--secondary vd-text--sub" vd-align="right">Amount</th>\n      </tr>\n    </thead>\n    <tbody>\n      <tr ng-repeat="transaction in vrGiftCardsReportTableExpandedCtrl.selectedGiftCard.gift_card_transactions |\n        orderBy: \'-created_at\'">\n        <td>\n          <span>{{::transaction.created_at | vendGranularityDate:"MMM D, YYYY"}}</span>\n          <span class="vd-text--secondary">{{::transaction.created_at | vendGranularityDate:"HH:mm"}}</span>\n        </td>\n        <td>\n          <span>{{vrGiftCardsReportTableExpandedCtrl.translateTransactionStatus(transaction)}}</span>\n          \x3c!-- todo: get the sale id for issuing transactions from the parent object and construct --\x3e\n          \x3c!-- the correct url for that --\x3e\n          <span ng-if="transaction.id && (transaction.type === \'REDEEMING\')">\n            (<a ng-href="/history?gift_card_transaction_id={{::transaction.id}}"\n              class="vd-link">View Sale\n            </a>)\n          </span>\n        </td>\n        <td vd-align="right">{{transaction.amount | vdCurrencyFilter}}</td>\n      </tr>\n    </tbody>\n</table>',controller:function(){var e={ACTIVATION:"Issued",REDEEMING:"Redeemed",IMPORTING:"Imported",VOIDING:"Cancelled",REVERSING:"Reversed",EXPIRING:"Expired"};return this.translateTransactionStatus=function(t){return e[t.type]||t.type},this}}});angular.module("reports.directives").directive("vrGiftCardsReportTableRow",function(){return{scope:{giftCardData:"="},restrict:"A",bindToController:!0,controllerAs:"vrGiftCardsReportTableRowCtrl",template:'\x3c!-- Table loader while syncing gift card data --\x3e\n<tr ng-if="vrGiftCardsReportTableRowCtrl.giftCardData.queryGiftCardWaiting"\n    vr-basic-report-table-data-loader\n    columns="4">\n</tr>\n\n\x3c!-- If no results are returned by the API --\x3e\n<tr ng-if="!vrGiftCardsReportTableRowCtrl.giftCardData.giftCards.length &&\n    !vrGiftCardsReportTableRowCtrl.giftCardData.waitingOnInitialData &&\n    !vrGiftCardsReportTableRowCtrl.giftCardData.queryGiftCardWaiting"\n    class="vd-inactive">\n    <td colspan="4">\n      No gift card data available\n    </td>\n</tr>\n\n<tr ng-if="vrGiftCardsReportTableRowCtrl.giftCardData.giftCards.length &&\n    !vrGiftCardsReportTableRowCtrl.giftCardData.queryGiftCardWaiting"\n    ng-repeat-start="giftCard in vrGiftCardsReportTableRowCtrl.giftCardData.giftCards"\n    class="vd-expandable"\n    ng-class="{\n      \'vd-expandable--expanded vd-border-t\': vrGiftCardsReportTableRowCtrl.selectedGiftCard.id === giftCard.id\n    }"\n    ng-click="vrGiftCardsReportTableRowCtrl.toggleSelectedGiftCard(giftCard)">\n    <td>\n      {{::giftCard.number}}\n      <span ng-if="giftCard.sale_id">\n        (<a ng-click="vrGiftCardsReportTableRowCtrl.viewSale($event, giftCard.sale_id)"\n          class="vd-link">View Sale\n        </a>)\n      </span>\n    </td>\n    <td vd-align="right">{{::giftCard.total_sold | vdCurrencyFilter}}</td>\n    <td vd-align="right">{{::giftCard.total_redeemed | vdCurrencyFilter}}</td>\n    <td vd-align="right">{{::giftCard.balance | vdCurrencyFilter}}</td>\n</tr>\n\n<tr ng-if="!vrGiftCardsReportTableRowCtrl.giftCardData.queryGiftCardWaiting"\n    ng-repeat-end\n    ng-class="{\'vd-border-b\': vrGiftCardsReportTableRowCtrl.selectedGiftCard.id === giftCard.id}">\n    <td colspan="4">\n      <vr-gift-cards-report-table-expanded\n        ng-if="vrGiftCardsReportTableRowCtrl.selectedGiftCard.id === giftCard.id"\n        selected-gift-card="vrGiftCardsReportTableRowCtrl.selectedGiftCard">\n      </vr-gift-cards-report-table-expanded>\n    </td>\n</tr>',controller:["$window","vdTracking",function(e,t){var r=this,n={moduleName:"Gift Cards Report",eventName:"Gift card expanded"};return this.viewSale=function(t,r){t.stopPropagation(),e.location.assign("/history?sale_id=".concat(r,"#").concat(r))},this.toggleSelectedGiftCard=function(e){r.selectedGiftCard&&r.selectedGiftCard.id===e.id?r.selectedGiftCard=null:(r.selectedGiftCard=e,t.trackUserEvent(n))},this}]}});angular.module("reports.directives").directive("vrProductMovementEvent",function(){return{scope:{movement:"<"},restrict:"E",bindToController:!0,controllerAs:"$ctrl",template:'<span ng-switch="$ctrl.eventType()">\n    <span ng-switch-when="bootstrap">System Import</span>\n    <span ng-switch-when="supplier_order_sent">\n      <a href="/consignment/{{ $ctrl.movement.event_id }}" target="_blank" class="vd-link vd-link--secondary">\n        Order Placed\n      </a>\n    </span>\n    <span ng-switch-when="supplier_order_received">\n      <a href="/consignment/{{ $ctrl.movement.event_id }}" target="_blank" class="vd-link vd-link--secondary">\n        Order Received\n      </a>\n    </span>\n    <span ng-switch-when="supplier_order_reversal">\n      <a href="/consignment/{{ $ctrl.movement.event_id }}" target="_blank" class="vd-link vd-link--secondary">\n        Supplier Order (Adjustment)\n      </a>\n    </span>\n    <span ng-switch-when="supplier_order_cancelled">\n      <a href="/consignment/{{ $ctrl.movement.event_id }}" target="_blank" class="vd-link vd-link--secondary">\n        Supplier Order (Cancelled)\n      </a>\n    </span>\n    <span ng-switch-when="transfer_sent">\n      <a href="/consignment/{{ $ctrl.movement.event_id }}" target="_blank" class="vd-link vd-link--secondary">\n        Transfer Placed\n      </a>\n    </span>\n    <span ng-switch-when="transfer_received">\n      <a href="/consignment/{{ $ctrl.movement.event_id }}" target="_blank" class="vd-link vd-link--secondary">\n        Transfer Received\n      </a>\n    </span>\n    <span ng-switch-when="transfer_reversal">\n      <a href="/consignment/{{ $ctrl.movement.event_id }}" target="_blank" class="vd-link vd-link--secondary">\n        Transfer (Adjustment)\n      </a>\n    </span>\n    <span ng-switch-when="transfer_cancelled">\n      <a href="/consignment/{{ $ctrl.movement.event_id }}" target="_blank" class="vd-link vd-link--secondary">\n        Transfer (Cancelled)\n      </a>\n    </span>\n    <span ng-switch-when="supplier_return">\n      <a href="/consignment/{{ $ctrl.movement.event_id }}" target="_blank" class="vd-link vd-link--secondary">\n        Supplier Return\n      </a>\n    </span>\n    <span ng-switch-when="stocktake_added">\n      <a href="/inventory_count/{{ $ctrl.movement.event_id }}" target="_blank" class="vd-link vd-link--secondary">\n        Inventory Count (Gain)\n      </a>\n    </span>\n    <span ng-switch-when="stocktake_removed">\n      <a href="/inventory_count/{{ $ctrl.movement.event_id }}" target="_blank" class="vd-link vd-link--secondary">\n        Inventory Count (Loss)\n      </a>\n    </span>\n    <span ng-switch-when="sale">\n      <a href="/order?sale_id={{ $ctrl.movement.event_id }}#{{ $ctrl.movement.event_id }}"\n        target="_blank"\n        class="vd-link vd-link--secondary">\n        Sale\n      </a>\n    </span>\n    <span ng-switch-when="sale_reversal">\n      <a href="/order?sale_id={{ $ctrl.movement.event_id }}#{{ $ctrl.movement.event_id }}"\n        target="_blank"\n        class="vd-link vd-link--secondary">\n        Sale (Adjustment)\n      </a>\n    </span>\n    <span ng-switch-when="return">\n      <a href="/order?sale_id={{ $ctrl.movement.event_id }}#{{ $ctrl.movement.event_id }}"\n        target="_blank"\n        class="vd-link vd-link--secondary">\n        Sale Return\n      </a>\n    </span>\n    <span ng-switch-when="return_reversal">\n      <a href="/order?sale_id={{ $ctrl.movement.event_id }}#{{ $ctrl.movement.event_id }}"\n        target="_blank"\n        class="vd-link vd-link--secondary">\n        Return (Adjustment)\n      </a>\n    </span>\n    <span ng-switch-when="manual_adjustment_added">Inventory Edit (Added)</span>\n    <span ng-switch-when="manual_adjustment_removed">Inventory Edit (Removed)</span>\n    <span ng-switch-default>Unknown ({{ $ctrl.movement.event_type }})</span>\n</span>',controller:function(){var e=this;this.eventType=function(){var t=e.movement.event_type;switch(t){case"manual_adjustment":return"MANUAL_ADJUSTMENT"===e.movement.source_location_type?"manual_adjustment_added":"manual_adjustment_removed";case"stocktake":return"STOCKTAKE"===e.movement.source_location_type?"stocktake_added":"stocktake_removed";case"supplier_order":return"TRANSIT_SUPPLIER"===e.movement.source_location_type?"supplier_order_received":"supplier_order_sent";case"transfer":return"TRANSIT_TRANSFER"===e.movement.source_location_type?"transfer_received":"transfer_sent"}return t}}}});angular.module("reports.directives").directive("vrProductMovementLocation",function(){return{scope:{locationId:"<",eventId:"<",quantityAfter:"<",change:"<",type:"<",outlets:"<",customers:"<",suppliers:"<",sales:"<"},restrict:"E",bindToController:!0,controllerAs:"$ctrl",template:'<div>\n    <span>\n      {{ $ctrl.title() }}\n      <vd-flag category="{{$ctrl.getFlagCategory()}}" ng-if="$ctrl.quantityAfter !== undefined">\n        {{$ctrl.quantityBefore()}} <span class=\'vd-flag-chevron\' /> {{$ctrl.quantityAfter}}\n      </vd-flag>\n    </span>\n    <br>\n    <span class="vd-text-supplementary vd-text--secondary" ng-if="$ctrl.content().length">{{ $ctrl.content() }}</span>\n</div>',controller:function(){var e=this;this.customer=function(t){var r=e.sales[t];if(r){var n=e.customers[r.customer_id];if("WALKIN"!==n.customer_code)return n}}(this.eventId),this.quantityBefore=function(){return this.quantityAfter-this.change},this.getFlagCategory=function(){return this.quantityAfter<0?"negative":""},this.details=function(){switch(e.type){case"OUTLET":case"COST_ADJUSTMENT":return{title:e.outlets[e.locationId].name,content:"On Hand"};case"BOOTSTRAP":return{title:"Previous Inventory System"};case"CUSTOMER":return e.customer&&e.customer.name?{title:e.customer.name,content:"Customer"}:{title:"Customer"};case"LAYBY":return{title:e.customer.name,content:"Layby"};case"MANUAL_ADJUSTMENT":return{title:"Manual Adjustment"};case"NO_SUPPLIER":return{title:"Supplier"};case"SUPPLIER":return{title:e.suppliers[e.locationId].name,content:"Supplier"};case"TRANSIT_SUPPLIER":var t=e.outlets[e.locationId];return t||(t=e.suppliers[e.locationId]),{title:t.name,content:"In Transit"};case"TRANSIT_TRANSFER":return{title:e.outlets[e.locationId].name,content:"In Transit"};case"STOCKTAKE":return{title:e.outlets[e.locationId].name,content:"Inventory Count"};case"OUTLET_OVERAGE":return{title:e.outlets[e.locationId].name,content:"Overage"};case"PRODUCTION_SINK":return{title:"Composite Produced"}}return{title:"Unknown"}},this.title=function(){return e.details().title},this.content=function(){return e.details().content||""}}}});angular.module("reports.directives").directive("vrProductMovementsTable",function(){return{scope:{dateSelection:"<",product:"<",movementsPayload:"<",isLoadingNewReport:"<",isLoadingMore:"<",showLoadMore:"<",loadMore:"&"},restrict:"E",bindToController:!0,controllerAs:"$ctrl",template:'<vd-section>\n    <span class="vd-text--secondary vd-text-supplementary">\n      Showing movements from from {{ $ctrl.dateRangeFilter($ctrl.dateSelection) }}\n    </span>\n    \x3c!-- Product movements table section --\x3e\n    <table class="vd-table">\n      <thead>\n        <tr>\n          <th class="vd-no-pad-l" width="170">Date</th>\n          <th ng-if="$ctrl.product.has_variants" width="180">Variant</td>\n          <th vd-align="left">Movement</th>\n          <th vd-align="left">From</th>\n          <th ng-repeat-end vd-align="left">To</th>\n          <th vd-align="right" class="vd-no-pad-r">Quantity</th>\n        </tr>\n      </thead>\n      <tbody>\n        <tr ng-if="$ctrl.isLoadingNewReport && !$ctrl.isLoadingMore"\n          vr-basic-report-table-data-loader\n          columns="!$ctrl.product.has_variants ? 5 : 6">\n        </tr>\n        <tr ng-if="!$ctrl.isLoadingNewReport && $ctrl.movementsPayload.movements.length == 0">\n          <td vd-align="center" ng-attr-colspan="{{ !$ctrl.product.has_variants ? 5 : 6 }}">\n            No movements for the selected timeframe\n          </td>\n        </tr>\n        <tr ng-if="!$ctrl.isLoadingNewReport || $ctrl.isLoadingMore"\n          ng-repeat="movement in $ctrl.movementsPayload.movements">\n          <td class="vd-no-pad-l">\n            <span>{{:: movement.occurred_at | vendGranularityDate:"MMM D, YYYY" }}</span>\n            <span class="vd-text--secondary">{{:: movement.occurred_at | vendGranularityDate:"HH:mm" }}</span>\n          </td>\n          <td ng-if="$ctrl.product.has_variants">\n            {{ $ctrl.products[movement.product_id].variant_options | variantOptions  }}\n          </td>\n          <td vd-align="left">\n            <vr-product-movement-event movement="movement"></vr-product-movement-event>\n          </td>\n          <td vd-align="left">\n            <vr-product-movement-location location-id="movement.source_location_id"\n              event-id="movement.event_id"\n              quantity-after="movement.source_quantity_after"\n              change="movement.amount * -1"\n              type="movement.source_location_type"\n              suppliers="$ctrl.movementsPayload.suppliers"\n              outlets="$ctrl.movementsPayload.outlets"\n              sales="$ctrl.movementsPayload.sales"\n              customers="$ctrl.movementsPayload.customers">\n            </vr-product-movement-location>\n          </td>\n          <td vd-align="left">\n            <vr-product-movement-location location-id="movement.dest_location_id"\n              event-id="movement.event_id"\n              quantity-after="movement.dest_quantity_after"\n              change="movement.amount"\n              type="movement.dest_location_type"\n              suppliers="$ctrl.movementsPayload.suppliers"\n              outlets="$ctrl.movementsPayload.outlets"\n              sales="$ctrl.movementsPayload.sales"\n              customers="$ctrl.movementsPayload.customers">\n            </vr-product-movement-location>\n          </td>\n          <td vd-align="right" class="vd-no-pad-r">{{:: movement.amount | number }}</td>\n        </tr>\n      </tbody>\n    </table>\n    <div vd-flex vd-flex-justify="center" vd-flex-align="center" ng-if="$ctrl.showLoadMore" class="vd-mtl">\n        <vd-load-more action="$ctrl.loadMore()"\n          is-loading="$ctrl.isLoadingMore"\n          label-text="Showing last {{ $ctrl.movementsPayload.movements.length }} movements">\n        </vd-load-more>\n    </div>\n</vd-section>',controller:["vendGranularityDateRangeFilter",function(e){this.products=this.movementsPayload.products,this.dateRangeFilter=function(t){return e(t.getPeriodStartDate(),t.getPeriodEndDate(),"Do MMM YYYY","to")}}]}});angular.module("reports.directives").directive("vrStoreCreditReportTableSummary",function(){return{scope:{storeCreditData:"="},restrict:"E",bindToController:!0,controllerAs:"vrStoreCreditReportTableSummaryCtrl",template:'<vd-section>\n    <div class="vd-flex">\n      <div class="vd-col-6 vd-prl">\n        <vr-basic-report-table-summary-item\n          name="\'Total Value Issued\'"\n          value-is-currency="true"\n          value="vrStoreCreditReportTableSummaryCtrl.storeCreditData.storeCreditTotals.totalValueIssued">\n        </vr-basic-report-table-summary-item>\n      </div>\n\n      <div class="vd-col-6 vd-pll">\n        <vr-basic-report-table-summary-item\n          name="\'Total Value Redeemed\'"\n          value-is-currency="true"\n          value="\n            vrStoreCreditReportTableSummaryCtrl.storeCreditData.storeCreditTotals.totalValueRedeemed">\n        </vr-basic-report-table-summary-item>\n      </div>\n    </div>\n\n    <div class="vd-flex">\n      <div class="vd-col-6 vd-prl">\n        <vr-basic-report-table-summary-item\n          name="\'Outstanding Balance\'"\n          value-is-currency="true"\n          value="\n            vrStoreCreditReportTableSummaryCtrl.storeCreditData.storeCreditTotals.outstandingBalance"\n          last-row="true">\n        </vr-basic-report-table-summary-item>\n      </div>\n\n      \x3c!-- Required as a place holder for the right had summary value --\x3e\n      \x3c!-- This is to ensure flex still behaves as expected --\x3e\n      <div class="vd-col-6 vd-pll"></div>\n\n    </div>\n</vd-section>',controller:function(){}}});angular.module("reports.directives").directive("vrStoreCreditReportTable",function(){return{scope:{storeCreditData:"="},restrict:"E",bindToController:!0,controllerAs:"vrStoreCreditReportTableCtrl",template:'<vd-section>\n\n    \x3c!-- Store credit summary section --\x3e\n    <vr-store-credit-report-table-summary store-credit-data="vrStoreCreditReportTableCtrl.storeCreditData">\n    </vr-store-credit-report-table-summary>\n\n    <vd-section type="tertiary" ng-if="vrStoreCreditReportTableCtrl.storeCreditData.failedPosts.length">\n      <vr-store-credits-failed-postings\n        failed-posts="vrStoreCreditReportTableCtrl.storeCreditData.failedPosts">\n        </vr-store-credits-failed-postings>\n    </vd-section>\n\n    \x3c!-- Store credit table section --\x3e\n    <table class="vd-table vd-table--compact vd-table--fixed vd-table--report vd-table--expandable">\n      <thead>\n        <tr>\n          <th>Customer</th>\n          <th vd-align="right">Total issued</th>\n          <th vd-align="right">Total redeemed</th>\n          <th vd-align="right">Balance</th>\n        </tr>\n      </thead>\n      <tbody vr-store-credit-report-table-row store-credit-data="vrStoreCreditReportTableCtrl.storeCreditData">\n      </tbody>\n    </table>\n</vd-section>',controller:function(){}}});angular.module("reports.directives").directive("vrStoreCreditReportTableExpanded",function(){return{scope:{selectedRecord:"=",storeCreditData:"="},restrict:"E",bindToController:!0,controllerAs:"vrStoreCreditReportTableExpandedCtrl",template:'<table class="vd-table vd-table--compact vd-table--fixed">\n    <thead>\n      <tr class="vd-no-border-t vd-no-border-l vd-no-border-r vd-border-b">\n        <th class="vd-no-pad-t vd-text--secondary vd-text--sub">Date</th>\n        <th class="vd-no-pad-t vd-text--secondary vd-text--sub">Transaction</th>\n        <th class="vd-no-pad-t vd-text--secondary vd-text--sub" width="40%">Notes</th>\n        <th class="vd-no-pad-t vd-text--secondary vd-text--sub" vd-align="right">Amount</th>\n      </tr>\n    </thead>\n    <tbody>\n      <tr ng-repeat="transaction in vrStoreCreditReportTableExpandedCtrl.selectedRecord.store_credit_transactions |\n        orderBy: \'-created_at\'">\n        <td>\n          <span>{{ ::transaction.created_at | vendGranularityDate:"MMM D, YYYY" }}</span>\n          <span class="vd-text--secondary">{{ ::transaction.created_at | vendGranularityDate:"HH:mm" }}</span>\n        </td>\n        <td>\n          <span>{{ ::vrStoreCreditReportTableExpandedCtrl.translateTransactionType(transaction) }}</span>\n          <span ng-if="transaction.sale_id">\n            (<a ng-href="/history?sale_id={{transaction.sale_id}}#{{transaction.sale_id}}"\n              class="vd-link">View Sale\n            </a>)\n          </span>\n        </td>\n        <td>\n          <div class="vd-text--honour-line-break">{{ transaction.notes ? transaction.notes : \'&mdash;\' }}</div>\n        </td>\n        <td vd-align="right">{{ ::transaction.amount | vdCurrencyFilter }}</td>\n      </tr>\n    </tbody>\n</table>',controller:function(){var e={ISSUE:"Issued",REDEMPTION:"Redeemed",REVERSE:"Cancelled"};this.translateTransactionType=function(t){return e[t.type]}}}});angular.module("reports.directives").directive("vrStoreCreditReportTableRow",function(){return{scope:{storeCreditData:"="},restrict:"A",bindToController:!0,controllerAs:"vrStoreCreditReportTableRowCtrl",template:'\x3c!-- Table loader while syncing store credit data --\x3e\n<tr ng-if="vrStoreCreditReportTableRowCtrl.storeCreditData.waiting"\n    vr-basic-report-table-data-loader\n    columns="4">\n</tr>\n\n\x3c!-- If no results are returned by the API --\x3e\n<tr ng-if="!vrStoreCreditReportTableRowCtrl.storeCreditData.storeCreditRecords.length &&\n    !vrStoreCreditReportTableRowCtrl.storeCreditData.waiting"\n    class="vd-inactive">\n    <td colspan="4">\n      No store credit data available\n    </td>\n</tr>\n\n\n<tr ng-if="vrStoreCreditReportTableRowCtrl.storeCreditData.storeCreditRecords.length"\n    ng-repeat-start="storeCreditRecord in vrStoreCreditReportTableRowCtrl.storeCreditData.storeCreditRecords"\n    class="vd-expandable"\n    ng-class="{\n      \'vd-expandable--expanded vd-border-t\':\n        vrStoreCreditReportTableRowCtrl.selectedRecord.id === storeCreditRecord.id\n    }"\n    ng-click="vrStoreCreditReportTableRowCtrl.toggleSelectedRecord(storeCreditRecord)">\n    <td>\n      <a ng-click="vrStoreCreditReportTableRowCtrl.viewCustomer($event, storeCreditRecord.customer_id)"\n        class="vd-link">{{ vrStoreCreditReportTableRowCtrl.getCustomerName(storeCreditRecord.customer) }}\n      </a>\n    </td>\n    <td vd-align="right">{{ ::storeCreditRecord.total_credit_issued | vdCurrencyFilter }}</td>\n    <td vd-align="right">{{ ::storeCreditRecord.total_credit_redeemed | vdCurrencyFilter }}</td>\n    <td vd-align="right">{{ ::storeCreditRecord.balance | vdCurrencyFilter }}</td>\n</tr>\n\n<tr ng-repeat-end\n    ng-class="{\'vd-border-b\': vrStoreCreditReportTableRowCtrl.selectedRecord.id === storeCreditRecord.id}">\n    <td colspan="4">\n      <vr-store-credit-report-table-expanded\n        ng-if="vrStoreCreditReportTableRowCtrl.selectedRecord.id === storeCreditRecord.id"\n        selected-record="vrStoreCreditReportTableRowCtrl.selectedRecord"\n        store-credit-data="vrStoreCreditReportTableRowCtrl.storeCreditData">\n      </vr-store-credit-report-table-expanded>\n    </td>\n</tr>',controller:["$window","vdTracking",function(e,t){var r=this,n={moduleName:"Store Credit Report"};this.getCustomerName=function(e){return e?e.name:"Customer"},this.viewCustomer=function(t,r){t.stopPropagation(),e.location.assign("/customer/".concat(r))},this.toggleSelectedRecord=function(e){r.selectedRecord&&r.selectedRecord.id===e.id?r.selectedRecord=null:(r.selectedRecord=e,n.eventName="Store credit record expanded",t.trackUserEvent(n))}}]}});var Ha=function(e){return e&&e.__esModule?e:{default:e}}(require("d3"));angular.module("reports.directives").directive("barChart",["$window",function(e){return{restrict:"E",scope:{data:"=",config:"="},link:function(t,r,n){t.$watch("data",function(){return a()});var a=function(){var e=t.data;e&&t.redraw(e)},i=r[0],o=t.config.valFormatter,s=20,l=20,c=0,u=20,d=Ha.default.select(i.parentElement).node().offsetWidth,f=d-u-s,p=Ha.default.scale.linear().range([0,f]),v=Ha.default.svg.axis().scale(p).orient("top"),g=function(e){return e.val},h=function(e){return e.key},m=function(){return 0},y=Ha.default.select(i).append("svg").attr("width",d).attr("height",25+c+l).attr("class","bar-label chart bar-chart").attr("font-family","sans-serif").attr("font-size","11px").attr("fill","black").attr("perserveAspectRatio","xMinYMid"),b=y.append("g").attr("transform","translate(".concat(u,",").concat(c,")")),w=b.append("g").attr("class","bars");b.append("g").attr("class","y axis"),t.redraw=function(e){var t=Ha.default.max(e,g),r=25*e.length+c+l,n=Ha.default.select(i.parentElement).node().offsetWidth,a=n-u-s,d=Math.max(a,0);y.attr("height",r+c+l).attr("width",n).attr("viewBox","0 0 ".concat(n," ").concat(r));var f=Ha.default.scale.ordinal().rangeBands([0,r],.32),p=Ha.default.scale.linear().range([0,a]),D=Ha.default.svg.axis().scale(f).orient("right");p.domain([0,t+t/3]),f.domain(e.map(h)),b.select(".x.axis").transition().duration(500).ease("sin-in-out").call(v),f.domain(e.map(h)),b.select(".y.axis").transition().duration(500).ease("sin-in-out").call(D);var _=w.selectAll(".barContainer").data(e,h),C=_.enter().append("g").attr("class","barContainer");C.append("rect").attr("class","bar-chart-background").attr("x",m).attr("y",f.rangeBand()).attr("rx","2").attr("ry","2").attr("width",function(e,t){return d}),C.append("rect").attr("class","bar positive").attr("x",m).text(g),C.append("rect").attr("width",1).attr("class","top"),C.append("text").text(function(e){return function(e){return e}(e.val)}).attr("x",0).attr("width",n).attr("dy",12).attr("class","bar-label").attr("text-anchor","end"),_.select("text.bar-label").attr("x",function(e,t){return n-u-s-10}),_.select("text.bar-label").attr("y",function(e){return f(e.key)+3}).text(function(e){return o(e.val)}),_.select(".bar").transition().duration(500).attr("width",function(e){return Math.abs(p(e.val))}).attr("y",function(e){return f(e.key)}).attr("height",f.rangeBand()),_.select(".top").transition().duration(500).attr("x",function(e){return Math.floor(p(e.val))}).attr("y",function(e){return f(e.key)}).attr("height",f.rangeBand()),_.select(".bar-chart-background").attr("y",function(e){return f(e.key)}).attr("height",f.rangeBand()).attr("width",d),_.exit().remove()},angular.element(e).on("resize",a),t.$on("$destroy",function(){return angular.element(e).off("resize",a)})}}}]);var Wa=function(e,t){return e&&Sn(e,t,qt)};var Qa=function(e,t){return function(r,n){if(null==r)return r;if(!Ut(r))return e(r,n);for(var a=r.length,i=t?a:-1,o=Object(r);(t?i--:++i<a)&&!1!==n(o[i],i,o););return r}}(Wa);var Xa=function(e,t){var r=-1,n=Ut(e)?Array(e.length):[];return Qa(e,function(e,a,i){n[++r]=t(e,a,i)}),n};var Za=function(e,t){return(Je(e)?Pr:Xa)(e,Jr(t,3))},Ja=ti(require("d3")),ei=ti(Za);function ti(e){return e&&e.__esModule?e:{default:e}}angular.module("reports.directives").directive("chartLineTime",["$window","Metrics",function(e,t){return{restrict:"E",scope:{data:"=",config:"="},link:function(r,n,a){r.$watch("data",function(e){e&&(e.length,r.redraw())});var i=r.config.tooltipDateFormatter,o=r.config.tooltipValueFormatter,s=r.config.xAxisTickFormatter,l=[],c=0,u=0,d=0,f=0,p=Ja.default.select(n[0].parentElement).node().offsetWidth-f-u,v=parseInt(a.height)-c-d,g=Ja.default.time.scale.utc().range([-10,p-25]),h=Ja.default.scale.linear().range([v-45,0]),m=function(e){return g(e.key)},y=function(e){return h(e.val)},b=Ja.default.svg.axis().scale(h).ticks(4).orient("right").tickFormat(function(e){return e>1e3?Ja.default.format(".1dk")(e/1e3)+"k":e}),w=Ja.default.svg.line().interpolate("linear").x(m).y(y),D=Ja.default.svg.area().x(m).y0(v-45).y1(y),_=Ja.default.select(n[0]).append("svg").style("width","100%").attr("height",v).attr("perserveAspectRatio","xMinYMid").attr("class","line-chart chart");_.append("g").attr("transform","translate(".concat(f,",").concat(c,")")),_.append("rect").attr({class:"bg",width:"100%",height:v-45}),_.selectAll("line.horizontalGrid").data(h.ticks(4)).enter().append("line").attr({class:"horizontalGrid",x1:0,x2:p-f-u,y1:function(e){return h(e)},y2:function(e){return h(e)},fill:"none","shape-rendering":"crispEdges",stroke:"#D7D7D7","stroke-width":"1px"});var C=_.append("path"),S=_.append("path");_.append("g").attr("class","x axis").attr("transform","translate(0, ".concat(v-45,")")),C.data([]).attr("class","line").attr("d",w),S.data([]).attr("class","fill").attr("d",D),_.append("g").attr("class","y axis");var k=Ja.default.select("body").append("aside").attr("class","popover").style("display","none"),R=Ja.default.bisector(function(e){return e.key}).right;_.append("rect").attr({class:"overlay",width:"100%",height:v}).on("mouseover",function(){return k.style("display","block"),void t.increment("widget_tooltip",{tags:["interaction:hover"]})}).on("mouseout",function(){return k.style("display","none")}).on("mousemove",function(){var e=$(_[0][0]).offset(),t=g.invert(Ja.default.mouse(this)[0]),r=R(l,t,1);1===r&&(r=2);var n=l[r-1],a=l[r];if(a){var s=t-n.key>a.key-t?a:n;k.html("<h1>".concat(o(s.val),"</h1><h2>").concat(i(s.key),"</h2>"));var c=g(s.key)+e.left,u=h(s.val)+e.top+15;k.style("margin-top",-1*v+14+"px").style("left",c+"px").style("top",u+"px")}}),r.redraw=function(){var e=r.data;if(e){p=Ja.default.select(n[0].parentElement).node().offsetWidth-f-u,g=Ja.default.time.scale.utc().range([-10,p-25]),e.forEach(function(e){e.key=Number(e.key)}),l=e;var t=Ja.default.extent(e,function(e){return e.key});g.domain(t);var a=Ja.default.time.scale.utc().domain(t).range([-10,p-25]),i=(0,ei.default)(e,"key"),o=Ja.default.svg.axis().scale(a).orient("bottom").tickValues(i).tickFormat(function(e){return s(e)}),c=Ja.default.max(e,function(e){return e.val}),d=Ja.default.min(e,function(e){return e.val});h.domain([d,1.1*c]),_.selectAll("circle.dot").remove(),C.datum(e).attr("class","line").attr("d",w),S.datum(e).attr("class","fill").attr("d",D),_.select(".x.axis").call(o).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy","-.1em").attr("transform",function(e){return"rotate(-45)"}).attr("opacity",0).transition().duration(500).ease("sin-in-out").attr("opacity",1),_.select(".y.axis").transition().duration(500).ease("sin-in-out").call(b),_.selectAll("line.horizontalGrid").attr({x2:p-f-u}),_.select("rect.bg").attr({width:"100%"});var v=_.selectAll(".dot").data(e);v.enter().append("circle").attr("class","dot").attr("r",4).attr("cx",m).attr("cy",y),v.exit().remove()}},angular.element(e).on("resize",r.redraw),r.$on("$destroy",function(){k.remove(),angular.element(e).off("resize",r.redraw())})}}}]);var ri=0;var ni=function(e){var t=++ri;return Ir(e)+t},ai=function(e){return e&&e.__esModule?e:{default:e}}(ni);angular.module("reports.directives").directive("checkbox",function(){return{replace:!0,restrict:"E",scope:{value:"=",label:"="},template:'<div class="basic-checkbox"> <input type="checkbox" ng-model="value" id="id" /> <label for="id">{{label}}</label> </div>',controller:["$scope",function(e){e.id=(0,ai.default)("cb-")}]}});var ii=function(e,t){var r=[];return Qa(e,function(e,n,a){t(e,n,a)&&r.push(e)}),r};var oi=function(e,t){return(Je(e)?tt:ii)(e,Jr(t,3))},si="[object String]";var li=function(e){return"string"==typeof e||!Je(e)&&st(e)&&x(e)==si},ci=Qr("length"),ui=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");var di=function(e){return ui.test(e)},fi="[\\ud800-\\udfff]",pi="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",vi="\\ud83c[\\udffb-\\udfff]",gi="[^\\ud800-\\udfff]",hi="(?:\\ud83c[\\udde6-\\uddff]){2}",mi="[\\ud800-\\udbff][\\udc00-\\udfff]",yi="(?:"+pi+"|"+vi+")"+"?",bi="[\\ufe0e\\ufe0f]?"+yi+("(?:\\u200d(?:"+[gi,hi,mi].join("|")+")[\\ufe0e\\ufe0f]?"+yi+")*"),wi="(?:"+[gi+pi+"?",pi,hi,mi,fi].join("|")+")",Di=RegExp(vi+"(?="+vi+")|"+wi+bi,"g");var _i=function(e){for(var t=Di.lastIndex=0;Di.test(e);)++t;return t};var Ci=function(e){return di(e)?_i(e):ci(e)},Si="[object Map]",ki="[object Set]";var Ri=function(e){if(null==e)return 0;if(Ut(e))return li(e)?Ci(e):e.length;var t=ir(e);return t==Si||t==ki?e.size:Lt(e).length},Ti=Mi(oi),xi=Mi(Ri);function Mi(e){return e&&e.__esModule?e:{default:e}}angular.module("reports.directives").directive("checkboxDropdown",function(){return{scope:{items:"=",open:"=",onSubmit:"&"},restrict:"E",replace:!0,template:'<div class="dropdown datatable-filter" ng-class="{open: open}">\n    <div class="dropdown-overlay" ng-click="toggle()"></div>\n    <a ng-click="toggle()" class="button datatable-filter-button">\n      <span class="chevron down chevron--thick" ng-class="{up: open}"></span>\n    </a>\n    <div class="f-dropdown datatable-filter-dropdown drop-down content large">\n      <form name="optionalSelectionForm"\n            class="datatable-filter-form"\n            ng-submit="onSubmit()"\n            ng-if="items.length">\n        <ul class="dropdown-checklist" id="datatable-filter">\n          <li class="dropdown-checklist-option">\n            <label class="checkbox-label">\n              <input ng-model="checkboxModel.selectedAll"\n                     ng-change="toggleSelectAll()"\n                     class="checkbox"\n                     type="checkbox">\n              <i class="icon checkbox-icon"></i>All\n            </label>\n          </li>\n          <li class="dropdown-checklist-sub-options-container">\n            <ul class="dropdown-checklist-sub-options">\n              <li class="dropdown-checklist-option" ng-repeat="filterItem in items">\n                <label class="checkbox-label">\n                  <input class="checkbox"\n                         ng-model="filterItem.selected"\n                         ng-change="onToggleItemSelect()"\n                         type="checkbox">\n                  <i class="icon checkbox-icon"></i>{{filterItem.name}}\n                </label>\n              </li>\n            </ul>\n          </li>\n        </ul>\n        <div class="datatable-filter-form-actions">\n          <input type="submit" class="vend-button date-selector-submit" value="Apply"/>\n        </div>\n      </form>\n    </div>\n</div>',controller:["$scope",function(e){e.open=!1,e.checkboxModel={selectedAll:!1};e.toggle=function(){e.open=!e.open},e.toggleSelectAll=function(){return e.items.forEach(function(t){t.selected=e.checkboxModel.selectedAll})},e.onToggleItemSelect=function(){var t,r=(t=e.items,(0,Ti.default)(t,"selected",!0));e.checkboxModel.selectedAll=function(t){return(0,xi.default)(t)===(0,xi.default)(e.items)}(r)},e.onToggleItemSelect()}]}});angular.module("reports.directives").directive("dashboardOverlay",function(){return{scope:{canAccessDashboard:"="},transclude:!0,restrict:"E",template:'<div class="dashboard-overlay" ng-class="{ \'dashboard-overlay--toggled\': !canAccessDashboard }"> <ng-transclude></ng-transclude> </div>'}});angular.module("reports.directives").directive("dashboardUpgradeNotification",function(){return{replace:!0,restrict:"E",template:'<div ng-if="show" class="alert-box alert-box--flex alert-box--light alert-box--upgrade"> <div class="alert-box-content"> <h1 class="alert-box-heading"> Upgrade today to enjoy Advanced Reporting </h1> <p class="alert-box-body"> Our mobile-friendly Retail Dashboard is only available as part of Advanced Reporting. <a href="/account" ng-click="showUpgradeSplash($event)">Learn more about Advanced Reporting</a>. </p> </div> </div>',controller:["$scope","vdSplashService","PermissionsService",function(e,t,r){e.showUpgradeSplash=function(r){r.preventDefault(),t.openSplash("partials/upgrade.html",e,{dismissible:!0})},e.show=!r.canAccessDashboard()}]}});angular.module("reports.directives").directive("gridElement",function(){return{scope:{col:"=",data:"="},restrict:"E",link:function(e,t,r){var n=e.col.value(e.data);"number"==typeof n&&(n=n.toString()),t.append(n)}}}),angular.module("reports.directives").directive("reportGrid",function(){return{scope:{data:"=",config:"="},restrict:"E",template:'<table> <thead> <tr> <th ng-repeat="column in config.columns">{{column.name}}</th> </tr> </thead> <tbody> <tr ng-repeat="row in data"> <td ng-repeat="column in config.columns"> <grid-element col="column" data="row"></grid-element> </td> </tr> <tr ng-if="!data.length"> <td colspan="{{config.columns.length}}"> <div class="no-results">{{config.noResultsMessage}}</div> </td> </tr> </tbody> </table>',controller:["$scope",function(e){e.config.noResultsMessage||(e.config.noResultsMessage="There is no data for this view.")}]}});angular.module("reports.directives").directive("datatableExport",["BlobDownload","ReportData","RequestHandler","DefinitionEventData","DimensionDefinitionsService","byteSizeFilter","vdTracking",function(e,t,r,n,a,i,o){return{scope:{definition:"="},replace:!0,template:'<a class="button vend-button vend-button--info" ng-click="download()"> {{label()}} </a>',controller:["$scope",function(s){var l=!("download"in document.createElement("a")),c={moduleName:"Report Datatable",eventName:"Report exported"},u=function(){s.loading=!1,s.generating=!1,s.progress=null};u(),s.label=function(){return s.progress?s.progress:s.generating?"Generating CSV":"Export Data"};var d=function(){var e=s.definition.queryDefinition();if(f(e),s.definition.report.hasDateFilter()){var t=a.findByKey(s.definition.granularityDateSelection.granularity.key);t&&e.addDimension("column",t)}return e.size=0,e},f=function(e){["row","column"].forEach(function(t){var r=!0,n=!1,i=void 0;try{for(var o,s=e.dimensions[t][Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var l=o.value,c=a.findByKey(l.key);null!=c.exportMetadata&&(l.metadata=c.exportMetadata)}}catch(u){n=!0,i=u}finally{try{r||null==s.return||s.return()}finally{if(n)throw i}}})};s.download=function(){if(!0!==s.loading){var a,f;s.loading=!0,l&&p(),a=new n(s.definition),(f=angular.copy(c)).metadata=a.getEventMetadata(),o.trackUserEvent(f),s.generating=!0;var v=s.definition.identifier()+".csv",g=t.get(d(),"csv");r.handle(g,{display_error:!0,error_message:"Sorry, we couldnâ€™t fetch some data. Please refresh this page and try again."}),g.then(function(t){var r=t.getResponseHeader("Content-Disposition").match(/filename="([^"]+)"/);r&&2===r.length&&(v=r[1]),new e(t.response,v).download(),u()},function(){u()}),g.progress=function(e){var t=e.total;if(e.lengthComputable||(t=parseInt(e.srcElement.getResponseHeader("X-Uncompressed-Content-Length"))),t>0){var r=(e.loaded/t*100).toFixed(0);s.progress="Downloading CSV ".concat(r,"%")}else s.progress="Downloading ".concat(i(e.loaded));s.$digest()}}};var p=function(){window.location.href=t.link(d(),"csv")}}]}}]);var Oi=function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(!t(e[r],r,e))return!1;return!0};var Ai=function(e,t){var r=!0;return Qa(e,function(e,n,a){return r=!!t(e,n,a)}),r};var Pi=function(e,t,r){var n=Je(e)?Oi:Ai;return r&&fa(e,t,r)&&(t=void 0),n(e,Jr(t,3))};var Ei=function(e,t,r,n){for(var a=-1,i=null==e?0:e.length;++a<i;){var o=e[a];t(n,o,r(o),e)}return n};var $i=function(e,t,r,n){return Qa(e,function(e,a,i){t(n,e,r(e),i)}),n};var ji=function(e,t){return function(r,n){var a=Je(r)?Ei:$i,i=t?t():{};return a(r,e,Jr(n,2),i)}},Fi=Object.prototype.hasOwnProperty,Ii=ji(function(e,t,r){Fi.call(e,r)?e[r].push(t):_n(e,r,[t])});var Gi=function(e,t,r,n){var a=-1,i=null==e?0:e.length;for(n&&i&&(r=e[++a]);++a<i;)r=t(r,e[a],a,e);return r};var Bi=function(e){return function(t){return null==e?void 0:e[t]}}({"Ã€":"A","Ã":"A","Ã‚":"A","Ãƒ":"A","Ã„":"A","Ã…":"A","Ã ":"a","Ã¡":"a","Ã¢":"a","Ã£":"a","Ã¤":"a","Ã¥":"a","Ã‡":"C","Ã§":"c","Ã":"D","Ã°":"d","Ãˆ":"E","Ã‰":"E","ÃŠ":"E","Ã‹":"E","Ã¨":"e","Ã©":"e","Ãª":"e","Ã«":"e","ÃŒ":"I","Ã":"I","ÃŽ":"I","Ã":"I","Ã¬":"i","Ã­":"i","Ã®":"i","Ã¯":"i","Ã‘":"N","Ã±":"n","Ã’":"O","Ã“":"O","Ã”":"O","Ã•":"O","Ã–":"O","Ã˜":"O","Ã²":"o","Ã³":"o","Ã´":"o","Ãµ":"o","Ã¶":"o","Ã¸":"o","Ã™":"U","Ãš":"U","Ã›":"U","Ãœ":"U","Ã¹":"u","Ãº":"u","Ã»":"u","Ã¼":"u","Ã":"Y","Ã½":"y","Ã¿":"y","Ã†":"Ae","Ã¦":"ae","Ãž":"Th","Ã¾":"th","ÃŸ":"ss","Ä€":"A","Ä‚":"A","Ä„":"A","Ä":"a","Äƒ":"a","Ä…":"a","Ä†":"C","Äˆ":"C","ÄŠ":"C","ÄŒ":"C","Ä‡":"c","Ä‰":"c","Ä‹":"c","Ä":"c","ÄŽ":"D","Ä":"D","Ä":"d","Ä‘":"d","Ä’":"E","Ä”":"E","Ä–":"E","Ä˜":"E","Äš":"E","Ä“":"e","Ä•":"e","Ä—":"e","Ä™":"e","Ä›":"e","Äœ":"G","Äž":"G","Ä ":"G","Ä¢":"G","Ä":"g","ÄŸ":"g","Ä¡":"g","Ä£":"g","Ä¤":"H","Ä¦":"H","Ä¥":"h","Ä§":"h","Ä¨":"I","Äª":"I","Ä¬":"I","Ä®":"I","Ä°":"I","Ä©":"i","Ä«":"i","Ä­":"i","Ä¯":"i","Ä±":"i","Ä´":"J","Äµ":"j","Ä¶":"K","Ä·":"k","Ä¸":"k","Ä¹":"L","Ä»":"L","Ä½":"L","Ä¿":"L","Å":"L","Äº":"l","Ä¼":"l","Ä¾":"l","Å€":"l","Å‚":"l","Åƒ":"N","Å…":"N","Å‡":"N","ÅŠ":"N","Å„":"n","Å†":"n","Åˆ":"n","Å‹":"n","ÅŒ":"O","ÅŽ":"O","Å":"O","Å":"o","Å":"o","Å‘":"o","Å”":"R","Å–":"R","Å˜":"R","Å•":"r","Å—":"r","Å™":"r","Åš":"S","Åœ":"S","Åž":"S","Å ":"S","Å›":"s","Å":"s","ÅŸ":"s","Å¡":"s","Å¢":"T","Å¤":"T","Å¦":"T","Å£":"t","Å¥":"t","Å§":"t","Å¨":"U","Åª":"U","Å¬":"U","Å®":"U","Å°":"U","Å²":"U","Å©":"u","Å«":"u","Å­":"u","Å¯":"u","Å±":"u","Å³":"u","Å´":"W","Åµ":"w","Å¶":"Y","Å·":"y","Å¸":"Y","Å¹":"Z","Å»":"Z","Å½":"Z","Åº":"z","Å¼":"z","Å¾":"z","Ä²":"IJ","Ä³":"ij","Å’":"Oe","Å“":"oe","Å‰":"'n","Å¿":"s"}),Ni=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Vi=RegExp("[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]","g");var Li=function(e){return(e=Ir(e))&&e.replace(Ni,Bi).replace(Vi,"")},Ui=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;var qi=function(e){return e.match(Ui)||[]},Ki=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;var zi=function(e){return Ki.test(e)},Yi="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Hi="["+Yi+"]",Wi="\\d+",Qi="[\\u2700-\\u27bf]",Xi="[a-z\\xdf-\\xf6\\xf8-\\xff]",Zi="[^\\ud800-\\udfff"+Yi+Wi+"\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde]",Ji="(?:\\ud83c[\\udde6-\\uddff]){2}",eo="[\\ud800-\\udbff][\\udc00-\\udfff]",to="[A-Z\\xc0-\\xd6\\xd8-\\xde]",ro="(?:"+Xi+"|"+Zi+")",no="(?:"+to+"|"+Zi+")",ao="(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\\ud83c[\\udffb-\\udfff])?",io="[\\ufe0e\\ufe0f]?"+ao+("(?:\\u200d(?:"+["[^\\ud800-\\udfff]",Ji,eo].join("|")+")[\\ufe0e\\ufe0f]?"+ao+")*"),oo="(?:"+[Qi,Ji,eo].join("|")+")"+io,so=RegExp([to+"?"+Xi+"+(?:['â€™](?:d|ll|m|re|s|t|ve))?(?="+[Hi,to,"$"].join("|")+")",no+"+(?:['â€™](?:D|LL|M|RE|S|T|VE))?(?="+[Hi,to+ro,"$"].join("|")+")",to+"?"+ro+"+(?:['â€™](?:d|ll|m|re|s|t|ve))?",to+"+(?:['â€™](?:D|LL|M|RE|S|T|VE))?","\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Wi,oo].join("|"),"g");var lo=function(e){return e.match(so)||[]};var co=function(e,t,r){return e=Ir(e),void 0===(t=r?void 0:t)?zi(e)?lo(e):qi(e):e.match(t)||[]},uo=RegExp("['â€™]","g");var fo=function(e){return function(t){return Gi(co(Li(t).replace(uo,"")),e,"")}}(function(e,t,r){return e+(r?"-":"")+t.toLowerCase()});var po=function(e,t){var r;return Qa(e,function(e,n,a){return!(r=t(e,n,a))}),!!r};var vo=function(e,t,r){var n=Je(e)?xe:po;return r&&fa(e,t,r)&&(t=void 0),n(e,Jr(t,3))},go=Do(Pi),ho=Do(Ii),mo=Do(fo),yo=Do(qt),bo=Do(vo),wo=Do(ni);function Do(e){return e&&e.__esModule?e:{default:e}}angular.module("reports.directives").directive("dropDown",function(){return{replace:!0,restrict:"E",scope:{items:"=",item:"=selectedItem",filter:"=",display:"=",heading:"=",columns:"=",groupBy:"="},template:'<div class="dropdown" ng-class="{open: open}">\n    <div class="dropdown-overlay" ng-click="toggle()"></div>\n    <a ng-click="toggle()"\n       data-dropdown="{{fingerprint}}"\n       class="button dropdown with-right-chevron"\n       ng-class="{open: open}">\n      <span class="dropdown-item">{{display(item)}}</span><span class="chevron down"></span>\n    </a>\n    <div id="{{fingerprint}}" data-dropdown-content class="f-dropdown">\n      <h3 ng-show="heading" class="dropdown-heading">{{::heading}}</h3>\n      <div class="dropdown-options">\n        <div ng-init="filteredItemGroups = (itemGroups | dropdownItemGroup:filter)"></div>\n        <ul ng-if="groupCanBeShown(items)"\n          ng-repeat="items in filteredItemGroups"\n          class="dropdown-group">\n          <li ng-if="itemCanBeShown(i)"\n            ng-click="select(i)"\n            ng-repeat="i in items"\n            ng-class="{\n              active: isActive(i),\n              \'restricted-item\': isRestrictedItem(i)\n            }">\n            <a>{{i.name}}</a>\n          </li>\n        </ul>\n        <a ng-if="shouldShowAdvancedToggle()"\n          ng-click="revealAdvancedItems()"\n          class="show-advanced-items">\n          Advanced...\n        </a>\n      </div>\n    </div>\n</div>',controller:["$scope","$rootScope","AdvancedReportingService","vdSplashService","vdTracking","ReportDefinition",function(e,t,r,n,a,i){e.open=!1,e.itemGroups=[];var o=e.columns||!1,s=e.groupBy||!1,l=r.userCanAccessAdvancedReporting(),c=!1;e.isRestrictedItem=function(e){return!r.isDefinitionAccessible(e)},e.shouldShowAdvancedToggle=function(){return!l&&c&&!e.advancedItemsRevealed},e.revealAdvancedItems=function(){e.advancedItemsRevealed=!0},e.itemCanBeShown=function(t){return r.isDefinitionAccessible(t)||e.advancedItemsRevealed},e.groupCanBeShown=function(t){return!(!l&&!e.advancedItemsRevealed)||!(0,go.default)(t,function(e){return e.isAdvanced})};var u=function(){var t,r,n,a,i,l,u={isAdvanced:!0};e.filter&&(u[e.filter.key]=e.filter.value),c=(0,bo.default)(e.items,u),o?(t=e.items,r=(0,yo.default)(t).sort(),n=r.length,a=Math.ceil(n/2),i=[{},{}],l=0,r.forEach(function(e,r){r>=a&&1!==l&&(l=1),i[l][e]=t[e]}),e.itemGroups=i):s?e.itemGroups=(0,ho.default)(e.items,e.groupBy):e.itemGroups[0]=e.items};u(),e.isActive=function(t){return e.item===t},t.$on("dropdown:toggled",function(t,r){r!==e.fingerprint&&(e.open=!1)}),e.toggle=function(){t.$emit("dropdown:toggled",e.fingerprint),e.open=!e.open},e.$watch("items",function(){e.item||(e.item=e.items[0]),e.fingerprint=(0,wo.default)("dd-",e.items),u()}),e.$watch("display",function(t){t||(e.display=function(e){return e.name})}),e.select=function(t){if(e.open=!1,e.isRestrictedItem(t)){var r=t instanceof i,o=function(e){return{moduleName:"Account",eventName:e,metadata:{feature:"advanced-reporting",source:"".concat(r?"reporting-type":"reporting-measure","-").concat((0,mo.default)(t.name))}}};a.trackUserEvent(o("Feature promo displayed")),n.openSplash("partials/upgrade.html",e,{dismissible:!0,templateData:{trackLinksConfig:o("Plans displayed")}})}else e.item=t}}]}});angular.module("reports.directives").directive("granularityDateSelect",function(){return{restrict:"E",scope:{granularity:"=",model:"=ngModel"},replace:!0,template:'<div> <select ng-show="selectOptions.day" ng-model="day" ng-options="day for day in days" required> </select> <select ng-show="selectOptions.month" ng-model="month" ng-options="month for month in months" required> </select> <select ng-show="selectOptions.quarter" ng-model="quarter" ng-options="quarter.text for quarter in quarters track by quarter.value" required> </select> <select ng-show="selectOptions.year" ng-model="year" ng-options="year for year in years" required> </select> <select ng-show="selectOptions.hour" ng-model="hour" ng-options="hour for hour in hours" required> </select> <select ng-show="selectOptions.hour" ng-model="hourPeriod" required> <option value="am">am</option> <option value="pm">pm</option> </select> </div>',controller:["$scope",function(e){var t,r=function(){var t;switch(e.granularity){case"month":t={month:!0,year:!0};break;case"quarter":t={quarter:!0,year:!0};break;case"year":t={year:!0};break;case"hour":t={day:!0,month:!0,year:!0,hour:!0};break;default:t={day:!0,month:!0,year:!0}}t.day&&(e.days=function(){for(var t=e.month,r=e.year,n=moment().month(t).year(r).daysInMonth(),a=[],i=1;i<=n;i++)a.push(i);return a}()),e.selectOptions=t},n=function(){var t=moment();if(t.year(e.year),"quarter"===e.granularity?t.quarter(e.quarter.value):t.month(e.month).date(e.day),"hour"===e.granularity){var r=moment(e.hour+e.hourPeriod,["ha"]).hour();t.hour(r).startOf("hour")}else t.startOf("day");e.model=t.toDate()};e.years=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t=moment().year(),r=[],n=t-e,a=t;a>=n;a--)r.push(a);return r}(),e.months=moment.months(),e.hours=[1,2,3,4,5,6,7,8,9,10,11],e.hours.unshift(12),e.quarters=[{value:1,text:"Q1"},{value:2,text:"Q2"},{value:3,text:"Q3"},{value:4,text:"Q4"}],e.quarter=e.quarters[0],e.$watchGroup(["granularity","quarter","day","month","year","hour","hourPeriod"],function(e,t){r(),n()}),t=moment(e.model),e.year=t.year(),e.month=t.format("MMMM"),e.day=t.day(),e.hour=t.format("h"),e.hourPeriod=t.format("a"),r(),n()}]}});var _o=function(e){return e&&e.__esModule?e:{default:e}}(va);angular.module("reports.directives").directive("granularityDateShifter",["vendGranularityDateFilter","vendGranularityDateRangeFilter","Metrics","DefinitionEventData","vdTracking",function(e,t,r,n,a){return{replace:!0,restrict:"E",scope:{granularityDateSelection:"=",definition:"="},template:'<ul class="button-group date-shifter"> <li> <a class="button secondary" ng-click="prev()"> <div class="icon">left</div> </a> </li> <li> <a class="button date" ng-class="granularityClass()" ng-click="clickedDisplayDate()"> <strong>{{ endDate(granularityDateSelection) }}</strong> </a> </li> <li> <a class="button secondary" ng-click="next()" ng-class="{\'disabled\':!canShiftUp()}"> <div class="icon">right</div> </a> </li> </ul>',controller:["$scope",function(i){var o={moduleName:"Report Dashboard"},s=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new n(i.definition),r=angular.copy(o);r.eventName="Date Shifted",r.metadata=(0,_o.default)(e,t.getEventMetadata()),r.metadata.granularity=i.granularityDateSelection.granularity.key,a.trackUserEvent(r)};i.endDate=function(r){var n=r.granularity.key;if("day"===n)return e(r.getPeriodEndDate());var a=moment(r.getPeriodEndDate()).startOf(n);return t(a,r.getPeriodEndDate(),"Do MMM YYYY")},i.clickedDisplayDate=function(){return r.increment("date_shifter_click",{tags:["direction:none"]})},i.prev=function(){s({direction:"previous"}),r.increment("date_shifter_click",{tags:["direction:prev"]}),i.granularityDateSelection.shiftSelectedDate(-1)},i.next=function(){s({direction:"next"}),r.increment("date_shifter_click",{tags:["direction:next"]}),i.canShiftUp()&&i.granularityDateSelection.shiftSelectedDate(1)},i.canShiftUp=function(){return i.granularityDateSelection.canShiftSelectedDateUp()},i.granularityClass=function(){return i.granularityDateSelection.granularity.key}}]}}]);angular.module("reports.directives").directive("granularitySelector",["GranularityDefinitionsService",function(e){return{replace:!0,restrict:"E",scope:{granularityDateSelection:"="},template:'<ul class="button-group granularity-selector"> <li ng-repeat="granularity in granularities"> <a class="button fixed" ng-class="{secondary: isActive(granularity)}" ng-click="setGranularity(granularity)"> {{granularity.name}} </a> </li> </ul>',controller:["$scope",function(t){t.granularities=[e.findByKey("day"),e.findByKey("week"),e.findByKey("month")],t.setGranularity=function(e){var r;switch(e.key){case"day":case"week":r=8;break;case"month":r=7}return t.granularityDateSelection.update({granularity:e,periodCount:r})},t.isActive=function(e){return t.granularityDateSelection.granularity.key===e.key}}]}}]);angular.module("reports.directives").directive("launchBanner",["localStorageService","PermissionsService",function(e,t){return{replace:!0,restrict:"E",controllerAs:"launchBannerCtrl",template:'<div ng-show="launchBannerCtrl.show" class="alert-box alert-box--launch"> <a ng-click="launchBannerCtrl.close()" class="close">&times;</a> <h1>Need help using our Reporting suite?</h1> <p>Check out our <a href="http://support.vendhq.com/hc/en-us/articles/203792370-Reporting-in-Vend" target="_blank"> step-by-step guide </a>, which also shows you how to run your most important reports. Get all your questions answered and a live walkthrough of all the features by joining an upcoming <a href="http://www.vendhq.com/webinars/training" target="_blank">training webinar</a>. </p> </div>',controller:function(){var r=this,n="reporting-launch-banner-dismissed";this.show=!e.get(n)&&t.isTrialAccount(),this.close=function(){r.show=!1,e.set(n,!0)}}}}]);var Co=m?m.isConcatSpreadable:void 0;var So=function(e){return Je(e)||pt(e)||!!(Co&&e&&e[Co])};var ko=function e(t,r,n,a,i){var o=-1,s=t.length;for(n||(n=So),i||(i=[]);++o<s;){var l=t[o];r>0&&n(l)?r>1?e(l,r-1,n,a,i):Ze(i,l):a||(i[i.length]=l)}return i};var Ro=function(e){return null!=e&&e.length?ko(e,1):[]};var To=function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n&&!1!==t(e[r],r,e););return e};var xo=function(e){return"function"==typeof e?e:Wr};var Mo=function(e,t){return(Je(e)?To:Qa)(e,xo(t))};var Oo=function(e,t){return Pr(t,function(t){return e[t]})};var Ao=function(e){return null==e?[]:Oo(e,qt(e))},Po=Math.max;var Eo=function(e,t,r,n){e=Ut(e)?e:Ao(e),r=r&&!n?$a(r):0;var a=e.length;return r<0&&(r=Po(a+r,0)),li(e)?r<=a&&e.indexOf(t,r)>-1:!!a&&nn(e,t,r)>-1},$o=Math.max;var jo=function(e,t,r){var n=null==e?0:e.length;if(!n)return-1;var a=null==r?0:$a(r);return a<0&&(a=$o(n+a,0)),nn(e,t,a)},Fo=Lo(oi),Io=Lo(Ro),Go=Lo(Mo),Bo=Lo(Eo),No=Lo(jo),Vo=Lo(Za);function Lo(e){return e&&e.__esModule?e:{default:e}}angular.module("reports.directives").directive("metadataDropdown",function(){return{scope:{metadataItems:"=",definition:"="},restrict:"E",replace:!0,template:'<div>\n    <checkbox-dropdown items="metadataItems" on-submit="confirmMetadataSelection()" open="open"></checkbox-dropdown>\n</div>',controller:["$scope",function(e){var t,r;t=e.definition.dimensionMetadata,r=(0,Io.default)((0,Vo.default)((0,Fo.default)(t,function(e){return e.metadata.length>0}),"metadata")),(0,Fo.default)(e.metadataItems,function(e){return(0,Bo.default)(r,e.key)}).every(function(e){e.selected=!0}),e.confirmMetadataSelection=function(){var t=(0,Fo.default)(e.metadataItems,"selected",!0),r=[];(0,Go.default)(e.definition.transformedReport.dimensions.row,function(e,n){r[n]={dimension:e.key,metadata:[]},(0,Go.default)(t,function(t){(0,No.default)(t.dimension_keys,e.key)>=0&&r[n].metadata.push(t.key)})}),e.definition.dimensionMetadata=r}}]}});var Uo=Mo,qo=zo(Uo),Ko=zo(Fa);function zo(e){return e&&e.__esModule?e:{default:e}}angular.module("reports.directives").directive("notifications",function(){return{replace:!0,restrict:"E",template:'<div class="alert-box" ng-class="[notification.class,notification.type]" ng-repeat="notification in notifications"> <span ng-bind-html="notification.message"></span> </div>',controller:["$scope","$timeout",function(e,t){return e.$watch("notifications",function(r){return(0,qo.default)(r,function(r){if(r.countdown&&!r.class){r.class="started";var n=function(){var t=(0,Ko.default)(e.notifications,function(e){return e===r});return e.notifications.splice(t,1)};t(function(){return r.class="alert-close",t(n,300)},1e3*r.countdown)}})},!0)}]}});var Yo=Xo(oi),Ho=Xo(Mo),Wo=Xo(Eo),Qo=Xo(Za);function Xo(e){return e&&e.__esModule?e:{default:e}}angular.module("reports.directives").directive("optionalAggregates",function(){return{scope:{optional:"=",definition:"=",active:"="},restrict:"E",replace:!0,template:'<div>\n    <checkbox-dropdown items="optional" on-submit="confirmAggregateSelection()" open="open"></checkbox-dropdown>\n</div>',controller:["$scope",function(e){(0,Ho.default)(e.optional,function(t){t.selected=(0,Wo.default)(e.definition.optionalAggregates,t.key)}),e.confirmAggregateSelection=function(){e.definition.optionalAggregates=(0,Qo.default)((0,Yo.default)(e.optional,"selected",!0),"key")}}]}});var Zo=es(oi),Jo=es(Ii);function es(e){return e&&e.__esModule?e:{default:e}}angular.module("reports.directives").directive("productTable",["OrderedHash","vendCurrencyFilter",function(e,t){return{scope:{view:"="},restrict:"E",replace:!0,template:'<article><report-grid data="data" config="config"></report-grid></article>',controller:["$scope","$compile",function(r,n){r.$watch("view.data.rows",function(){if(r.view.data.rows){var t=(0,Jo.default)(r.view.data.rows,function(e){return e.product_id});t=(0,Zo.default)(new e(t).array(),function(e){return e.val[e.val.length-1].item_count>0}),r.data=t}});var a=function(e,t){return e.val[e.val.length-1][t]};r.config={numberOfRows:50,noResultsMessage:"No products have been sold in the selected period.",columns:[{name:"Product",type:DataTable.ColumnType.TEXT,width:400,classes:"",value:function(e){return"<a class='product-name'>".concat(e.val[e.val.length-1].product,"</a>")}},{name:"Average Sale Price",type:DataTable.ColumnType.NUMERIC,width:100,classes:"",value:function(e){var r=a(e,"total_revenue")/a(e,"item_count");return t()(r,{decimalPlaces:2})}},{name:"Quantity Sold",type:DataTable.ColumnType.NUMERIC,width:100,classes:"",value:function(e){return a(e,"item_count")}},{name:"Revenue",type:DataTable.ColumnType.NUMERIC,width:100,classes:"",value:function(e){return t()(a(e,"total_revenue"),{decimalPlaces:2})}},{name:"Discount",type:DataTable.ColumnType.NUMERIC,width:100,classes:"",value:function(e){return t()(a(e,"total_discount"),{decimalPlaces:2})}},{name:"Trend",type:DataTable.ColumnType.NUMERIC,width:100,classes:"",value:function(e){var t=r.$new(!0);return t.data=e.val.map(function(e){return{key:e.day,val:e.total_revenue}}),n('<sparkline data="data"></sparkline>')(t)}}]}}]}}]);angular.module("reports.directives").directive("report",function(){return{scope:{view:"=",type:"="},restrict:"E",replace:!0,template:'<div> <vend-spinner loading="view.data.loading"></vend-spinner> <div ng-switch on="type"> <report-chart ng-switch-when="chart" view="view"></report-chart> <report-bar ng-switch-when="bar" view="view"></report-bar> <product-table ng-switch-when="product-table" view="view"></product-table> <user-table ng-switch-when="user-table" view="view"></user-table> <sales-table ng-switch-when="sales-table" view="view"></user-table> </div> </div>'}});angular.module("reports.directives").directive("reportBar",function(){return{scope:{view:"="},restrict:"E",replace:!0,template:'<div> <div> <span>Todayâ€™s {{agg.name}}</span> </div> <bar-chart data="chartData" config="chartConfig"></bar-chart> </div>',controller:["$scope",function(e){e.chartConfig={height:200,width:250},e.$watch("view.data.rows",function(t){t&&(e.chartData=e.view.latestValues())})}]}});angular.module("reports.directives").directive("reportBuilder",["ReportDefinition",function(e){return{scope:{report:"=",data:"="},restrict:"E",replace:!0,template:'<div> Show \x3c!-- Filters --\x3e <div ng-repeat="filter in definition.filters"> <select ng-options="value for (label, value) in filter.options" ng-model="filter.dimension"></select> <input type="text" ng-model="filter.value" /> <a ng-click="removeFilter($index)">x</a> </div> <a ng-click="addFilter()">+</a> By \x3c!-- Dimension --\x3e <button ng-click="update()">Update</button> </div>',controller:["$scope",function(t){t.definition||(t.definition=new e),t.addFilter=t.definition.addFilter,t.removeFilter=t.definition.removeFilter,t.update=function(){t.data=t.definition.data()}}]}}]);angular.module("reports.directives").directive("reportChart",["PercentageChange",function(e){return{scope:{view:"="},restrict:"E",replace:!0,template:'<article class="widget"> <h1 tooltip="{{view.widget.description}}" tooltip-animation="false">{{view.title}}</h1> <h2>{{formattedTotal}}</h2> <h3 class="percent-change" ng-class="[change.type(), percentChangeLayout()]"> <div class="change">{{change.displayChange()}}</div> <div class="relation">Previous {{ view.granularity | upperCaseFirst }}</div> </h3> <bar-chart data="barChartData" width="width" config="barChartConfig"></bar-chart> <chart-line-time data="lineChartData" config="lineChartConfig" height="145"></chart-line-time> </article>',controller:["$element","$scope","$window",function(t,r,n){var a={abbreviate:!0,significantFigures:3};r.barChartConfig={valFormatter:function(e){return r.view.formatter(e,a)}},r.lineChartConfig={tooltipDateFormatter:function(e){return moment(e).utc().format("ddd Do MMM, YYYY")},tooltipValueFormatter:function(e){return r.view.formatter(e,a)},xAxisTickFormatter:function(e){var t,n=moment(e).utc();if(moment().format("DDMMYYYY")===n.format("DDMMYYYY"))return"Today";switch(r.view.granularity.toLowerCase()){case"week":t="D MMM";break;case"month":t="MMM 'YY";break;default:t="ddd D"}return n.format(t)}};var i=function(){return r.$apply()},o=angular.element(n);o.on("resize",i),r.$on("$destroy",function(){return o.off("resize",i)}),r.percentChangeLayout=function(){if(t[0].offsetWidth<280)return"displaySeperate"},r.$watch("view.datatable.data",function(t){var n,i;if(t){var o=r.view,s=o.datatable,l=s.data,c=o.aggregation.key;s.applyFormatterOptions(a);var u=l.aggregates.column.length,d=l.aggregates.column[u-1][0][c],f=l.aggregates.column[u-2][0][c];r.formattedTotal=r.view.formatter(d,a);var p=[];for(i=0;i<l.headers.columns.length;i++){var v={key:(n=l.headers.columns[i])[0],val:l.aggregates.column[i][0][c]};p.push(v)}r.lineChartData=p;var g=[];for(i=0;i<l.headers.rows.length;i++)n=l.headers.rows[i],g.push({key:n[0],val:l.rows[i][u-1][0][c]});r.barChartData=g,r.change=new e(d,f,{postiveInfinityValue:"Up",negativeInfinityValue:"Down",NaNValue:"No change",neutralValue:"No change",formatter:function(e){return"".concat(e.toFixed(),"%")}})}})}]}}]);angular.module("reports.directives").directive("reportDatePicker",["GranularityDefinitionsService",function(e){return{restrict:"E",scope:{dateSelection:"="},replace:!0,template:'<div ng-form name="dateSelectorForm">\n    <div class="reporting-date-picker-input-group">\n      <div class="reporting-date-picker-input-group-item">\n        <input type="date"\n               name="inputDateStart"\n               id="input_range_start_{{::$id}}"\n               placeholder="yyyy-MM-dd"\n               class="reporting-date-picker-input"\n               ng-model="inputDate.start"\n               ng-model-options="{ updateOn: \'blur\' }"\n               required>\n        <input reporting-date-picker\n               class="ng-hide"\n               ng-model="dateSelection.startDate"\n               date-picker-config="dateConfig">\n      </div>\n    </div>\n    <div class="reporting-date-picker-container">\n      <div class="reporting-date-stamp"></div>\n    </div>\n</div>',controller:["$scope","$rootScope","$element",function(t,r,n){var a=n[0].getElementsByClassName("reporting-date-stamp")[0],i=e.findByKey("single"),o=moment(t.dateSelection.startDate||t.dateSelection.period.start).toDate();t.dateSelection.startDate=o,t.inputDate={start:t.dateSelection.startDate},t.dateConfig={container:a,bound:!1,maxDate:moment().add("1","day").toDate(),minDate:t.dateSelection.minDate},t.$watch("inputDate.start",function(e){t.dateSelectorForm.inputDateStart.$valid&&(t.dateSelection.startDate=e)},!0),t.$watch("dateSelection.startDate",function(e){!function(e){e=moment(e).toDate(),t.inputDate.start=e,t.dateConfig.date=e}(e)},!0),t.$watch("dateSelection",function(){t.dateSelectorForm.$invalid||t.dateSelection.update({granularity:i,periodType:"single",startDate:t.dateSelection.startDate})},!0)}]}}]);angular.module("reports.directives").directive("reportDateRangePicker",["GranularityDefinitionsService",function(e){return{restrict:"E",scope:{dateSelection:"="},replace:!0,template:'<div ng-form name="dateRangeSelectorForm">\n    <div class="reporting-date-picker-input-group">\n      <div class="reporting-date-picker-input-group-item">\n        <label class="reporting-date-picker-label" for="input_range_start_{{::$id}}">From:</label>\n        <input type="date"\n               name="inputRangeStart"\n               id="input_range_start_{{::$id}}"\n               placeholder="yyyy-MM-dd"\n               class="reporting-date-picker-input"\n               ng-model="inputRange.start"\n               ng-model-options="{ updateOn: \'blur\' }"\n               required>\n        <input reporting-date-picker\n               class="ng-hide"\n               ng-model="dateSelection.startDate"\n               date-picker-config="dateFromConfig">\n      </div>\n      <div class="reporting-date-picker-input-group-item">\n        <label class="reporting-date-picker-label" for="input_range_end_{{::$id}}">To:</label>\n        <input type="date"\n               name="inputRangeEnd"\n               id="input_range_end_{{::$id}}"\n               placeholder="yyyy-MM-dd"\n               class="reporting-date-picker-input"\n               ng-model="inputRange.end"\n               ng-model-options="{ updateOn: \'blur\' }"\n               required>\n        <input reporting-date-picker\n               class="ng-hide"\n               ng-model="dateSelection.endDate"\n               date-picker-config="dateToConfig">\n      </div>\n    </div>\n    <div class="reporting-date-picker-container">\n      <div class="reporting-date-picker-range reporting-date-picker-range--left"></div>\n      <div class="reporting-date-picker-range reporting-date-picker-range--right"></div>\n    </div>\n</div>',controller:["$scope","$element",function(t,r){var n=r[0],a=n.getElementsByClassName("reporting-date-picker-range--left")[0],i=n.getElementsByClassName("reporting-date-picker-range--right")[0],o=e.findByKey("range"),s=t.dateSelection.minDate,l=moment(t.dateSelection.startDate||t.dateSelection.period.start).toDate(),c=moment(t.dateSelection.endDate||t.dateSelection.period.end).toDate();s&&(l=moment(l).isAfter(s)?l:s),t.dateSelection.startDate=l,t.dateSelection.endDate=c;return t.inputRange={start:t.dateSelection.startDate,end:t.dateSelection.endDate},t.dateFromConfig={container:a,bound:!1},t.dateToConfig={container:i,bound:!1},t.$watch("inputRange.start",function(e){t.dateRangeSelectorForm.inputRangeStart.$valid&&(t.dateSelection.startDate=e)},!0),t.$watch("inputRange.end",function(e){t.dateRangeSelectorForm.inputRangeEnd.$valid&&(t.dateSelection.endDate=e)},!0),t.$watch("dateSelection.startDate",function(e){var r,n=t.dateFromConfig.minDate;n&&!moment(e).isAfter(n)&&(e=n),r=e,r=moment(r).toDate(),t.inputRange.start=r,t.dateFromConfig.minDate=s,t.dateToConfig.minDate=r,t.dateToConfig.startRange=r,t.dateFromConfig.startRange=r},!0),t.$watch("dateSelection.endDate",function(e){return r=e,r=moment(r).toDate(),t.inputRange.end=r,t.dateFromConfig.maxDate=r,t.dateToConfig.endRange=r,void(t.dateFromConfig.endRange=r);var r},!0),t.$watch("dateSelection",function(){if(!t.dateRangeSelectorForm.$invalid)return t.dateSelection.update({granularity:o,periodType:"range",startDate:t.dateSelection.startDate,endDate:t.dateSelection.endDate})},!0)}]}}]);angular.module("reports.directives").directive("reportDateSelector",["vendGranularityDateRangeFilter","GranularityDateSelection",function(e,t){return{restrict:"E",scope:{granularityDateSelection:"=",config:"=",dropdownDirection:"=?"},replace:!0,template:'<div class="dropdown" ng-class="{open: open}">\n    <div class="dropdown-overlay" ng-click="toggle()"></div>\n    <a ng-click="toggle()" class="date-selector-toggle button dropdown with-right-chevron">\n      <span class="date-selector-set-date">{{dateRange(granularityDateSelection)}}</span>\n      <span class="chevron down"></span>\n    </a>\n    <div class="f-dropdown date-selector-dropdown drop-down content large"\n         ng-class="{\n           \'f-dropdown--bottom-left\': dropdownDirection === \'right\',\n           \'f-dropdown--bottom-right\': dropdownDirection === \'left\'\n         }">\n      <dl class="date-selector-tabs date-selector-tabs--horizontal">\n        <dd class="date-selector-tab" ng-class="{active:selectedTab === \'all\'}" ng-if="config.all">\n          <a class="date-selector-tab-button" ng-click="changeTab(\'all\')">All</a>\n        </dd>\n        <dd class="date-selector-tab" ng-class="{active:selectedTab === \'compare\'}" ng-if="config.compare">\n          <a class="date-selector-tab-button" ng-click="changeTab(\'compare\')">Compare Dates</a>\n        </dd>\n        <dd class="date-selector-tab" ng-class="{active:selectedTab === \'range\'}" ng-if="config.range">\n          <a class="date-selector-tab-button" ng-click="changeTab(\'range\')">Date Range</a>\n        </dd>\n      </dl>\n      <form name="granularityDateSelectionForm"\n            id="granularityDateSelectionDropDown"\n            class="date-selector"\n            ng-submit="confirmDateSelection()"\n            novalidate>\n\n        <report-date-picker ng-if="selectedTab === \'single\'"\n                            date-selection="tempDateSelection">\n        </report-date-picker>\n\n        <report-date-range-picker ng-if="selectedTab === \'range\'"\n                                  date-selection="tempDateSelection">\n        </report-date-range-picker>\n\n        <report-granularity-selector ng-if="selectedTab === \'compare\'"\n                                     granularity-date-selection="tempDateSelection">\n        </report-granularity-selector>\n\n        <div class="date-selector-footer">\n          <div class="date-selector-footer-section date-selector-footer-section--left">\n          <span ng-if="selectedTab === \'single\'">\n            <a href="javascript:void(0)" ng-click="selectToday()">Today</a>\n          </span>\n          <span class="date-selector-preview" ng-if="selectedTab !== \'single\'">\n            {{dateRange(tempDateSelection)}}\n          </span>\n          <br><span ng-if="isSelectionTooLarge" class="vd-text--negative vd-text-supplementary">\n            <i class="fa fa-exclamation-triangle"></i>\n            Please choose a date range that isnâ€™t wider than {{maxReportMonths}} months\n          </span>\n          </div>\n          <div class="date-selector-footer-section date-selector-footer-section--right">\n          <input type="submit"\n                 class="vend-button date-selector-submit"\n                 ng-disabled="granularityDateSelectionForm.$invalid || isSelectionTooLarge"\n                 ng-class="{\'vend-button--disabled\': granularityDateSelectionForm.$invalid || isSelectionTooLarge}"\n                 value="Apply">\n          </div>\n        </div>\n      </form>\n    </div>\n</div>',controller:["$scope","$rootScope",function(r,n){r.open=!1,r.dropdownDirection||(r.dropdownDirection="right"),r.maxReportMonths=Math.round(n.maxReportDurationDays/30),n.$on("dropdown:toggled",function(e,t){t!==r.fingerprint&&(r.open=!1)}),r.toggle=function(){n.$emit("dropdown:toggled",r.fingerprint),r.open=!r.open},r.changeTab=function(e){e!==r.selectedTab&&(r.selectedTab=e,r.tempDateSelection?"all"===e?r.tempDateSelection=t.getAllSelection():"compare"===e?r.tempDateSelection=t.getCompareSelection():"single"===e?r.tempDateSelection=t.getSingleSelection():"range"===e&&(r.tempDateSelection=t.getRangeSelection()):r.tempDateSelection=angular.copy(r.granularityDateSelection))},r.selectToday=function(){r.tempDateSelection.startDate=moment().toDate()},r.dateRange=function(t){if("all"===t.periodType)return"All Time";var r="Do MMM YYYY";return"hour"===t.granularity.key&&(r+=" h:mm a"),e(t.getPeriodStartDate(),t.getPeriodEndDate(),r)},r.confirmDateSelection=function(e){if(!r.isSelectionTooLarge)return r.granularityDateSelectionForm.$valid?(r.open=!1,r.granularityDateSelectionForm.$setPristine(),r.granularityDateSelection.update(r.tempDateSelection)):void 0;e.preventDefault()};var a=function(){r.isSelectionTooLarge=!1,null!=n.maxReportDurationDays&&r.tempDateSelection&&r.tempDateSelection.period&&(r.isSelectionTooLarge=n.maxReportDurationDays<r.tempDateSelection.period.lengthInDays())};r.$watch("tempDateSelection.period.start",a),r.$watch("tempDateSelection.period.end",a),r.$watch("granularityDateSelection.granularity.key",function(e,t){e===t&&(["all","range","single"].includes(e)?r.changeTab(e):r.changeTab("compare"))},!0)}]}}]);angular.module("reports.directives").directive("reportDisplayOption",function(){return{replace:!0,restrict:"E",scope:{option:"="},template:'<div class="field"> <label class="label">{{option.label}}</label> <div class="value value--checkbox"> <reporting-switch value="option.value"></reporting-switch> </div> </div>'}});var ts=function(e){for(var t=-1,r=null==e?0:e.length,n=0,a=[];++t<r;){var i=e[t];i&&(a[n++]=i)}return a},rs=function(e){return e&&e.__esModule?e:{default:e}}(ts);angular.module("reports.directives").directive("reportDisplayOptions",["sentenceFilter","upperCaseFirstFilter",function(e,t){return{restrict:"E",scope:{options:"="},replace:!0,template:'<span class="display-option-summary" ng-if="showOptions()"> {{$parent.optionsSummary}} <a ng-click="$parent.showDisplayOptions()">Change?</a> </span>',controller:["$scope","$modal",function(r,n){var a=function(){r.tempOptions=angular.copy(r.options)};a(),r.showOptions=function(){for(var e in r.options){if(!0!==r.options[e].private)return!0}};var i=function(){var n=[];for(var a in r.options){var i=r.options[a];!0!==i.private&&!0!==i.private&&n.push(i.summary[i.value.toString()])}r.optionsSummary="".concat(t(e((0,rs.default)(n))),".")};i(),r.$watchCollection("options",function(e,t){e!==t&&(a(),i())}),r.showDisplayOptions=function(){n.open({controller:"displayOptionsCtrl",scope:r,windowClass:"small lightbox-width--600 lightbox--report-options",template:'<div class="lightbox"> <div class="lightbox-header"> <h2 class="lightbox-header-label">Display Options</h2> <a href="#" class="lightbox-header-close" ng-click="cancel()"> <span class="icon">cross</span> </a> </div> <div class="lightbox-content"> <form name="displayOptionsForm" ng-submit="save(tempOptions)" class="field-container"> <report-display-option option="option" ng-repeat="option in tempOptions"></report-display-option> <div class="field field--footer-actions"> <button class="vend-button vend-button--large vend-button--clear" type="button" ng-click="cancel()"> Cancel </button> <input type="submit" class="vend-button vend-button--large" value="Save"/> </div> </form> </div> </div>'}).result.then(function(e){return r.options=e,i()})}}]}}]);var ns=Math.max,as=Math.min;var is=ss(function(e,t,r){var n=null==e?0:e.length;if(!n)return-1;var a=n-1;return void 0!==r&&(a=$a(r),a=r<0?ns(n+a,0):as(a,n-1)),en(e,Jr(t,3),a,!0)}),os=ss(Za);function ss(e){return e&&e.__esModule?e:{default:e}}angular.module("reports.directives").directive("tag",function(){return{replace:!0,restrict:"E",scope:{tag:"=",name:"=key",remove:"="},template:'<div class="tag"> <span>{{tag.typeName }}:</span> {{tag.name}}<span ng-if="!!tag.deletedAt"> (deleted)</span> <a ng-click="remove(name)" class="icon">cross</a> </div>'}}),angular.module("reports.directives").directive("reportFilter",function(){return{replace:!0,restrict:"E",scope:{tags:"=",filterTypes:"="},template:'<div class="tag-container" ng-class="{\'tags-empty\': tagsEmpty}"> <tag tag="tag" key="key" remove="removeTag" ng-repeat="(key, tag) in tags"></tag> <input type="text" name="tags" /> </div>',controller:["$scope","$element","$filter","Bloodhound","Router",function(e,t,r,n,a){var i=r("escape"),o=$(t).find("input"),s={};e.$watchCollection("tags",function(t,r){e.tags.length?e.tagsEmpty=!1:e.tagsEmpty=!0,l()});e.removeTag=function(t){return e.tags.splice(t,1)};var l=function(){var t;if(!1!==e.tagsEmpty){var r=(0,os.default)(e.filterTypes,function(e){return e.name.toLowerCase()}),n="aeiou".indexOf(r[0][0])>-1?"an":"a";if(1===r.length)t="Start typing ".concat(n," ").concat(r[0]," to filter your report");else if(2===r.length){var a=r.pop();t="Start typing ".concat(n," ").concat(r.join(", ")," or ").concat(a," to filter your report")}else t="Start typing ".concat(n," ").concat(r.slice(0,3).join(", ")," or other keyword to filter your report");o.attr("placeholder",t)}else o.attr("placeholder","Filter results")},c=function(){if(e.filterTypes){var t,r,c,u=!0,d=!1,f=void 0;try{for(var p,v=e.filterTypes[Symbol.iterator]();!(u=(p=v.next()).done);u=!0){var g=p.value;s[g.key]=g}}catch(h){d=!0,f=h}finally{try{u||null==v.return||v.return()}finally{if(d)throw f}}o.typeahead("destroy"),o.typeahead({hint:!0,highlight:!0,minLength:1},(t=e.filterTypes,r=a.api2Path("reporting_entities",{type:(0,os.default)(t,"key").join(","),query:"QUERY",size:15}),(c=new n({datumTokenizer:n.tokenizers.obj.whitespace("name"),queryTokenizer:function(e){return n.tokenizers.whitespace(e.toLowerCase())},limit:15,remote:{url:r,replace:function(e,t){return e.replace(/QUERY/,encodeURIComponent(t))}}})).initialize(),{name:"Results",displayKey:"Name",source:c.ttAdapter(),bloodhound:c,templates:{suggestion:function(e){var t=e.DeletedAt?" <span class='info-tag'>Deleted</span>":"",r="<span class='suggest-type'>".concat(e.Type.replace("_"," "),"</span>");return"<p class='needsclick'>".concat(i(e.Name)).concat(r).concat(t,"</p>")}}})),l()}};return c(),e.$watch("filterTypes",c),o.on("typeahead:selected",function(t,r,n){return e.tags=e.tags.length?e.tags:[],o.val(""),o.typeahead("val",""),r={id:r.ID,name:r.Name,typeName:s[r.Type].name,type:r.Type,deletedAt:r.DeletedAt},e.$apply(function(){return e.tags.push(r)})}),o.on("keydown keypress",function(t){if(8===t.which&&""===o.val())return e.$apply(function(){return e.removeTag((0,is.default)(e.tags))})})}]}});angular.module("reports.directives").directive("reportFilterToggle",function(){return{replace:!0,restrict:"E",scope:{showDatatableFilter:"=",filters:"="},template:'<a class="button vend-button vend-button--info report-filter-toggle" ng-class="{ \'vend-button--active\': showDatatableFilter }" ng-click="toggleFilter()"> <span ng-show="!showDatatableFilter">Filter</span> <span ng-show="showDatatableFilter">Remove Filters</span> <span class="icon">filter</span> </a>',controller:["$scope",function(e){e.showDatatableFilter=!(!e.showDatatableFilter&&!e.filters.length),e.toggleFilter=function(){e.showDatatableFilter=!e.showDatatableFilter,e.showDatatableFilter||(e.filters=[])}}]}});var ls=/^\s+/,cs=h.parseInt;var us=function(e,t,r){return r||null==t?t=0:t&&(t=+t),cs(Ir(e).replace(ls,""),t||0)},ds={};Object.defineProperty(ds,"__esModule",{value:!0}),ds.default=void 0;var fs=[{name:"Year",key:"year",type:"DATE",format:function(e){return moment(+e.date).utc().format("YYYY")},val:"year",sortOrder:6},{name:"Quarter",key:"quarter",type:"DATE",format:function(e){return moment(+e.date).utc().format("[Q]Q")},val:"quarter",sortOrder:5},{name:"Month",key:"month",type:"DATE",sort:function(e,t){return moment(e,"MMM YYYY").diff(moment(t,"MMM YYYY"),"days")},format:function(e){return moment(+e.date).utc().format("MMM")},val:"month",sortOrder:4},{name:"Week",key:"week",type:"DATE",format:function(e){return moment(+e.date).utc().format("Do MMM")},val:"week",sortOrder:3,default:!0},{name:"Day",key:"day",type:"DATE",format:function(e){return moment(+e.date).utc().format("ddd Do")},val:"day",sortOrder:2},{name:"Hour",key:"hour",type:"DATE",reportHeaderFormat:"Do MMM YYYY",format:function(e){return moment(+e.date).utc().format("HH:00")},val:"hour",sortOrder:1},{name:"Range",key:"range",type:"DATE",format:function(e){return moment(+e.date).utc().format("ddd Do")},val:"range",hidden:!0},{name:"All Time",key:"all",type:"DATE",format:null,val:"all",hidden:!0},{name:"Single",key:"single",type:"DATE",format:function(e){return moment(+e.date).utc().format("ddd Do")},val:"single",hidden:!0}];ds.default=fs;var ps=gs(us),vs=gs(ds);function gs(e){return e&&e.__esModule?e:{default:e}}angular.module("reports.directives").directive("reportGranularitySelector",function(){return{restrict:"E",scope:{granularityDateSelection:"="},replace:!0,template:'<div ng-form name="granularitySelectorForm"> <dl class="date-selector-tabs"> <dd class="date-selector-tab" ng-repeat="granularity in granularities" ng-class="{active: isActiveGranularity(granularity.key)}" > <a class="date-selector-tab-button" ng-click="select(granularity)">{{ granularity.name }}</a> </dd> </dl> <div class="tabs-content date-selector-content"> <ul class="date-selector-options"> <li ng-click="selectPeriodType(\'to_date\')" ng-class="{\'date-selector-option--active\': isActivePeriodType(\'to_date\')}"> <input id="period_type_to_date" class="radio" type="radio" value="to_date" ng-model="granularityDateSelection.periodType" > <label class="radio-handle" for="period_type_to_date">{{granularityDateSelection.granularity.name}} to date </label> </li> <li ng-click="selectPeriodType(\'last_granularity\')" ng-class="{\'date-selector-option--active\': isActivePeriodType(\'last_granularity\')}"> <input type="radio" class="radio" ng-model="granularityDateSelection.periodType" id="period_type_last_granularity" value="last_granularity"> <label class="radio-handle" for="period_type_last_granularity"> Previous {{granularityDateSelection.granularity.name | lowercase}} </label> </li> <li ng-click="selectPeriodType(\'last\')" ng-class="{\'date-selector-option--active\': isActivePeriodType(\'last\')}"> <input id="period_type_last" type="radio" class="radio" value="last" ng-model="granularityDateSelection.periodType" > <label class="radio-handle" for="period_type_last">Last</label> <input type="number" class="date-selector-period-count" id="period_count_last" ng-min="1" ng-model="granularityDateSelection.periodCount" ng-required="granularityDateSelection.periodType === \'last\'"> <label for="period_count_last">{{granularityDateSelection.granularity.name | lowercase}}s</label> </li> <li ng-click="selectPeriodType(\'last_beginning\')" ng-class="{\'date-selector-option--active\': isActivePeriodType(\'last_beginning\')}"> <input type="radio" class="radio" id="period_type_last_beginning" value="last_beginning" ng-model="granularityDateSelection.periodType" > <label for="period_type_last_beginning" class="radio-handle"></label> <input type="number" class="date-selector-period-count" id="period_count_last_beginning" ng-min="1" ng-model="granularityDateSelection.periodCount" ng-required="granularityDateSelection.periodType === \'last_beginning\'"> <label for="period_count_last_beginning"> {{granularityDateSelection.granularity.name | lowercase}}s, </label> <label for="period_type_last_beginning">from</label> <granularity-date-select class="date-selector-inline-select" granularity="granularityDateSelection.granularity.key" ng-model="granularityDateSelection.selectedDate"> </granularity-date-select> </li> </ul> </div> </div>',controller:["$scope",function(e){e.granularities=vs.default.filter(function(e){return!e.hidden});e.$watch("granularityDateSelection.periodType",function(t){["last","last_beginning"].includes(t)||(e.granularityDateSelection.periodCount="")}),e.$watchGroup(["granularityDateSelection.granularity","granularityDateSelection.periodType"],function(t,r){t!==r&&e.granularitySelectorForm.$setDirty()}),e.granularityDateSelection.periodCount=(0,ps.default)(e.granularityDateSelection.periodCount),e.granularityDateSelection.selectedDate=moment(e.granularityDateSelection.granularity).toDate(),e.selectPeriodType=function(t){e.granularityDateSelection.periodType=t},e.isActiveGranularity=function(t){return e.granularityDateSelection.granularity.key===t},e.isActivePeriodType=function(t){return e.granularityDateSelection.periodType===t},e.select=function(t){e.granularityDateSelection.granularity=t},e.$watch("granularityDateSelection",function(t,r){if(t!==r&&!e.granularitySelectorForm.$invalid)return e.granularityDateSelection.update({granularity:e.granularityDateSelection.granularity,periodType:e.granularityDateSelection.periodType,periodCount:e.granularityDateSelection.periodCount,selectedDate:e.granularityDateSelection.selectedDate})},!0)}]}});angular.module("reports.directives").directive("reportingSwitch",function(){return{restrict:"E",scope:{value:"=",toggleHandler:"="},template:'<input type="checkbox" class="switch switch--large switch--blue" ng-click="toggleHandler()" ng-model="value"> <div ng-class="{ preload: preload }" class="switch-track"> <div class="switch-track-knob"></div> </div>',controller:["$scope",function(e){var t=e.value;"string"==typeof t?e.value="1"===t:"number"==typeof t&&t%1==0&&(e.value=1===t)}]}});var hs=Object.prototype,ms=hs.hasOwnProperty,ys=da(function(e,r){e=Object(e);var n=-1,a=r.length,i=a>2?r[2]:void 0;for(i&&fa(r[0],r[1],i)&&(a=1);++n<a;)for(var o=r[n],s=Zn(o),l=-1,c=s.length;++l<c;){var u=s[l],d=e[u];(void 0===d||t(d,hs[u])&&!ms.call(e,u))&&(e[u]=o[u])}return e}),bs=function(e){return e&&e.__esModule?e:{default:e}}(ys);angular.module("reports.directives").directive("reportingDatePicker",function(){return{require:"ngModel",scope:{datePickerConfig:"=",date:"=ngModel",onSelect:"&"},link:function(e,t){var r={firstDay:1,field:t[0],defaultDate:e.date,setDefaultDate:e.date||{true:!1}};(0,bs.default)(r,e.datePickerConfig||{});var n=new Pikaday(r);e.$watch("date",function(e){n.setMoment(e),n.draw()}),e.$watch("datePickerConfig.date",function(e){null!=e&&(n.setDate(e),n.draw())}),e.$watch("datePickerConfig.startRange",function(e){null!=e&&(n.setStartRange(e),n.draw())}),e.$watch("datePickerConfig.endRange",function(e){null!=e&&(n.setEndRange(e),n.draw())}),e.$watch("datePickerConfig.maxDate",function(e){null!=e&&(n.setMaxDate(e),n.draw())}),e.$watch("datePickerConfig.minDate",function(e){null!=e&&(n.setMinDate(e),n.draw())}),e.$on("$destroy",function(){return n.destroy()})}}});var ws=function(e){return e&&e.__esModule?e:{default:e}}(require("d3"));angular.module("reports.directives").directive("sparkline",function(){return{restrict:"E",scope:{data:"=",config:"="},link:function(e,t){if(e.data){var r=e.data,n=parseInt(70),a=parseInt(20),i=ws.default.time.scale.utc().range([0,n]),o=ws.default.scale.linear().range([a,0]),s=ws.default.svg.line().interpolate("linear").x(function(e){return i(e.key)}).y(function(e){return o(e.val)}),l=ws.default.select(t[0]).append("svg").attr("height",a).attr("viewBox","0 0 ".concat(n," ").concat(a)).attr("perserveAspectRatio","xMinYMid").attr("class","line-chart chart sparkline").append("g").append("path");l.data([]).attr("class","line").attr("d",s);var c=ws.default.extent(r,function(e){return e.key});i.domain(c).nice(8);var u=ws.default.max(r,function(e){return e.val});o.domain([0,u]),l.datum(r).attr("class","line").attr("d",s)}}}});var Ds=Cs(oi),_s=Cs(Ii);function Cs(e){return e&&e.__esModule?e:{default:e}}angular.module("reports.directives").directive("userTable",["OrderedHash","vendCurrencyFilter",function(e,t){return{scope:{view:"="},restrict:"E",replace:!0,template:'<article> <report-grid data="data" config="config"> </report-grid> </article>',controller:["$scope",function(r){r.$watch("view.data.rows",function(){if(r.view.data.rows){var t=(0,_s.default)(r.view.data.rows,function(e){return e.user});t=(0,Ds.default)(new e(t).array(),function(e){return e.val[e.val.length-1].item_count>0}),r.data=t}}),r.config={numberOfRows:50,noResultsMessage:"No products have been sold in the selected period.",columns:[{name:"User",type:DataTable.ColumnType.TEXT,width:400,classes:"",value:function(e,t){return"<a class='product-name'>".concat(e.key,"</a>")}},{name:"Quantity Sold",type:DataTable.ColumnType.NUMERIC,width:100,classes:"",value:function(e,t){return e.val[e.val.length-1].item_count.toFixed(0)}},{name:"Revenue",type:DataTable.ColumnType.NUMERIC,width:100,classes:"",value:function(e,r){return t()(e.val[e.val.length-1].total_revenue)}}]}}]}}]);var Ss=function(e,t,r,n,a){return a(e,function(e,a,i){r=n?(n=!1,e):t(r,e,a,i)}),r};var ks=function(e,t,r){var n=Je(e)?Gi:Ss,a=arguments.length<3;return n(e,Jr(t,4),r,a,Qa)},Rs=da(function(e){return un(ko(e,1,In,!0))}),Ts=Ps(ys),xs=Ps(Uo),Ms=Ps(Za),Os=Ps(ks),As=Ps(Rs);function Ps(e){return e&&e.__esModule?e:{default:e}}angular.module("reports.directives").directive("vendDatatable",["$compile","$filter","vendSplitNumberFilter","DimensionUrlService","AggregateDefinitionsService","MetadataDefinitionsService","DatatableOrder",function(e,t,r,n,a,i,o){return{restrict:"E",scope:{config:"=",reportDatatable:"=",definition:"="},template:'<vend-spinner loading="reportDatatable.loading"></vend-spinner> <datatable id="datatable-container" ng-hide="reportDatatable.error"></datatable> <div class="datatable-no-results-message" ng-show="reportDatatable.noResults"> {{config.noResultsMessage}} </div>',link:function(s,l){var c=t("escape");(0,Ts.default)(s.config,{collapseRowHeaders:!0,showMetadataFilters:!0,showColumnHeaders:!0,showMetrics:!0,showAggregates:!0,showMetricSummary:!0,showMetricAggregates:!0,showRows:!0,showTotalsTop:!1,loadMoreText:"Load More",noResultsMessage:"No data available for this period.",sparklineOptions:{show:!1},formatterOptions:{number:null,currency:null,percent:null}});var u=l.find("datatable")[0],d=new o({asc:"datatable-order--asc",desc:"datatable-order--desc"});s.orderByDimension=d.orderByDimension,s.orderBy=d.orderByAggregate;var f=function(){var t,o,f,p,v,g,h,m,y,b,w,D,_,C=s.reportDatatable,S=s.definition,k=(0,Ts.default)({},S.report.config,s.config),R=C.data.headers,T=C.data.aggregates,x=C.data.headers.row_metadata,M=C.data.headers.row_metadata_keys,O=S.transformedReport.dimensions,A=C.data.rows;S.metric&&(b=S.metric.key),s.metadataCollection=i.forReport(S.transformedReport),s.showMetadataFilter=s.metadataCollection.length>0&&k.showMetadataFilters;var P=s.definition.transformedReport.aggregates;s.optionalAggregates=P.optional,s.showAggregateDropdown=Boolean(s.optionalAggregates&&s.optionalAggregates.length),s.activeAggregates=(0,As.default)(P.row,P.cell,P.column,P.table),s.order=S.order,C.noResults&&(k.showMetricSummary=!1,k.showMetricAggregates=!1,k.showTotalsTop=!1),0===R.columns.length&&(k.showMetricAggregates=!1);var E=(0,Ms.default)(O.row,"name"),j=["datatable"];k.showColumnHeaders||j.push("datatable--no-col-headers"),k.showMetrics||j.push("datatable--no-col-dimensions"),k.showMetricSummary||j.push("datatable--no-table-aggregates"),k.showMetricAggregates||j.push("datatable--no-col-aggregates"),C.canLoadMore&&j.push("datatable--can-load-more"),k.showRows||j.push("datatable--no-rows"),C.noResults&&j.push("datatable--has-no-results");var F="<table class='".concat(j.join(" "),"'>");F+="<thead>";var I="",G="",B='<metadata-dropdown definition="definition" metadata-items="metadataCollection">\n</metadata-dropdown>',N=(0,Os.default)(M,function(e,t){return e+=t.length},0);for(k.showColumnHeaders&&(I+="<th colspan='".concat(N+E.length+1,"'></th>")),m=0;m<O.row.length;m++){var V=O.row[m],L=m===E.length-1;f=["datatable-row-label-label"];var U=d.getDimensionHeaderClass(S.order[0],V.key);""!==U&&f.push(U),L&&f.push("datatable-row-label-label--last"),G+="<th colspan='".concat(0===m?2:1,"' class='").concat(f.join(" "),"'>"),V.sortable?(p="ng-click='orderByDimension(order, \"".concat(V.key,"\")'"),G+="<a ".concat(p,">").concat(V.name,"</a>")):G+=V.name,0===N&&s.showMetadataFilter&&L&&(G+=B),G+="</th>"}var q=0;(0,xs.default)(M,function(e){return(0,xs.default)(e,function(e){q++;var t=i.findByKey(e);f=["datatable-row-label-label"],q===N&&f.push("datatable-row-label-label--last"),G+="<th class='".concat(f.join(" "),"'>"),q===N&&s.showMetadataFilter&&(G+=B),G+=t.name,G+="</th>"})});var K,z,Y=function(e){var t=s.definition.granularityDateSelection.granularity,r="year"!==t.key,n=t.reportHeaderFormat||"YYYY",a=[],i=[],o=[],l=null,c=null,u=!0,d=!1,f=void 0;try{for(var p,v=(e||[])[Symbol.iterator]();!(u=(p=v.next()).done);u=!0){var g=p.value,h=c,m=moment(parseInt(g[0])).utc().format(n);m!==l?(c=h={formattedHeader:r?m:"",length:0},a.push(h),i.push(!0),o.push(!0)):(i.push(!1),o.push(!1)),h.length++,l=m}}catch(y){d=!0,f=y}finally{try{u||null==v.return||v.return()}finally{if(d)throw f}}return o.push(!0),o.shift(),{headers:a,starts:i,ends:o}}(R.columns);if(k.showMetrics){var H=!0,W=!1,Q=void 0;try{for(var X,Z=Y.headers[Symbol.iterator]();!(H=(X=Z.next()).done);H=!0)h=X.value,k.showColumnHeaders&&(I+="<th colspan='".concat(h.length,"'>").concat(h.formattedHeader,"</th>"))}catch(he){W=!0,Q=he}finally{try{H||null==Z.return||Z.return()}finally{if(W)throw Q}}for(m=0;m<R.columns.length;m++)v=R.columns[m],f=["datatable-col-label"],Y.starts[m]&&f.push("datatable-cell--section-start"),Y.ends[m]&&f.push("datatable-cell--section-end"),G+="<th class='".concat(f.join(" "),"'>"),G+=(K=v[0],s.definition.granularityDateSelection.granularity.format({date:parseInt(K)})),G+="</th>"}if(N&&!k.showColumnHeaders&&(I+="<th colspan='".concat(N,"'></th>")),k.showAggregates){var J=T.row_titles.length;if(s.showAggregateDropdown&&(J+=1),k.sparklineOptions.show&&(J+=1),k.showColumnHeaders){if(I+="<th class='datatable-row-aggs-header' colspan='".concat(J,"'>"),I+="Totals By ".concat(E.join(", ")),S.transformedReport.isPPRReport()){I+="<a class='icon datatable-row-aggs-header-info' href='".concat("https://support.vendhq.com/hc/en-us/articles/212012977-Product-Performance-Report","' target='_blank'>help</a>")}I+="</th>"}for(m=0;m<T.row_titles.length;m++){y=T.row_titles[m],t=a.findByKey(y),f=["datatable-row-aggs-label"],0===m&&f.push("datatable-row-aggs-label--start");var ee=d.getAggregateHeaderClass(S.order[0],y);""!==ee&&f.push(ee),G+="<th class='".concat(f.join(" "),"'>"),t.sortable&&t.sortable[S.report.type]?(p="ng-click='orderBy(order, \"".concat(y,"\")'"),G+="<a ".concat(p,">").concat(t.name,"</a>")):G+=t.name,G+="</th>"}k.sparklineOptions.show&&(G+="<th class='datatable-row-aggs-label'>",G+="Trend",G+="</th>")}if(G+='<th class="datatable-row-filter" ng-if="showAggregateDropdown">\n    <optional-aggregates active="activeAggregates" definition="definition" optional="optionalAggregates">\n    </optional-aggregates>\n</th>',k.showColumnHeaders&&(F+="<tr class='datatable-col-header-row'>".concat(I,"</tr>")),F+="<tr class='datatable-col-labels-row'>".concat(G,"</tr>"),F+="</thead>",k.showMetricSummary){if(w="",R=C.data.headers,T=C.data.aggregates,t=a.findByKey(b),w+="<th colspan='".concat(E.length+N+1,"' >Totals</th>"),k.showMetrics)for(m=0;m<T.column.length;m++)o=T.column[m],f=["datatable-cell--nullable"],Y.starts[m]&&f.push("datatable-cell--section-start"),Y.ends[m]&&f.push("datatable-cell--section-end"),g=k.formatterOptions[t.valueType]||{},C.applyFormatterOptions(g),D=t.formatter(o[0][b],g),w+="<td class='".concat(f.join(" "),"'>"),w+=r(D,y),w+="</td>";if(k.showAggregates){var te=T.table_titles.reduce(function(e,t){return e[t]=!0,e},{});for(m=0;m<T.row_titles.length;m++){y=T.row_titles[m],D="",te[y]&&(t=a.findByKey(y),g=k.formatterOptions[t.valueType]||{},C.applyFormatterOptions(g),D=t.formatter(T.table[0][y],g),D=r(D,y)),w+="<td class='datatable-table-total ".concat(0===m?"datatable-table-total--start":""," datatable-cell--nullable'>"),w+=D,w+="</td>"}s.showAggregateDropdown&&(w+="<td class='datatable-table-total datatable-table-total--empty'></td>")}}if(F+="<tbody>",k.showTotalsTop&&(F+="<tr class='datatable-col-totals-row datatable-col-totals-row--top'>".concat(w,"</tr>")),k.showRows){var re=[];for(m=0;m<A.length;m++){var ne,ae=A[m],ie=m===A.length-1,oe=!1,se=R.row_ids[m],le="",ce="";for(ne=0;ne<R.rows[m].length;ne++){var ue=h=R.rows[m][ne];k.collapseRowHeaders&&re[ne]===se[ne]&&!oe&&(ue=""),0===ne&&re[ne]!==se[ne]&&(oe=!0);var de=ue,fe=n.getUrl(O.row[ne].key,se[ne],de);le+="<th colspan='".concat(0===ne?2:1,"' class='datatable-row-label' ng-non-bindable>"),de.length&&(le+=fe?"<a href='".concat(fe,"' target='_blank'>").concat(c(de),"</a>"):c(de)),le+="</th>"}if(x&&x[m]&&(0,xs.default)(x[m],function(e,t){e.length>0&&(0,xs.default)(e,function(e,r){var n=i.findByKey(M[t][r]);D=n.formatter(e),ce+="<th class='datatable-cell--nullable'>".concat(c(D),"</th>")})}),f=["datatable-row"],oe&&R.rows[0].length>1&&f.push("datatable-row--group-start"),F+="<tr class='".concat(f.join(" "),"' ng-class='{ \"datatable-row--last\": reportDatatable.canLoadMore && ")+ie+"}'>",F+=le,F+=ce,re=se,k.showMetrics){_=s.definition.metric.valueType;var pe=k.formatterOptions[_]||{};for(C.applyFormatterOptions(pe),ne=0;ne<ae.length;ne++)o=ae[ne],f=["datatable-cell","datatable-cell--nullable"],Y.starts[ne]&&f.push("datatable-cell--section-start"),Y.ends[ne]&&f.push("datatable-cell--section-end"),D=s.definition.metric.formatter(o[0][b],pe),F+="<td class='".concat(f.join(" "),"'>"),F+=r(D,y),F+="</td>"}if(k.showAggregates){for(ne=0;ne<T.row_titles.length;ne++){y=T.row_titles[ne],t=a.findByKey(y),g=k.formatterOptions[t.valueType]||{},C.applyFormatterOptions(g),D=t.formatter(T.row[m][0][y],g),F+="<td class='datatable-row-aggs ".concat(0===ne?"datatable-row-aggs--start":""," datatable-cell--nullable'>"),F+=r(D,y),F+="</td>"}if(k.sparklineOptions.show){F+="<td class='datatable-row-aggs'>";var ve=s.$new(!0);for(ve.data=[],ne=0;ne<ae.length;ne++)o=ae[ne],ve.data.push({key:R.columns[ne][0],val:o[0][k.sparklineOptions.cellAggregate]});F+=e('<sparkline data="data"></sparkline>')(ve)[0].outerHTML,F+="</td>"}s.showAggregateDropdown&&(F+="<td class='datatable-row-aggs datatable-row-aggs--empty'></td>")}F+="</tr>"}}if(k.showMetricSummary&&(F+="<tr class='datatable-col-totals-row' ng-show='!reportDatatable.canLoadMore || !reportDatatable.paginated'>",F+=w,F+="</tr>"),F+="</tbody>",F+="<tfoot ng-show='!reportDatatable.canLoadMore  || !reportDatatable.paginated'>",k.showMetricAggregates)for(T=C.data.aggregates,m=z=0;z<T.column_titles.length;m=++z){if(y=T.column_titles[m],t=a.findByKey(y),F+="<tr class='datatable-col-aggs-row'>",0===m&&(F+="<th rowspan='".concat(T.column_titles.length,"' class='datatable-col-aggs-header'>"),F+="<div class='datatable-col-aggs-header-outer'>",F+="<div class='datatable-col-aggs-header-inner'>Totals By Date Range</div>",F+="</div>",F+="</th>"),F+="<th colspan='".concat(R.rows[0].length+N,"' class='datatable-col-aggs-label'>"),F+=t.name,F+="</th>",k.showMetrics)for(m=0;m<T.column.length;m++)o=T.column[m],f=["datatable-col-aggs","datatable-cell--nullable"],m+1===T.column.length&&f.push("datatable-cell--last-col"),Y.starts[m]&&f.push("datatable-cell--section-start"),Y.ends[m]&&f.push("datatable-cell--section-end"),g=k.formatterOptions[t.valueType]||{},C.applyFormatterOptions(g),D=t.formatter(o[0][y],g),F+="<td class='".concat(f.join(" "),"'>"),F+=r(D,y),F+="</td>";if(k.showAggregates){var ge=T.row_titles.length;k.showAggregates&&(ge+=1),N&&(ge+=N),F+="<td colspan='".concat(ge,"' class='datatable-cell-empty'>"),F+="</td>"}F+="</tr>"}F+="</tfoot>",F+="<colgroup>".concat(new Array(E.length+N+2).join("<col></col>")),F+="<colgroup>".concat(new Array(R.columns.length+1).join("<col></col>")),F+="<colgroup>".concat(new Array(T.row_titles.length+1).join("<col></col>")),F+="</table>",F+="<div class='datatable-footer-actions'>",F+="<button class='datatable-load-more-button button' ng-show='reportDatatable.canLoadMore && reportDatatable.paginated' ng-click='config.loadMore()'>{{config.loadMoreText}}&hellip;</button>",F+="</div>",u.innerHTML=F,e(l.contents())(s);$(u).find(".datatable-cell, .datatable-col-label").mouseover(function(e){u.getElementsByTagName("colgroup")[1].getElementsByTagName("col")[$(this).index()-E.length-N].className+=" datatable-col--hover"}).mouseout(function(e){var t=u.getElementsByTagName("colgroup")[1].getElementsByTagName("col"),r=$(this).index()-E.length-N;t[r].className=t[r].className.replace(" datatable-col--hover","")})};s.$watchCollection("reportDatatable",function(e){!e||e.error||e.loading||f()},!0)}}}]);angular.module("reports.directives").directive("vendSpinner",function(){return{replace:!0,restrict:"E",scope:{loading:"=",position:"@"},template:'<div class="loading-overlay" ng-show="loading"> <div class="spinner" ng-class="positionClass"> <div class="spinner_ball"></div> <div class="spinner_ball"></div> <div class="spinner_ball"></div> </div> </div>',controller:["$scope",function(e){e.positionClass=e.position?"spinner--".concat(e.position):""}]}});angular.module("reports.directives").directive("zoomableGranularitySelector",function(){return{replace:!0,restrict:"E",scope:{zoom:"="},template:'<ul class="button-group"> <li><a class="button secondary" ng-click="setZoom(\'in\')">+</a></li> <li><a class="button fixed">{{display(zoom)}}</a></li> <li><a class="button secondary" ng-click="setZoom(\'out\')">-</a></li> </ul>',controller:["$scope",function(e){e.zoom="day";var t=["Hour","Day","Week","Month","Quarter","Year"],r=1;e.setZoom=function(n){switch(n){case"in":r>0&&r--;break;case"out":r<t.length-1&&r++}e.zoom=t[r].toLowerCase()},e.display=function(e){return e[0].toUpperCase()+e.slice(1)}}]}});var Es=function(e,t){return{get:function(r,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n=n?"/".concat(n):"",e(t.api2Path(r+n),a).get().$promise.then(function(e){return e.data})}}};Es.$inject=["$resource","Router"],angular.module("reports.factories").factory("apiResource",Es);var $s=function(e,t){var r=t.api2Path("balances/gift_cards"),n=t.api2Path("balances/gift_cards/report"),a=e(r),i=e(n);return{getDefaultList:function(){return a.get().$promise.then(function(e){return e.data})},getTotals:function(){return i.get().$promise.then(function(e){return e})},searchQuery:function(e){return a.get({card_number:e}).$promise.then(function(e){return e})}}};$s.$inject=["$resource","Router"],angular.module("reports.factories").factory("giftCardResource",$s);var js=function(e){return e&&e.__esModule?e:{default:e}}(ys);var Fs=function(e,t){var r=e(t.api2Path("inventory_movements/:productId"));return{getMovements:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t=(0,js.default)(t,{page_size:100,productId:e}),r.get(t).$promise}}};Fs.$inject=["$resource","Router"],angular.module("reports.factories").factory("productMovementsResource",Fs);var Is=function(e,t){var r=t.api2Path("xero/gift_cards/:giftCardNumber"),n=t.api2Path("xero/resend_gift_cards"),a=e(r,{giftCardNumber:"@giftCardNumber"},{getPostings:{method:"GET",params:{status:"@status"}}}),i=e(n);return{getFailedGiftCards:function(){return a.getPostings({status:"FAILED"}).$promise.then(function(e){return e.data})},resendFailedGiftCards:function(){return i.get().$promise}}};Is.$inject=["$resource","Router"],angular.module("reports.factories").factory("xeroResource",Is);var Gs=function(e,t){var r=t.api2Path("xero/manual_store_credits"),n=t.api2Path("xero/manual_store_credits/:action"),a=e(r,{status:"@status"}),i=e(n,{action:"@action"},{getPostings:{method:"POST",params:{action:"resend"}}});return{getFailedPosting:function(){return a.get({status:"FAILED"}).$promise.then(function(e){return e.data})},resendFailedManualStoreCredits:function(){return i.getPostings().$promise.then(function(e){return e.data})}}};Gs.$inject=["$resource","Router"],angular.module("reports.factories").factory("xeroManualStoreCreditResource",Gs);angular.module("reports.factories").factory("apiIdentificationHttpRequestInterceptor",function(){return{request:function(e){return e.headers["X-Requested-With"]="XMLHttpRequest",e}}}).config(["$httpProvider",function(e){return e.interceptors.push("apiIdentificationHttpRequestInterceptor")}]);angular.module("reports.factories").factory("authHttpResponseInterceptor",["$q","$location",function(e,t){return{responseError:function(r){return 401===r.status&&t.reload(),e.reject(r)}}}]).config(["$httpProvider",function(e){return e.interceptors.push("authHttpResponseInterceptor")}]);function Bs(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}angular.module("reports.factories").factory("BlobDownload",function(){return function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.blob=t,this.filename=r}var t,r,n;return t=e,(r=[{key:"download",value:function(){var e=document.createElement("a");e.href=window.URL.createObjectURL(this.blob),e.download=this.filename,document.body.appendChild(e);var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),e.dispatchEvent(t),document.body.removeChild(e)}}])&&Bs(t.prototype,r),n&&Bs(t,n),e}()});angular.module("reports.factories").factory("Bloodhound",function(){return window.Bloodhound});var Ns="Expected a function";var Vs=function(e){if("function"!=typeof e)throw new TypeError(Ns);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}};var Ls=function(e,t){return(Je(e)?tt:ii)(e,Vs(Jr(t,3)))},Us=Xs(Uo),qs=Xs(Mo),Ks=Xs(oi),zs=Xs(Eo),Ys=Xs(Za),Hs=Xs(va),Ws=Xs(Ls),Qs=Xs(Rs);function Xs(e){return e&&e.__esModule?e:{default:e}}function Zs(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}angular.module("reports.factories").factory("DatatableDefinition",["DimensionDefinitionsService","MetadataDefinitionsService","OrderRule","PersistedOptions","QueryDefinition","ReportOptionsService",function(e,t,r,n,a,i){return function(){function o(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),this.applyProductOrderRule=this.applyProductOrderRule.bind(this),this.applyGroupVariantsOrderRule=this.applyGroupVariantsOrderRule.bind(this),this.excludeInvalidAggregatesTransformer=this.excludeInvalidAggregatesTransformer.bind(this),this.includeOptionalAggregatesTransformer=this.includeOptionalAggregatesTransformer.bind(this),this.includeMetadataTransformer=this.includeMetadataTransformer.bind(this),this.includeSelectedMetricTransformer=this.includeSelectedMetricTransformer.bind(this),this.orderValidityTransformer=this.orderValidityTransformer.bind(this),this.includeProductsTransformer=this.includeProductsTransformer.bind(this),this.groupVariantsTransformer=this.groupVariantsTransformer.bind(this),this.includeGiftCardsTransformer=this.includeGiftCardsTransformer.bind(this),this.constrainInactiveInventory=this.constrainInactiveInventory.bind(this),(0,Hs.default)(this,e),this.order||(this.order=[]),this.options||this.loadAvailableOptions()}var s,l,c;return s=o,(l=[{key:"allDimensions",value:function(){for(var e=[],t=0,r=["row","column"];t<r.length;t++){var n=r[t],a=!0,i=!1,o=void 0;try{for(var s,l=this.report.dimensions[n][Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var c=s.value;e.push(c)}}catch(u){i=!0,o=u}finally{try{a||null==l.return||l.return()}finally{if(i)throw o}}}return e}},{key:"setDatatableOption",value:function(e,t){(new n).setOption(e,t)}},{key:"getDatatableOption",value:function(e){return(new n).getOption(e)}},{key:"loadAvailableOptions",value:function(){this.options=i.availableOptions(this)}},{key:"applyDefaultOrder",value:function(){var e=[],t=!0,n=!1,a=void 0;try{for(var i,o=this.report.default_order[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var s=i.value;e.push(new r(s))}}catch(l){n=!0,a=l}finally{try{t||null==o.return||o.return()}finally{if(n)throw a}}this.order=e,this.canIncludeProducts&&this.includeProducts&&this.applyProductOrderRule(),this.options.groupVariants&&!1===this.options.groupVariants.value&&this.applyGroupVariantsOrderRule()}},{key:"applyProductOrderRule",value:function(){this.order.push(new r({dimension:"product",alphabetical:!1,metric:this.defaultOrderOnMetric(),direction:"desc"}))}},{key:"applyGroupVariantsOrderRule",value:function(){for(var e=0;e<this.order.length;e++){var t=this.order[e];"product"===t.dimension?this.order[e].dimension="product_variant":"inventory_product"===t.dimension&&(this.order[e].dimension="inventory_product_variant")}}},{key:"defaultOrderOnMetric",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.report,t=!0,r=!1,n=void 0;try{for(var a,i=e.aggregates.row[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var o=a.value;if(o.sortable&&o.sortable[e.type])return o.key}}catch(s){r=!0,n=s}finally{try{t||null==i.return||i.return()}finally{if(r)throw n}}}},{key:"queryDefinition",value:function(e,t){return this.transformedReport=angular.copy(this.report),this.transform(),new a(this.transformedReport,this.granularityDateSelection,this.order,t,e,this.filters)}},{key:"identifier",value:function(){var t="vend-";this.metric&&(t+=this.metric.key);var r=this.report.dimensions.row[this.report.dimensions.row.length-1];return r===e.findByKey("summary")?t+="-sales_summary":(t+="-for-",t+=r.key),t+="-by-",t+=this.granularityDateSelection.granularity.key}},{key:"transformers",value:function(){return[this.includeProductsTransformer,this.includeSelectedMetricTransformer,this.constrainInactiveInventory,this.groupVariantsTransformer,this.includeGiftCardsTransformer,this.includeOptionalAggregatesTransformer,this.excludeInvalidAggregatesTransformer,this.orderValidityTransformer,this.includeMetadataTransformer]}},{key:"transform",value:function(){return this.transformers().map(function(e){return e()})}},{key:"excludeInvalidAggregatesTransformer",value:function(){var e=this;"all"!==this.granularityDateSelection.periodType&&(0,Us.default)(this.transformedReport.aggregates,function(t,r){e.transformedReport.aggregates[r]=(0,Ws.default)(t,{config:{excludeOnDateRange:!0}})})}},{key:"includeOptionalAggregatesTransformer",value:function(){var e=this;if(this.optionalAggregates){var t=(0,Ks.default)(this.transformedReport.aggregates.optional,function(t){return(0,zs.default)(e.optionalAggregates,t.key)});this.transformedReport.aggregates.row=(0,Qs.default)(this.transformedReport.aggregates.row,t)}}},{key:"includeMetadataTransformer",value:function(){var e,r=this,n=t.requiredForReport(this.transformedReport);n&&(e=(0,Ys.default)(n,function(e){return e.key})),(this.dimensionMetadata||e)&&(0,qs.default)(this.transformedReport.dimensions.row,function(t){var n=[];(0,qs.default)(r.dimensionMetadata,function(e){t.key.replace("_variant","").replace("inventory_","")===e.dimension.replace("_variant","").replace("inventory_","")&&e.metadata&&e.metadata.length&&(n=e.metadata)}),t.metadata=n,e&&(0,Hs.default)(t.metadata,e)})}},{key:"includeSelectedMetricTransformer",value:function(){var e=this;this.metric&&(0,Us.default)(this.transformedReport.aggregates,function(t,r){e.transformedReport.aggregates[r]=(0,Ws.default)(t,{key:e.metric.key}),"optional"!==r&&e.transformedReport.aggregates[r].unshift(e.metric)})}},{key:"orderValidityTransformer",value:function(){if(this.order.length===this.transformedReport.dimensions.row.length){var t=e.keySet(this.transformedReport.dimensions.row),r=(0,Ys.default)(this.order,"dimension"),n=!0,a=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var l=o.value;(0,zs.default)(r,l)||this.applyDefaultOrder()}}catch(m){a=!0,i=m}finally{try{n||null==s.return||s.return()}finally{if(a)throw i}}var c=(0,Ys.default)(this.order,"metric"),u=(0,Ys.default)(this.transformedReport.aggregates.row,"key"),d=!0,f=!1,p=void 0;try{for(var v,g=c[Symbol.iterator]();!(d=(v=g.next()).done);d=!0){var h=v.value;h&&!(0,zs.default)(u,h)&&this.applyDefaultOrder()}}catch(m){f=!0,p=m}finally{try{d||null==g.return||g.return()}finally{if(f)throw p}}}else this.applyDefaultOrder()}},{key:"includeProductsTransformer",value:function(){var t=e.findByKey("product");(0,zs.default)(this.report.dimensions.rowOptional,t)&&this.includeProducts&&this.transformedReport.dimensions.row.push(t)}},{key:"groupVariantsTransformer",value:function(){if(this.options.groupVariants&&!1===this.options.groupVariants.value){var t=this.transformedReport.dimensions.row.map(function(e){return e.key}).indexOf(e.findByKey("product").key);-1!==t&&(this.transformedReport.dimensions.row[t]=e.findByKey("product_variant")),-1!==(t=this.transformedReport.dimensions.row.map(function(e){return e.key}).indexOf(e.findByKey("inventory_product").key))&&(this.transformedReport.dimensions.row[t]=e.findByKey("inventory_product_variant"))}return null}},{key:"includeGiftCardsTransformer",value:function(){this.options.includeGiftCards&&!this.options.includeGiftCards.value&&(this.transformedReport.filters||(this.transformedReport.filters=[]),this.transformedReport.filters.push({id:"true",type:"exclude_gift_cards"}))}},{key:"constrainInactiveInventory",value:function(){!1===(this.options&&this.options.showInactiveProducts&&this.options.showInactiveProducts.value)&&(this.transformedReport.filters||(this.transformedReport.filters=[]),this.transformedReport.filters.push({id:"true",type:"active_inventory"}))}}])&&Zs(s.prototype,l),c&&Zs(s,c),o}()}]);function Js(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}angular.module("reports.factories").factory("DefinitionEventData",function(){return function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.getEventMetadata=this.getEventMetadata.bind(this),this.definition=t}var t,r,n;return t=e,(r=[{key:"getEventMetadata",value:function(){var e=this.definition&&this.definition.report&&this.definition.report.key,t=this.definition&&this.definition.metric&&this.definition.metric.key,r=this.definition.granularityDateSelection;return{startDate:r.period?moment(r.getPeriodStartDate()).unix():null,endDate:r.period?moment(r.getPeriodEndDate()).unix():null,isFiltered:this.definition.filters.length>0,reportType:e,metricType:t}}}])&&Js(t.prototype,r),n&&Js(t,n),e}()});function el(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}angular.module("reports.factories").factory("DatatableOrder",function(){return function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.orderByAggregate=this.orderByAggregate.bind(this),this.orderByDimension=this.orderByDimension.bind(this),this.directionClasses=t}var t,r,n;return t=e,(r=[{key:"orderByAggregate",value:function(e,t){t===e[0].metric&&this._toggleDirection(e),e.forEach(function(e){return e.setMetric(t)})}},{key:"orderByDimension",value:function(e){!0===e[0].alphabetical?this._toggleDirection(e):this._setDirection(e,"asc"),e[0].setAlphabetical()}},{key:"getAggregateHeaderClass",value:function(e,t){if(e.metric===t)return this._directionClass(e.direction)}},{key:"getDimensionHeaderClass",value:function(e,t){if(!0===e.alphabetical&&e.dimension===t)return this._directionClass(e.direction)}},{key:"_directionClass",value:function(e){return this.directionClasses[e]||""}},{key:"_toggleDirection",value:function(e){"asc"===e[0].direction?this._setDirection(e,"desc"):this._setDirection(e,"asc")}},{key:"_setDirection",value:function(e,t){["asc","desc"].includes(t)&&e.forEach(function(e){return e.direction=t})}}])&&el(t.prototype,r),n&&el(t,n),e}()});var tl=pa(function(e,t){Hn(t,Zn(t),e)}),rl={};function nl(){this.hashes={}}Object.defineProperty(rl,"__esModule",{value:!0}),rl.default=nl,nl.prototype={constructor:nl,hash:function(e){var t,r=Object.keys(e),n=r.length;r.sort();var a="";for(t=0;t<n;t++){a+=":"+e[r[t]]}return a},put:function(e,t){this.hashes[this.hash(e)]=t},get:function(e){return this.hashes[this.hash(e)]},keys:function(){return this.hashes},values:function(){var e=[];for(var t in this.hashes)e.push(this.hashes[t]);return e}};var al=sl(tl),il=sl(Za),ol=sl(rl);function sl(e){return e&&e.__esModule?e:{default:e}}function ll(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}angular.module("reports.factories").factory("DatatableView",["ColumnDefinitionsService","Metric","ReportData","RequestHandler",function(e,t,r,n){return function(){function a(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),this.reportDefinition=e.report,this.metric=e.metric,this.filters=e.filters,this.target=e.target,this.granularityDateSelection=e.granularityDateSelection,this.datatableColDefs=[],this.data=[],this.colLabelValues=[],this.columnDefinition=[],this.pivotTableData=[],this.datatable=new DataTable}var i,o,s;return i=a,(o=[{key:"updateData",value:function(){var e=this;return this.updatePeriodAndDateFields(),this.reportDefinition.constraints=(0,il.default)(this.filters),this.data=r.get(this.reportDefinition.createQueryDefinition(),this.period),n.handle(this.data,{display_error:!0,error_message:"Sorry, we couldnâ€™t fetch some data. Please refresh this page and try again."}),this.data.then(function(){e.setRowDates(),e.updatePivot()}),this.data}},{key:"setRowDates",value:function(){var e=!0,t=!1,r=void 0;try{for(var n,a=this.data.rows[Symbol.iterator]();!(e=(n=a.next()).done);e=!0){var i=n.value;i.year&&(i.date=i.year),i.quarter&&(i.date=i.quarter),i.month&&(i.date=i.month),i.week&&(i.date=i.week),i.day&&(i.date=i.day),i.hour&&(i.date=i.hour)}}catch(o){t=!0,r=o}finally{try{e||null==a.return||a.return()}finally{if(t)throw r}}}},{key:"updatePeriodAndDateFields",value:function(){var t;switch(this.reportDefinition.zoom=this.granularityDateSelection.granularity.key,this.reportDefinition.cols=[],this.granularityDateSelection.granularity.key){case"year":this.reportDefinition.cols=this.reportDefinition.cols.concat([e.findByKey("year")]),t=4;break;case"quarter":this.reportDefinition.cols=this.reportDefinition.cols.concat([e.findByKey("year"),e.findByKey("quarter")]),t=8;break;case"month":this.reportDefinition.cols=this.reportDefinition.cols.concat([e.findByKey("month"),e.findByKey("year")]),t=5;break;case"week":this.reportDefinition.cols=this.reportDefinition.cols.concat([e.findByKey("week")]),t=8;break;case"day":this.reportDefinition.cols=this.reportDefinition.cols.concat([e.findByKey("month"),e.findByKey("day")]),t=7;break;case"hour":this.reportDefinition.cols=this.reportDefinition.cols.concat([e.findByKey("month"),e.findByKey("day"),e.findByKey("hour")]),t=8}this.granularityDateSelection.periodCount||this.granularityDateSelection.update({periodCount:t}),this.period=this.granularityDateSelection.period}},{key:"updatePivot",value:function(){var e=new ol.default,t=new ol.default,r=new ol.default,n=!0,a=!1,i=void 0;try{for(var o,s=this.data.rows[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var l,c,u=o.value,d={},f={},p={},v=!0,g=!1,h=void 0;try{for(var m,y=this.reportDefinition.rows[Symbol.iterator]();!(v=(m=y.next()).done);v=!0){var b=m.value;c=b.format(u),d[b.key]=c,f[b.key]=c}}catch(R){g=!0,h=R}finally{try{v||null==y.return||y.return()}finally{if(g)throw h}}var w=!0,D=!1,_=void 0;try{for(var C,S=this.reportDefinition.cols[Symbol.iterator]();!(w=(C=S.next()).done);w=!0)c=(l=C.value).format(u),d[l.key]=c,p[l.key]=c}catch(R){D=!0,_=R}finally{try{w||null==S.return||S.return()}finally{if(D)throw _}}d[l.key]=c,p[l.key]=c;var k=e.get(d);void 0===k&&(e.put(d,[]),void 0===(k=e.get(d))&&(e.put(d,[]),k=e.get(d))),k.push(u),0!==Object.keys(p).length&&(t.put(p,p),r.put(f,f))}}catch(R){a=!0,i=R}finally{try{n||null==s.return||s.return()}finally{if(a)throw i}}this.createDatatableColDefinitions(t.values()),this.initialiseDatatable(),this.createDatatableView(e,r.values(),t.values())}},{key:"rowDefinitions",value:function(){return this.reportDefinition.rows}},{key:"addRowDefstoColDefs",value:function(){var e=this;this.rowDefinitions().forEach(function(t){return e.datatableColDefs.push({name:t.key,type:DataTable.ColumnType.TEXT,classes:"text-left row-heading",width:t.width,value:function(e,t,r){return e.rowHeadings[r]}})})}},{key:"addColLabelsToColDefs",value:function(e){var r=this,n=this.metric,a=this.numberOfRowHeaders();e.forEach(function(e){return r.datatableColDefs.push({name:e,type:DataTable.ColumnType.INTEGER,classes:"text-right",width:100,value:function(e,r,i){return t.metrics.fn_sum(e.colData[i-a],function(e){return n.getValue(e)})},formatter:function(e){var t=e.toFixed(0);return n.formatter&&(t=n.formatter(e)),0===e?"<span class='na'>".concat(t,"</span>"):t}})})}},{key:"createDatatableColDefinitions",value:function(e){var t=this;this.datatableColDefs=[],this.addRowDefstoColDefs(),this.addColLabelsToColDefs(e),this.reportDefinition.aggregates.forEach(function(e){return t.datatableColDefs.push((0,al.default)(e,{width:100,classes:"aggregate"}))})}},{key:"numberOfRowHeaders",value:function(){return this.reportDefinition.rows.length}},{key:"initialiseDatatable",value:function(){this.datatable.initialise(this.target,this.pivotTableData,{columns:this.datatableColDefs,numberOfRowHeaders:1,numberOfRows:200,showControls:!0})}},{key:"createDatatableView",value:function(e,t,r){this.pivotTableData=[];for(var n=t.length,a=r.length,i={},o=[],s=0,l=n;s<l;s++){for(var c={rowHeadings:[],colData:[],allDataForRow:[]},u=0,d=this.numberOfRowHeaders();u<d;u++){var f=t[s][this.reportDefinition.rows[u].key];c.rowHeadings.push(f)}(0,al.default)(i,t[s]);for(var p=0;p<r.length;p++){var v=r[p];(0,al.default)(i,v);var g=e.get(i);void 0!==g?c.colData.push(g):c.colData.push([]),o[p]=o[p]||[],o[p]=o[p].concat(g)}if(0===a){var h=e.get(i);h&&c.colData.push(h)}var m=[].concat.apply([],c.colData);c.allDataForRow=m,this.pivotTableData.push(c)}if(this.reportDefinition.aggregates.length>0){var y={rowHeadings:[],colData:[],allDataForRow:[]};y.rowHeadings=Array.apply([],new Array(this.reportDefinition.aggregates.length)).map(String.prototype.valueOf,""),y.rowHeadings[0]=this.reportDefinition.aggregates[0].key;for(var b=0,w=o;b<w.length;b++){var D=w[b];y.colData.push(D);var _=!0,C=!1,S=void 0;try{for(var k,R=D[Symbol.iterator]();!(_=(k=R.next()).done);_=!0){var T=k.value;y.allDataForRow.push(T)}}catch(x){C=!0,S=x}finally{try{_||null==R.return||R.return()}finally{if(C)throw S}}}}this.datatable.reprocessData(this.pivotTableData)}},{key:"reprocessData",value:function(){this.updatePivot(),this.datatable.reprocessData(this.pivotTableData)}}])&&ll(i.prototype,o),s&&ll(i,s),a}()}]);function cl(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}angular.module("reports.factories").factory("Event",["$http","Router",function(e,t){return function(){function r(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r)}var n,a,i;return n=r,i=[{key:"send",value:function(r,n){var a={event:r,data:n},i=angular.toJson(a);return e({url:t.api2Path("reporting_events"),params:{event:i},method:"POST"})}}],(a=null)&&cl(n.prototype,a),i&&cl(n,i),r}()}]);angular.module("reports.factories").factory("FilterTag",["FilterDefinitionsService",function(e){return function t(r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.id=r.id,this.name=r.name,this.type=r.type;var n=e.findByKey(this.type);this.typeName=n.name}}]);function ul(e,t,r){return(ul=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var a=new(Function.bind.apply(e,n));return r&&dl(a,r.prototype),a}).apply(null,arguments)}function dl(e,t){return(dl=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function fl(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}angular.module("reports.factories").factory("FlashNotification",["$rootScope",function(e){return e.notifications=[],function(){function t(e,r,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.message=e,this.type=r||"notice",this.header=n,this.countdown=a}var r,n,a;return r=t,a=[{key:"display",value:function(){for(var r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];var i=ul(t,n);e.notifications.push(i)}},{key:"alert",value:function(e){this.display(e,"alert")}},{key:"success",value:function(e){this.display(e,"success")}},{key:"successWithTick",value:function(e){this.display("âœ” ".concat(e),"success")}},{key:"alertWithCross",value:function(e){this.display("âœ˜ ".concat(e),"alert")}}],(n=null)&&fl(r.prototype,n),a&&fl(r,a),t}()}]);angular.module("reports.factories").factory("Formatters",["vendCurrencyFilter","vendDateFilter","vendNumberFilter","vendPercentFilter",function(e,t,r,n){return{named:function(a){switch(a){case"currency":return e();case"number":return r();case"number_positive":return r({min:.1});case"percent":return n();case"percent_precise":return n({format:"(0,0.[00]%)"});case"date":return t();default:return function(e){return e}}}}}]);var pl=h.isFinite;var vl=function(e){return"number"==typeof e&&pl(e)},gl=ml(ys),hl=ml(vl);function ml(e){return e&&e.__esModule?e:{default:e}}function yl(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function bl(e,t,r){return t&&yl(e.prototype,t),r&&yl(e,r),e}angular.module("reports.factories").factory("GranularityDateSelection",["DatetimeService","GranularityDefinitionsService","HiReportService","Period",function(e,t,r,n){var a=new Error("Invalid date"),i=new Error("Invalid granularity"),o={periodType:"last",selectedDate:new Date,minDate:null,periodCount:4,isLocalAsUTC:!0,restrictFutureEndDate:!1,granularity:t.default()};return function(){function s(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),this._config={},(0,gl.default)(e,o),"single"===e.periodType&&(e.isLocalAsUTC=!1,e.minDate=r.startDate),this.updateConfig(e),this.createPeriod()}return bl(s,null,[{key:"getSingleSelection",value:function(){return new s({periodType:"single",startDate:moment().startOf("day"),granularity:t.findByKey("single")})}},{key:"getRangeSelection",value:function(e,r){return e||(e=moment().subtract(1,"week")),new s({periodType:"range",startDate:e,minDate:r,granularity:t.findByKey("range")})}},{key:"getAllSelection",value:function(){return new s({periodType:"all",startDate:null,endDate:null,granularity:t.findByKey("all")})}},{key:"getCompareSelection",value:function(){return new s(o)}}]),bl(s,[{key:"_formatConfigValues",value:function(e){e.periodType||(e.periodType=o.periodType),(0,hl.default)(e.periodCount)||(e.periodCount=o.periodCount),"current_granularity"===e.periodType&&this._isValidDate(e.selectedDate)}},{key:"_isValidDate",value:function(e){if(!(e instanceof Date||e._isAMomentObject))throw a}},{key:"_isValidGranularity",value:function(e){if(!(e instanceof Granularity))throw i}},{key:"updateConfig",value:function(e){Object.assign(this._config,e),this._formatConfigValues(this._config);var t=this._config;this.minDate=t.minDate,this.periodType=t.periodType,this.selectedDate=t.selectedDate,this.periodCount=t.periodCount,this.granularity=t.granularity,this.startDate=t.startDate,this.endDate=t.endDate}},{key:"getDateRangeCopy",value:function(){var e=angular.copy(this);return e.start||delete e.periodType,new s(e)}},{key:"getQueryPeriod",value:function(){return this._config.isLocalAsUTC?this.period.localAsUTC():this.period}},{key:"getGranularityStartDate",value:function(){return this.getSelectedMoment().startOf(this.granularity.key).toDate()}},{key:"getGranularityEndDate",value:function(){return this.getSelectedMoment().endOf(this.granularity.key).toDate()}},{key:"getPeriodStartDate",value:function(){return moment(this.period.start).toDate()}},{key:"getPeriodEndDate",value:function(){return moment(this.period.end).toDate()}},{key:"getSelectedDate",value:function(){return moment(this.selectedDate).toDate()}},{key:"getSelectedMoment",value:function(){return moment(this.selectedDate)}},{key:"shiftSelectedDate",value:function(e){var t;return!("number"!=typeof e&&!this.canShiftSelectedDateUp)&&(t=e<0?this.getSelectedMoment().subtract(Math.abs(e),this.granularity.key):this.getSelectedMoment().add(Math.abs(e),this.granularity.key),this.update({selectedDate:t}))}},{key:"canShiftSelectedDateUp",value:function(){return"current_granularity"!==this.periodType||!e.afterTomorrow(moment(this.selectedDate).add(1,this.granularity.key))}},{key:"update",value:function(e){return this.updateConfig(e),this.createPeriod()}},{key:"createPeriod",value:function(){var t,r;if("all"!==this.periodType){switch(this.periodType){case"to_date":r=moment().startOf(this.granularity.key),t=moment().startOf("second");break;case"last_granularity":r=moment().subtract(1,this.granularity.key).startOf(this.granularity.key),t=moment().subtract(1,this.granularity.key).endOf(this.granularity.key);break;case"last":r=moment().subtract(this.periodCount-1,this.granularity.key).startOf(this.granularity.key),t=moment().endOf(this.granularity.key);break;case"last_beginning":r=moment(this.selectedDate).startOf(this.granularity.key),t=moment(this.selectedDate).add(this.periodCount-1,this.granularity.key).endOf(this.granularity.key);break;case"current_granularity":r=moment(this.selectedDate).startOf(this.granularity.key),r=moment(r).subtract(this.periodCount-1,this.granularity.key),t=moment(this.selectedDate).endOf(this.granularity.key);break;case"range":r=moment(this.startDate).startOf("day"),t=moment(this.endDate).endOf("day");break;case"single":r=moment(this.startDate).startOf("day"),t=moment(this.startDate).endOf("day")}this._config.restrictFutureEndDate&&e.afterTomorrow(t)&&(t=moment().add(1,this._config.restrictFutureEndDate).endOf(this._config.restrictFutureEndDate));var a=r.toDate(),i=t.toDate();return this.period=new n(a,i),this.period}this.period=null}}]),s}()}]);angular.module("reports.factories").factory("LocalAsUTCize",function(){return function(e){var t=moment(e);return t.add(t.utcOffset(),"minutes").toDate()}});function wl(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}angular.module("reports.factories").factory("Metric",function(){var e=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.calculate=t,this._dataStore={}}var t,r,n;return t=e,(r=[{key:"calculateAndStore",value:function(e,t){this._dataStore[e]=this.calculate(t)}},{key:"getChartData",value:function(){var e=[];return angular.forEach(this._dataStore,function(t,r){return e.push({date:moment(r).toDate(),value:t})}),e.sort(function(e,t){return e.date-t.date}),e}},{key:"get",value:function(e){return+this._dataStore[e]}},{key:"clone",value:function(){return new e(this.calculate)}},{key:"compare",value:function(e,t){var r=this.get(t);return parseInt(100*(this.get(e)-r)/r)}}])&&wl(t.prototype,r),n&&wl(t,n),e}();return e.metrics={fn_sum:function(e,t){return void 0===e?0:e.reduce(function(e,r){return e+t(r)},0)},revenue:new e(function(e){return e.reduce(function(e,t){return e+t.price},0)}),sales:new e(function(e){return e.reduce(function(e,t){return e+t.quantity},0)}),profit:new e(function(e){return e.reduce(function(e,t){return e+t.profit*t.quantity},0)}),basketMetric:new e(function(e){var t=e.reduce(function(e,t){return e+t.price},0),r=e.reduce(function(e,t){return e+t.quantity},0);return 0===r?0:t/r}),returns:new e(function(e){return e.reduce(function(e,t){return e+(t.quantity>0?0:-t.quantity)},0)})},e});angular.module("reports.factories").factory("NumeralFormatBuilder",function(){return function(e){var t;e.significantFigures&&(t=e.significantFigures-1);var r="0,0",n=1+(e.decimalPlaces||t||0),a=Array(n).join(0),i=".";return e.significantFigures?e.hasDecimalPlaces?i="[.]".concat(a):a.length>0&&(i=".[".concat(a,"]")):!1===e.strictDecimalPlaces?i="[.]".concat(a):e.decimalPlaces?i=".".concat(a):a.length>0&&(i=".[".concat(a,"]")),r="".concat(r).concat(i),e.abbreviate&&(r="".concat(r,"a")),r}});function Dl(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}angular.module("reports.factories").factory("OrderRule",function(){var e=["asc","desc"],t=new Error("Order rule must have a valid direction"),r=new Error("Order rule must be alphabetical or for a metric");return function(){function n(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this.dimension=e.dimension,this.direction=e.direction,this.metric=e.metric,this.alphabetical=e.alphabetical,this.valid()}var a,i,o;return a=n,(i=[{key:"valid",value:function(){if(!e.includes(this.direction))throw t;if(!this.metric&&!this.alphabetical)throw r;return!0}},{key:"setMetric",value:function(e){this.alphabetical=!1,this.metric=e}},{key:"setAlphabetical",value:function(){this.metric=void 0,this.alphabetical=!0}}])&&Dl(a.prototype,i),o&&Dl(a,o),n}()});function _l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}angular.module("reports.factories").factory("OrderedHash",function(){return function(){function e(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._keys=[],this._vals={},angular.forEach(r,function(e,r){t.push(r,e)})}var t,r,n;return t=e,(r=[{key:"push",value:function(e,t){this._vals[e]||this._keys.push(e),this._vals[e]=t}},{key:"add",value:function(e,t){this._vals[e]?this._vals[e]+=t:(this._keys.push(e),this._vals[e]=t)}},{key:"length",value:function(){return this._keys.length}},{key:"at",value:function(e){return this.val(this._keys[e])}},{key:"first",value:function(){return this.val(this._keys[0])}},{key:"last",value:function(){return this.val(this._keys[this._keys.length-1])}},{key:"keys",value:function(){return this._keys}},{key:"val",value:function(e){return this._vals[e]}},{key:"vals",value:function(){return this._vals}},{key:"array",value:function(){var e=this;return this._keys.map(function(t){return{key:t,val:e._vals[t]}})}}])&&_l(t.prototype,r),n&&_l(t,n),e}()});var Cl=function(e){return e&&e.__esModule?e:{default:e}}(ys);function Sl(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}angular.module("reports.factories").factory("PercentageChange",function(){return function(){function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.currentValue=t,this.previousValue=r,this.options=n;(0,Cl.default)(this.options,{postiveInfinityValue:"Up",negativeInfinityValue:"Down",NaNValue:"No change",neutralValue:"No change",formatter:function(e){return"".concat(e.toFixed(),"%")}})}var t,r,n;return t=e,(r=[{key:"asDecimal",value:function(){return this.currentValue/this.previousValue}},{key:"asPercent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return Number((100*(this.asDecimal()-1)).toFixed(e))}},{key:"absoluteValue",value:function(){return Math.abs(this.asPercent())}},{key:"type",value:function(){if(this.isNaN())return"neutral";if(this.isPositiveInfinity())return"positive";if(this.isNegativeInfinity())return"negative";var e=this.asPercent();return e<0?"negative":e>0?"positive":"neutral"}},{key:"isNaN",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){return isNaN(this.asDecimal())})},{key:"isInfinity",value:function(){return this.asDecimal()===1/0||this.asDecimal()===-1/0}},{key:"isPositiveInfinity",value:function(){return this.asDecimal()===Number.POSITIVE_INFINITY}},{key:"isNegativeInfinity",value:function(){return this.asDecimal()===Number.NEGATIVE_INFINITY}},{key:"displayChange",value:function(){return this.isNaN()?this.options.NaNValue:"neutral"===this.type()?this.options.neutralValue:this.isPositiveInfinity()?this.options.postiveInfinityValue:this.isNegativeInfinity()?this.options.negativeInfinityValue:this.options.formatter(this.absoluteValue())}}])&&Sl(t.prototype,r),n&&Sl(t,n),e}()});function kl(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}angular.module("reports.factories").factory("Period",["LocalAsUTCize",function(e){return function(){function t(e,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.start=e,this.end=r}var r,n,a;return r=t,(n=[{key:"localAsUTC",value:function(){return{start:e(this.start),end:e(this.end)}}},{key:"lengthInDays",value:function(){return moment(this.end).diff(this.start,"days")}}])&&kl(r.prototype,n),a&&kl(r,a),t}()}]);var Rl=function(e,t){return e&&Hn(t,qt(t),e)};var Tl=function(e,t){return e&&Hn(t,Zn(t),e)};var xl=function(e,t){return Hn(e,it(e),t)},Ml=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)Ze(t,it(e)),e=jn(e);return t}:rt;var Ol=function(e,t){return Hn(e,Ml(e),t)};var Al=function(e){return et(e,Zn,Ml)},Pl=Object.prototype.hasOwnProperty;var El=function(e){var t=e.length,r=new e.constructor(t);return t&&"string"==typeof e[0]&&Pl.call(e,"index")&&(r.index=e.index,r.input=e.input),r};var $l=function(e,t){var r=t?On(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)},jl=/\w*$/;var Fl=function(e){var t=new e.constructor(e.source,jl.exec(e));return t.lastIndex=e.lastIndex,t},Il=m?m.prototype:void 0,Gl=Il?Il.valueOf:void 0;var Bl=function(e){return Gl?Object(Gl.call(e)):{}},Nl="[object Boolean]",Vl="[object Date]",Ll="[object Map]",Ul="[object Number]",ql="[object RegExp]",Kl="[object Set]",zl="[object String]",Yl="[object Symbol]",Hl="[object ArrayBuffer]",Wl="[object DataView]",Ql="[object Float32Array]",Xl="[object Float64Array]",Zl="[object Int8Array]",Jl="[object Int16Array]",ec="[object Int32Array]",tc="[object Uint8Array]",rc="[object Uint8ClampedArray]",nc="[object Uint16Array]",ac="[object Uint32Array]";var ic=function(e,t,r){var n=e.constructor;switch(t){case Hl:return On(e);case Nl:case Vl:return new n(+e);case Wl:return $l(e,r);case Ql:case Xl:case Zl:case Jl:case ec:case tc:case rc:case nc:case ac:return An(e,r);case Ll:return new n;case Ul:case zl:return new n(e);case ql:return Fl(e);case Kl:return new n;case Yl:return Bl(e)}},oc="[object Map]";var sc=function(e){return st(e)&&ir(e)==oc},lc=xt&&xt.isMap,cc=lc?Tt(lc):sc,uc="[object Set]";var dc=function(e){return st(e)&&ir(e)==uc},fc=xt&&xt.isSet,pc=fc?Tt(fc):dc,vc=1,gc=2,hc=4,mc="[object Arguments]",yc="[object Function]",bc="[object GeneratorFunction]",wc="[object Object]",Dc={};Dc[mc]=Dc["[object Array]"]=Dc["[object ArrayBuffer]"]=Dc["[object DataView]"]=Dc["[object Boolean]"]=Dc["[object Date]"]=Dc["[object Float32Array]"]=Dc["[object Float64Array]"]=Dc["[object Int8Array]"]=Dc["[object Int16Array]"]=Dc["[object Int32Array]"]=Dc["[object Map]"]=Dc["[object Number]"]=Dc[wc]=Dc["[object RegExp]"]=Dc["[object Set]"]=Dc["[object String]"]=Dc["[object Symbol]"]=Dc["[object Uint8Array]"]=Dc["[object Uint8ClampedArray]"]=Dc["[object Uint16Array]"]=Dc["[object Uint32Array]"]=!0,Dc["[object Error]"]=Dc[yc]=Dc["[object WeakMap]"]=!1;var _c=function e(t,r,n,a,i,o){var s,l=r&vc,c=r&gc,u=r&hc;if(n&&(s=i?n(t,a,i,o):n(t)),void 0!==s)return s;if(!M(t))return t;var d=Je(t);if(d){if(s=El(t),!l)return Pn(t,s)}else{var f=ir(t),p=f==yc||f==bc;if(gt(t))return kn(t,l);if(f==wc||f==mc||p&&!i){if(s=c||p?{}:Fn(t),!l)return c?Ol(t,Tl(s,t)):xl(t,Rl(s,t))}else{if(!Dc[f])return i?t:{};s=ic(t,f,l)}}o||(o=new _e);var v=o.get(t);if(v)return v;if(o.set(t,s),pc(t))return t.forEach(function(a){s.add(e(a,r,n,a,t,o))}),s;if(cc(t))return t.forEach(function(a,i){s.set(i,e(a,r,n,i,t,o))}),s;var g=u?c?Al:Kt:c?keysIn:qt,h=d?void 0:g(t);return To(h||t,function(a,i){h&&(a=t[i=a]),Yn(s,i,e(a,r,n,i,t,o))}),s};var Cc=function(e){return qn(e)?void 0:e};var Sc=function(e){return e&&e.__esModule?e:{default:e}}(function(e){return ua(aa(e,void 0,Ro),e+"")}(function(e,t){var r={};if(null==e)return r;var n=!1;t=Pr(t,function(t){return t=Gr(t,e),n||(n=t.length>1),t}),Hn(e,Al(e),r),n&&(r=_c(r,7,Cc));for(var a=t.length;a--;)Na(r,t[a]);return r}));function kc(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}angular.module("reports.factories").factory("PersistedOptions",["UserConfig",function(e){return function(){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.userConfig=new e,this.datatableOptions=this.userConfig.get("datatable_options")||this._initPersistedOptions()}var r,n,a;return r=t,(n=[{key:"_initPersistedOptions",value:function(){var e=this._getDefaultPersistedOptions();return this.userConfig.set("datatable_options",e),e}},{key:"setDatatableOption",value:function(e,t){null!=t&&(this.datatableOptions[e]=t,this.userConfig.set("datatable_options",this.datatableOptions))}},{key:"removeOption",value:function(e){this.datatableOptions=(0,Sc.default)(this.datatableOptions,e),this.userConfig.set("datatable_options",this.datatableOptions)}},{key:"getDatatableOption",value:function(e){return this.userConfig.get("datatable_options",this.datatableOptions)[e]}},{key:"_formatOptionBoolean",value:function(e){return"true"===e||!0===e}},{key:"_validateOptionBoolean",value:function(e){return"true"===(e=String(e))||"false"===e}},{key:"_getDefaultPersistedOptions",value:function(){return{groupVariants:!0,showInactiveProducts:!1}}},{key:"getOption",value:function(e){return this.datatableOptions[e]||{}}},{key:"setOption",value:function(e,t){this.setDatatableOption(e,t)}}])&&kc(r.prototype,n),a&&kc(r,a),t}()}]);var Rc=xc(oi),Tc=xc(Za);function xc(e){return e&&e.__esModule?e:{default:e}}function Mc(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Oc(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}angular.module("reports.factories").factory("QueryDefinition",["AggregateDefinitionsService",function(e){var t=function(e){return{key:e.key,metadata:e.metadata||[]}},r=function(e){return(0,Rc.default)(e,function(e){return!0!==e.clientOnly})};return function(){function n(a,i,o,s,l){var c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this.report=a,this.granularitySelection=i,this.order=o,null==s&&(s=0),this.from=s,this.size=l,this.constraints=c,this.aggregates={},this.aggregates.cell=e.keySet(this.report.aggregates.cell),this.aggregates.row=e.keySet(this.report.aggregates.row),this.aggregates.column=e.keySet(this.report.aggregates.column),this.aggregates.table=e.keySet(this.report.aggregates.table);var u,d=r(this.report.dimensions.row);(this.constraints=angular.copy(this.constraints),this.dimensions={row:(0,Tc.default)(d,t),column:(0,Tc.default)(this.report.dimensions.column,t)},a.filters)&&(u=this.constraints).push.apply(u,Mc(a.filters))}var a,i,o;return a=n,(i=[{key:"addDimension",value:function(e,r){this.dimensions[e]=this.dimensions[e].concat((0,Tc.default)([r],t))}},{key:"setOrderPeriod",value:function(e){for(var t=0;t<this.order.length;t++)this.order[t].period=e}},{key:"toParams",value:function(){var e=[];this.report.hasDateFilter()&&this.granularitySelection.period&&e.push(this.granularitySelection.getQueryPeriod());var t=(0,Tc.default)(this.constraints,function(e){return{id:e.id,type:e.type}}),r={dimensions:this.dimensions,aggregates:this.aggregates,constraints:t,order:this.order,from:this.from,size:this.size,periods:e};return null!=this.from&&(r.from=this.from),null!=this.size&&(r.size=this.size),r}}])&&Oc(a.prototype,i),o&&Oc(a,o),n}()}]);function Ac(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Pc(e,t,r){return t&&Ac(e.prototype,t),r&&Ac(e,r),e}angular.module("reports.factories").factory("ReportData",["AvailabilityService","ReportView","Router","$q",function(e,t,r,n){return function(){function a(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),this.def=e,this.period=t}return Pc(a,null,[{key:"link",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.toParams(),a="report";t&&(a+=".".concat(t));var i=r.api2Path(a);return i+=i.match(/\?/)?"&":"?",i+="params=".concat(encodeURIComponent(JSON.stringify(n)))}},{key:"get",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=new a(t);if(i.deferred,!e.available)return i.deferred.reject(),i.loading=!1,i;var o=new XMLHttpRequest;r||(o.responseType="json"),"csv"===r&&(o.responseType="blob");var s=function(e){if(i.progress)return i.progress(e)};return i.loading=!0,i.deferred=n.defer(),o.addEventListener("progress",s,!1),o.onprogress=s,o.addEventListener("load",function(e){if(s(e),200===o.status)i.table=o.response,i.deferred.resolve(o);else{i.deferred.reject(o);try{throw new Error(o.response)}catch(t){Raygun.send("Error fetching data",t)}}i.loading=!1,r||"json"===o.responseType||(i.table=JSON.parse(o.responseText)),delete i.deferred},!1),o.addEventListener("error",function(){i.deferred.reject(o),i.loading=!1},!1),o.open("get",this.link(t,r),!0),o.send(),i}}]),Pc(a,[{key:"view",value:function(e,r){return new t({title:e,data:this,period:this.period,aggregation:r})}},{key:"then",value:function(e,t){return this.deferred?this.deferred.promise.then(e,t):e(this)}}]),a}()}]);var Ec=function(e){return e&&e.__esModule?e:{default:e}}(Mo);function $c(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}angular.module("reports.factories").factory("ReportDatatable",["RequestHandler",function(e){return function(){function t(r){var n=this,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.paginated=a,this.loading=!0,this.canLoadMore=!1,this.error=!1;r.then(function(){n.data=r.table,n.noResults=!n.data||!n.data.rows||0===n.data.rows.length,n.loading=!1,n.canLoadMore=n.data&&n.data.more_results},function(){n.loading=!1,n.error=!0}),e.handle(r,{display_error:!0,error_message:"Sorry, we couldnâ€™t fetch some data. Please refresh this page and try again. <br />\nIf this problem persists please contact Vend Support."})}var r,n,a;return r=t,(n=[{key:"loadMore",value:function(e){var t=this;this.loading=!0,e.then(function(){e.table.rows.length?((0,Ec.default)(e.table.rows,function(e){t.data.rows.push(e)}),(0,Ec.default)(e.table.headers.rows,function(e){t.data.headers.rows.push(e)}),(0,Ec.default)(e.table.headers.row_ids,function(e){t.data.headers.row_ids.push(e)}),(0,Ec.default)(e.table.aggregates.row,function(e){t.data.aggregates.row.push(e)}),(0,Ec.default)(e.table.headers.row_metadata,function(e){t.data.headers.row_metadata.push(e)}),t.data.aggregates.table=e.table.aggregates.table,t.data.aggregates.column=e.table.aggregates.column,t.canLoadMore=e.table.more_results):t.canLoadMore=!1,t.noResults=!t.data,t.loading=!1})}},{key:"applyFormatterOptions",value:function(e){this.data.currency&&this.data.currency.symbol&&(e.currencySymbol=this.data.currency.symbol,this.loading=!1)}}])&&$c(r.prototype,n),a&&$c(r,a),t}()}]);var jc=Ic(ys),Fc=Ic(vo);function Ic(e){return e&&e.__esModule?e:{default:e}}function Gc(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}angular.module("reports.factories").factory("ReportDefinition",["AggregateDefinitionsService","DimensionDefinitionsService",function(e,t){return function(){function r(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.addConstraint=this.addConstraint.bind(this),this.removeConstraint=this.removeConstraint.bind(this),angular.forEach(t,function(t,r){e[r]=t}),this.dimensions||(this.dimensions={}),this.aggregates||(this.aggregates={}),this.config=(0,jc.default)(this.config||{},{showDatePicker:!0}),this.constraints||(this.constraints=[])}var n,a,i;return n=r,i=[{key:"fromJSON",value:function(n){var a={optional:[],cell:[],column:[],row:[],table:[]};angular.forEach(n.aggregates,function(t,r){t&&a[r]&&t.forEach(function(t){a[r].push(e.findByKey(t))})}),n.aggregates=a;var i={cell:[],column:[],row:[],rowOptional:[],table:[]};return angular.forEach(n.dimensions,function(e,r){i[r]&&e.forEach(function(e){return i[r].push(t.findByKey(e))})}),n.dimensions=i,new r(n)}}],(a=[{key:"addConstraint",value:function(){this.constraints.push(new Constraint)}},{key:"removeConstraint",value:function(e){return this.constraints.splice(e,1)}},{key:"aggregate",value:function(e){if(!this.aggregates.cell[e])throw Error("Aggregate.".concat(e," not included in query definition"));return this.aggregates.cell[e]}},{key:"hasDateFilter",value:function(){return(0,Fc.default)(this.config.datePicker,Boolean,!0)}},{key:"isSingleDateReport",value:function(){return Boolean(this.config.datePicker.single)}},{key:"isInventoryReport",value:function(){return"inventory"===this.type}},{key:"isPPRReport",value:function(){return"ppr"===this.key}},{key:"isAggregateSelectableReport",value:function(){return!this.allAggregates}}])&&Gc(n.prototype,a),i&&Gc(n,i),r}()}]);var Bc=Vc(Za),Nc=Vc(rl);function Vc(e){return e&&e.__esModule?e:{default:e}}function Lc(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}angular.module("reports.factories").factory("ReportQuery",["ReportData","RequestHandler","DimensionDefinitionsService",function(e,t,r){return function(){function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this.reportDefinition=e.report,this.filters=e.filters,this.order=e.order,this.granularityDateSelection=e.granularityDateSelection}var a,i,o;return a=n,(i=[{key:"run",value:function(){var r=this;return this.updatePeriodAndDateFields(),this.reportDefinition.constraints=(0,Bc.default)(this.filters),this.reportDefinition.order=this.order,this.data=e.get(this.reportDefinition.createQueryDefinition(),this.period),t.handle(this.data,{display_error:!0,error_message:"Sorry, we couldnâ€™t fetch some data. Please refresh this page and try again."}),this.data.then(function(){r.setRowDates(),r.createPivot()}),this.data}},{key:"setRowDates",value:function(){var e=["year","quarter","month","week","day","hour"];this.data.rows.forEach(function(t){e.forEach(function(e){t[e]&&(t.date=t[e])})})}},{key:"updatePeriodAndDateFields",value:function(){var e;switch(this.reportDefinition.zoom=this.granularityDateSelection.granularity.key,this.reportDefinition.dimensions.column=[],this.granularityDateSelection.granularity.key){case"year":this.reportDefinition.dimensions.column=[r.findByKey("year")],e=4;break;case"quarter":this.reportDefinition.dimensions.column=[r.findByKey("year"),r.findByKey("quarter")],e=8;break;case"month":this.reportDefinition.dimensions.column=[r.findByKey("month"),r.findByKey("year")],e=5;break;case"week":this.reportDefinition.dimensions.column=[r.findByKey("week")],e=8;break;case"day":this.reportDefinition.dimensions.column=[r.findByKey("month"),r.findByKey("day")],e=7;break;case"hour":this.reportDefinition.dimensions.column=[r.findByKey("month"),r.findByKey("day"),r.findByKey("hour")],e=8}this.granularityDateSelection.periodCount||this.granularityDateSelection.update({periodCount:e}),this.period=this.granularityDateSelection.period}},{key:"createPivot",value:function(){var e=new Nc.default,t=new Nc.default,r=new Nc.default,n=!0,a=!1,i=void 0;try{for(var o,s=this.data.rows[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var l,c,u=o.value,d={},f={},p={},v=!0,g=!1,h=void 0;try{for(var m,y=this.reportDefinition.dimensions.row[Symbol.iterator]();!(v=(m=y.next()).done);v=!0){var b=m.value;c=b.format(u),d[b.key]=c,f[b.key]=c}}catch(R){g=!0,h=R}finally{try{v||null==y.return||y.return()}finally{if(g)throw h}}var w=!0,D=!1,_=void 0;try{for(var C,S=this.reportDefinition.dimensions.column[Symbol.iterator]();!(w=(C=S.next()).done);w=!0)c=(l=C.value).format(u),d[l.key]=c,p[l.key]=c}catch(R){D=!0,_=R}finally{try{w||null==S.return||S.return()}finally{if(D)throw _}}d[l.key]=c,p[l.key]=c;var k=e.get(d);k||(e.put(d,[]),k=e.get(d)),k.push(u),0!==Object.keys(p).length&&(t.put(p,p),r.put(f,f))}}catch(R){a=!0,i=R}finally{try{n||null==s.return||s.return()}finally{if(a)throw i}}this.rowLabels=r.values(),this.colLabels=t.values(),this.pivotKeys=e}}])&&Lc(a.prototype,i),o&&Lc(a,o),n}()}]);function Uc(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}angular.module("reports.factories").factory("ReportView",["ReportDatatable",function(e){return function(){function t(r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.datatable=new e(r.data),this.period=r.period,this.aggregation=r.aggregation,this.formatter=this.aggregation.formatter,this.title=r.title}var r,n,a;return r=t,(n=[{key:"dimensions",value:function(){return this.data.def.rows.concat(this.data.def.cols)}},{key:"defaultField",value:function(){return this.dimensions()[0].name}}])&&Uc(r.prototype,n),a&&Uc(r,a),t}()}]);function qc(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}angular.module("reports.factories").factory("RequestHandler",["FlashNotification",function(e){var t=null;return function(){function r(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.promise=e,angular.extend(this.options={display_error:!1,error_message:"An error has occured.",group_time:5e3},t)}var n,a,i;return n=r,i=[{key:"handle",value:function(e,t){return new r(e,t).handle()}}],(a=[{key:"handle",value:function(){var r=this,n=null;return this.options.display_error&&(n=function(){var n=t?Date.now()-t:0;(!t||n>r.options.group_time)&&(e.display(r.options.error_message),t=Date.now())}),this.promise.then(null,n)}}])&&qc(n.prototype,a),i&&qc(n,i),r}()}]);function Kc(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}angular.module("reports.factories").factory("Router",function(){return function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,n;return t=e,n=[{key:"api2Path",value:function(e,t){return"/api/2.0/"+e+this.queryString(t)}},{key:"queryString",value:function(e){if(!e)return"";var t=[];return angular.forEach(e,function(e,r){return t.push("".concat(encodeURI(r),"=").concat(encodeURI(e)))}),"?".concat(t.join("&"))}}],(r=null)&&Kc(t.prototype,r),n&&Kc(t,n),e}()});var zc=function(e){return e&&e.__esModule?e:{default:e}}(ys);function Yc(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}angular.module("reports.factories").factory("MetricTimer",["Event",function(e){return function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.options=r,(0,zc.default)(this.options,{tags:[]}),this.options.name="frontend.".concat(e),this.startTime=moment()}var r,n,a;return r=t,(n=[{key:"end",value:function(){this.options.duration=moment().diff(this.startTime,"milliseconds"),this.options.moment=this.startTime.unix(),e.send("metrics.duration",this.options)}}])&&Yc(r.prototype,n),a&&Yc(r,a),t}()}]);var Hc=function(e){return e&&e.__esModule?e:{default:e}}(ys);function Wc(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}angular.module("reports.factories").factory("Metrics",["Event","MetricTimer",function(e,t){return function(){function r(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r)}var n,a,i;return n=r,i=[{key:"increment",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,Hc.default)(r,{tags:[],count:1}),r.name="frontend.".concat(t),r.moment=moment().unix(),e.send("metrics.increment",r)}},{key:"newTimer",value:function(e,r){return new t(e,r)}}],(a=null)&&Wc(n.prototype,a),i&&Wc(n,i),r}()}]);var Qc=function(e,t){var r=t.api2Path("store_credits?includes[]=customer"),n=t.api2Path("store_credits/report"),a=e(r),i=e(n);return{getAll:function(){return a.get().$promise.then(function(e){return e.data})},getTotals:function(){return i.get().$promise.then(function(e){return e})}}};Qc.$inject=["$resource","Router"],angular.module("reports.factories").factory("storeCreditResource",Qc);angular.module("reports.factories").factory("transformObjectToPostData",function(){var e=function e(t,r,n){if(angular.isArray(r))angular.forEach(r,function(r,a){/\[\]$/.test(t)?n(t,r):e(t+"["+a+"]",r,n)});else if(r instanceof Date)n(t,r.getTime()/1e3);else if(angular.isObject(r))for(var a in r){var i=r[a];e(t+"["+a+"]",i,n)}else n(t,r)};return function(t){t=angular.copy(t);var r={},n=function(e,t){angular.isFunction(t)||angular.isElement(t)||(r[e]=t)};if(angular.isArray(t))angular.forEach(t,function(e,t){return n(t,e)});else for(var a in t){var i=t[a];e(a,i,n)}return r}});var Xc={};Object.defineProperty(Xc,"__esModule",{value:!0}),Xc.default=void 0;var Zc=[{name:"Revenue",description:"Total income from items sold (excluding tax)",aggregate:"total_revenue",permission:null},{name:"Sale Count",description:"Number of sales in this time period",aggregate:"sale_count",permission:null},{name:"Customer Count",description:"Number of unique registered customers served in a time period",aggregate:"customer_count",permission:null},{name:"Gross Profit",description:"Total revenue less the cost of goods sold (excluding tax)",aggregate:"gross_profit",permission:"product.cost.view"},{name:"Discount",description:"Total amount discounted for this time period (excluding tax)",aggregate:"total_discount",permission:null},{name:"Discount %",description:"Discount given on total sales amount (excluding tax)",aggregate:"discount_percent",permission:null},{name:"Basket Value",description:"Average revenue per sale (excluding tax)",aggregate:"basket_value",permission:null},{name:"Basket Size",description:"Average number of items per sale",aggregate:"basket_size",permission:null}];Xc.default=Zc;var Jc=ru(oi),eu=ru(Ua),tu=ru(Xc);function ru(e){return e&&e.__esModule?e:{default:e}}function nu(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}angular.module("reports.factories").factory("UserConfig",["localStorageService","AggregateDefinitionsService","vdActiveUser",function(e,t,r){return function(){function n(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this.widgets=this.getWidgets(),this.assertValidity()}var a,i,o;return a=n,(i=[{key:"assertValidity",value:function(){var e=!0,r=!1,n=void 0;try{for(var a,i=this.getWidgets()[Symbol.iterator]();!(e=(a=i.next()).done);e=!0){var o=a.value;if(!t.findByKey(o.aggregate))return this.initWidgets(),void(this.widgets=this.getWidgets())}}catch(s){r=!0,n=s}finally{try{e||null==i.return||i.return()}finally{if(r)throw n}}}},{key:"get",value:function(t){return e.get(t)}},{key:"set",value:function(t,r){e.set(t,r)}},{key:"initWidgets",value:function(){var e=(0,Jc.default)(tu.default,function(e){return!e.permission||r.hasPermission(e.permission)});return this.set("widgets".concat(1),e),e}},{key:"getWidgets",value:function(){return this.initWidgets()}},{key:"addWidget",value:function(e){this.widgets.push(e),this.set("widgets".concat(1),this.widgets)}},{key:"removeWidget",value:function(e){(0,eu.default)(this.widgets,e),this.set("widgets".concat(1),this.widgets)}}])&&nu(a.prototype,i),o&&nu(a,o),n}()}]);angular.module("reports.filters").filter("byteSize",function(){var e=1073741824,t={0:"B",1:"KB",2:"MB",3:"GB",4:"TB"};return function(r){if(r=parseFloat(r),isNaN(r)||!isFinite(r)||0===r)return"0";var n=0;r>1099511627776?n=4:r>e?n=3:r>1048576?n=2:r>1024&&(n=1);var a,i=Math.floor(r/Math.pow(1024,n)).toString().length;a=i>3?0:3-i;var o=(r/Math.pow(1024,n)).toFixed(a);return o+=t[n]}});var au=ou(oi),iu=ou(Mo);function ou(e){return e&&e.__esModule?e:{default:e}}angular.module("reports.filters").filter("dropdownItemGroup",function(){return function(e,t){if(!t)return e;var r=[];return(0,iu.default)(e,function(e,n){var a=(0,au.default)(e,function(e){return e[t.key]===t.value});a.length&&r.push(a)}),r}});angular.module("reports.filters").filter("escape",function(){return function(e){var t=document.createElement("div");return t.innerText=e,t.innerHTML}});angular.module("reports.filters").filter("noOp",function(){return function(e){return e}});angular.module("reports.filters").filter("sentence",function(){return function(e){switch(e.length){case 0:return"";case 1:return e[0];default:return[e.slice(0,-1).join(", "),e.slice(-1)[0]].join(" and ")}}});angular.module("reports.filters").filter("upperCaseFirst",function(){return function(e){return 0===e.length?"":"".concat(e[0].toUpperCase()).concat(e.slice(1))}});var su=function(e){return e&&e.__esModule?e:{default:e}}(Za);angular.module("reports.filters").filter("variantOptions",function(){return function(e){return(0,su.default)(e,"value").join(" / ")}});var lu=1,cu=4;var uu=fu(function(e){return _c(e,lu|cu)}),du=fu(ys);function fu(e){return e&&e.__esModule?e:{default:e}}angular.module("reports.filters").filter("vendCurrency",["NumeralFormatBuilder",function(e){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=(0,uu.default)(n);(0,du.default)(a,t),a.decimalsInCurrency||(a.decimalsInCurrency=2),a.roundInput&&(r=Math.round(r));var i,o=parseInt(Math.abs(r),10).toString().length,s=o+a.decimalsInCurrency;o<a.significantFigures&&a.significantFigures<s&&(a.significantFigures=s,a.decimalPlaces=a.decimalsInCurrency),a.significantFigures&&(r=r.toPrecision(a.significantFigures)),a.hasDecimalPlaces=r%1>0,a.format?i=a.format:(i=e(a),i="($".concat(i,")"));var l=numeral(r).format(i);return a.currencySymbol&&(l=l.replace("$",a.currencySymbol)),l}}}]);var pu=function(e){return e&&e.__esModule?e:{default:e}}(ys);angular.module("reports.filters").filter("vendDate",function(){return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t<=0)return"";(0,pu.default)(r,e);var n=moment(t);return r.format||(r.format=function(e){var t=moment();return e.year()===t.year()||moment().diff(e,"months")<11?"Do MMM":"Do MMM, YYYY"}(n)),n.format(r.format)}}});angular.module("reports.filters").filter("vendGranularityDate",function(){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Do MMM YYYY";return moment(e).format(t)}});angular.module("reports.filters").filter("vendGranularityDateRange",["vendGranularityDateFilter",function(e){return function(t,r,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"-",i=e(t,n);return i!==(r=e(r,n))&&(i+=" ".concat(a,"  ").concat(r)),i}}]);var vu=function(e){return e&&e.__esModule?e:{default:e}}(ys);angular.module("reports.filters").filter("vendNumber",["NumeralFormatBuilder",function(e){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(r){var n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(a=(0,vu.default)({},a,t)).roundInput&&(r=Math.round(r)),a.significantFigures&&(r=r.toPrecision(a.significantFigures)),a.hasDecimalPlaces=r%1>0,a.min&&(null==r||r<a.min)?"":(n=a.format?a.format:e(a),numeral(r).format(n))}}}]);var gu=function(e){return e&&e.__esModule?e:{default:e}}(ys);angular.module("reports.filters").filter("vendPercent",["NumeralFormatBuilder",function(e){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,gu.default)(t,{isDecimal:!0,roundInput:!1,format:null,significantFigures:null,NaNFormat:null}),function(){var r,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,gu.default)(a,t),isNaN(n)?a.NaNFormat||"-":(a.isDecimal||(n/=100),a.roundInput&&(n=Math.round(n)),a.significantFigures&&(n=n.toPrecision(a.significantFigures)),a.format?r=a.format:(r=e(a),r="(".concat(r,"%)")),numeral(n).format(r))}}}]);angular.module("reports.filters").filter("vendSplitNumber",function(){return function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".";if(null==e&&(e=0),""===(e=e.toString()))return"";if(e.indexOf(r)<0)return e;switch(e=e.split("."),t){case"inventory_count":case"inventory_reorder_point":case"inventory_reorder_amount":case"basket_size":case"weeks_cover":case"item_count":case"item_count_monthly":case"recent_item_count":case"return_count":return e[1]<=0?"".concat(e[0],"<span class='decimals--invisible'>").concat(r).concat(e[1],"</span>"):"".concat(e[0],"<span class='decimals'>").concat(r).concat(e[1],"</span>");default:return"".concat(e[0],"<span class='decimals'>").concat(r).concat(e[1],"</span>")}}});angular.module("reports.services").service("AdvancedReportingService",["FeatureService",function(e){return{isDefinitionAccessible:function(){return!(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).isAdvanced||this.userCanAccessAdvancedReporting()},userCanAccessAdvancedReporting:function(){return Boolean(e.enabledFeatures.plan_component_pro_measures)}}}]);var hu=function(e,t){var r=e.length;for(e.sort(t);r--;)e[r]=e[r].value;return e};var mu=function(e,t){if(e!==t){var r=void 0!==e,n=null===e,a=e==e,i=Dr(e),o=void 0!==t,s=null===t,l=t==t,c=Dr(t);if(!s&&!c&&!i&&e>t||i&&o&&l&&!s&&!c||n&&o&&l||!r&&l||!a)return 1;if(!n&&!i&&!c&&e<t||c&&r&&a&&!n&&!i||s&&r&&a||!o&&a||!l)return-1}return 0};var yu=function(e,t,r){for(var n=-1,a=e.criteria,i=t.criteria,o=a.length,s=r.length;++n<o;){var l=mu(a[n],i[n]);if(l)return n>=s?l:l*("desc"==r[n]?-1:1)}return e.index-t.index};var bu=function(e,t,r){var n=-1;t=Pr(t.length?t:[Wr],Tt(Jr));var a=Xa(e,function(e,r,a){return{criteria:Pr(t,function(t){return t(e)}),index:++n,value:e}});return hu(a,function(e,t){return yu(e,t,r)})},wu=da(function(e,t){if(null==e)return[];var r=t.length;return r>1&&fa(e,t[0],t[1])?t=[]:r>2&&fa(t[0],t[1],t[2])&&(t=[t[0]]),bu(e,ko(t,1),[])});var Du=function(e){return e&&e.length?un(e):[]},_u=xu(Ia),Cu=xu(Ro),Su=xu(jo),ku=xu(Za),Ru=xu(wu),Tu=xu(Du);function xu(e){return e&&e.__esModule?e:{default:e}}angular.module("reports.services").service("AggregateDefinitionsService",function(){var e={aggregates:{},addAggregate:function(e){this.aggregates[e.key]=e},addAggregates:function(e){var t=this;angular.forEach(e,function(e){t.addAggregate(e)})},toArray:function(){return(0,Ru.default)((0,ku.default)(this.aggregates),"name")},all:function(){return this.aggregates},findByKey:function(e){return this.aggregates[e]},default:function(){return(0,_u.default)(this.aggregates,"default")||function(){throw new Error("Default aggregate not defined")}()},forReport:function(e){return this.toArray().filter(function(t){return(0,Su.default)(t.limit,e.type)>=0})},keySet:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=(0,Cu.default)(t),a=(0,ku.default)(n,"key");return(0,Tu.default)(a)}};return e});var Mu="Weâ€™re currently rebuilding our database to make it super speedy. Please bear with us, and weâ€™ll be back up soon.";angular.module("reports.services").service("AvailabilityService",["FlashNotification",function(e){return{available:!0,message:Mu}}]);var Ou=function(e){return e&&e.__esModule?e:{default:e}}(va);angular.module("reports.services").service("BootstrapService",["$rootScope","$q","$http","AggregateDefinitionsService","DimensionDefinitionsService","FeatureService","RetailerAttributeService","FilterDefinitionsService","Formatters","HiReportService","MetadataDefinitionsService","PermissionsService","ReportDefinitionsService","ReportDefinition","RequestHandler","Router","vdCurrencySettings","vdActiveUser","envService","vdTracking",function(e,t,r,n,a,i,o,s,l,c,u,d,f,p,v,g,h,m,y,b){var w=r({url:g.api2Path("reporting_bootstrap"),method:"GET"});v.handle(w);var D=t.defer();return w.then(function(t){var r=t.data;e.context=r.context,e.maxReportDurationDays=r.max_report_duration_days,e.permissions=d,e.user=r.user,e.retailer=r.retailer,i.setEnabledFeatures(r.retailer.features),o.addAttributes(r.retailer.attributes),i.enabledFeatures.historical_inventory_reports?c.fetchStartDate().then(function(e){c.setStartDate(e.data.data.created_at),D.resolve(e)},function(){return D.resolve()}):D.resolve();var v=!0,g=!1,w=void 0;try{for(var _,C=r.aggregates[Symbol.iterator]();!(v=(_=C.next()).done);v=!0){var S=_.value;S.formatter=l.named(S.formatter.name),n.addAggregate(S)}}catch(I){g=!0,w=I}finally{try{v||null==C.return||C.return()}finally{if(g)throw w}}s.addFilters(r.filters),h.update({symbol:r.retailer.currency.symbol}),a.addDimensions(r.dimensions);var k=!0,R=!1,T=void 0;try{for(var x,M=r.metadata[Symbol.iterator]();!(k=(x=M.next()).done);k=!0){var O=x.value;O.formatter=l.named(O.formatter.name),u.addMetadata(O)}}catch(I){R=!0,T=I}finally{try{k||null==M.return||M.return()}finally{if(R)throw T}}var A=!0,P=!1,E=void 0;try{for(var $,j=r.definitions[Symbol.iterator]();!(A=($=j.next()).done);A=!0){var F=$.value;F.feature&&!i.enabledFeatures[F.feature]||f.addReport(p.fromJSON(F))}}catch(I){P=!0,E=I}finally{try{A||null==j.return||j.return()}finally{if(P)throw E}}return m.init().then(function(){return t=m.get(),(0,Ou.default)(e.user,t),Raygun.setUser(e.user.id,!1,e.user&&e.user.email,e.user&&e.user.username),b.init({retailerDomainPrefix:r.retailer.domain_prefix,retailerId:r.retailer.vend_id,userId:r.user.id,systemVersion:"1.0",systemName:"Reporting",environment:y.environment,intercom:{app_id:y.isProduction?"iizsos98":"je9qpnxd"}}),void b.updateUser(t);var t}).catch(function(){return console.log("Could not load user")})}),t.all([m.init(),w,D.promise])}]);var Au=function(e){return e&&e.__esModule?e:{default:e}}(ts);angular.module("reports.services").factory("DashboardDefinitionsService",["AggregateDefinitionsService","DatatableDefinition","DimensionDefinitionsService","ReportDefinitionsService",function(e,t,r,n){var a=(0,Au.default)([e.findByKey("total_revenue"),e.findByKey("item_count"),e.findByKey("sale_count"),e.findByKey("customer_count"),e.findByKey("gross_profit"),e.findByKey("total_cost"),e.findByKey("basket_value"),e.findByKey("basket_size"),e.findByKey("total_discount"),e.findByKey("discount_percent")]),i=(0,Au.default)([e.findByKey("sale_count"),e.findByKey("item_count"),e.findByKey("total_revenue"),e.findByKey("basket_value"),e.findByKey("basket_size")]);return{outlets:function(e){var i=angular.copy(n.findByKey("outlet"));i.dimensions.column.push(r.findByKey(e.granularity.key)),i.aggregates={cell:a,column:a,row:a,table:[]};var o=[{direction:"desc",metric:"total_revenue",dimension:i.dimensions.row[0].name}];return new t({report:i,granularityDateSelection:e,order:o})},products:function(r){var a=angular.copy(n.findByKey("product"));return a.aggregates={cell:[e.findByKey("total_revenue"),e.findByKey("item_count"),e.findByKey("total_tax"),e.findByKey("total_discount"),e.findByKey("discount_percent")],row:(0,Au.default)([e.findByKey("item_count"),e.findByKey("total_discount"),e.findByKey("total_revenue")]),column:[],table:[]},a.default_order=[{dimension:"product",metric:"total_revenue",direction:"desc"}],new t({report:a,granularityDateSelection:r,filters:[],metric:e.findByKey("total_revenue")})},users:function(r){var a=angular.copy(n.findByKey("user"));return a.aggregates={cell:i,row:i,column:[],table:[]},a.default_order=[{dimension:"user",metric:"total_revenue",direction:"desc"}],new t({report:a,granularityDateSelection:r,filters:[],metric:e.findByKey("total_revenue")})}}}]);angular.module("reports.services").service("DatetimeService",function(){var e=function(e){return moment().diff(e)<0},t=function(t){return isNaN(t)||e(t)?new Date:t};return{parseKey:function(e){return t(new Date(Date.parse(e+(r=e,moment(Date.parse(r)).format("Z")))));var r},slugify:function(e){return moment(e).format("YYYY-MM-DD[T]HH[:00:00]")},afterTomorrow:function(e){return moment().diff(e,"days")<0},inFuture:e}});var Pu=function(e,t,r,n){for(var a=r-1,i=e.length;++a<i;)if(n(e[a],t))return a;return-1},Eu=Array.prototype.splice;var $u=function(e,t,r,n){var a=n?Pu:nn,i=-1,o=t.length,s=e;for(e===t&&(t=Pn(t)),r&&(s=Pr(e,Tt(r)));++i<o;)for(var l=0,c=t[i],u=r?r(c):c;(l=a(s,u,l,n))>-1;)s!==e&&Eu.call(s,l,1),Eu.call(e,l,1);return e};var ju=da(function(e,t){return e&&e.length&&t&&t.length?$u(e,t):e}),Fu=Nu(Ro),Iu=Nu(Za),Gu=Nu(ju),Bu=Nu(Du);function Nu(e){return e&&e.__esModule?e:{default:e}}angular.module("reports.services").service("DimensionDefinitionsService",function(){var e={dimensions:{},addDimension:function(e){this.dimensions[e.key]=e},addDimensions:function(e){var t=this;angular.forEach(e,function(e){t.addDimension(e)})},all:function(){return this.dimensions},findByKey:function(e){return this.dimensions[e]},keySet:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return t=(0,Fu.default)(t),(0,Iu.default)(t,"key")},typeSet:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return t=(0,Fu.default)(t),(0,Gu.default)((0,Bu.default)((0,Iu.default)(t,"type")),void 0)}};return e});angular.module("reports.services").service("DimensionUrlService",function(){return{getUrl:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(null==t)return null;switch(e){case"inventory_product":case"inventory_product_variant":case"product":case"product_variant":return"/product/".concat(t);case"customer":return"WALKIN"===r?null:"/customer/".concat(t);case"user":return"/history?user_id=".concat(t);default:return null}}}});angular.module("reports.services").service("DisplayWidthService",["$window",function(e){var t={};return t.isSmall=function(){return e.innerWidth<640},t.isMedium=function(){var t=e.innerWidth;return t>641&&t<1024},t.isLarge=function(){return e.innerWidth>1025},t.lessThan=function(t){return e.innerWidth<t},t.greaterThan=function(t){return e.innerWidth>t},t}]);angular.module("reports.services").service("envService",function(){var e=(window?window.location.hostname:void 0).split("."),t=e[e.length-1],r={ENVS:{DEVELOPMENT:"dev",PRODUCTION:"prod"}},n=function(){return"com"===t?r.ENVS.PRODUCTION:r.ENVS.DEVELOPMENT};return{environment:n(),isDev:n()===r.ENVS.DEVELOPMENT,isProduction:n()===r.ENVS.PRODUCTION}});var Vu=function(e){return e&&e.__esModule?e:{default:e}}(Uo);angular.module("reports.services").service("FeatureService",function(){var e={enabledFeatures:{},setEnabledFeatures:function(t){return(0,Vu.default)(t,function(t,r){t&&(e.enabledFeatures[r]=!0)})}};return e});var Lu=zu(oi),Uu=zu(jo),qu=zu(Za),Ku=zu(wu);function zu(e){return e&&e.__esModule?e:{default:e}}angular.module("reports.services").service("FilterDefinitionsService",function(){return{filters:{},addFilter:function(e){this.filters[e.key]=e},addFilters:function(e){var t=this;return e.map(function(e){return t.addFilter(e)})},toArray:function(){return(0,Ku.default)((0,qu.default)(this.filters),"name")},limit:function(e){return(0,Lu.default)(this.toArray(),function(t){return(0,Uu.default)(t.limit,e.type)>=0})},findByKey:function(e){return this.filters[e]}}});angular.module("reports.services").service("GiftCardStatusService",["$http","$q","RequestHandler","Router",function(e,t,r,n){var a={activated:null,retrieveGiftCardStatus:function(){if(null!==a.activated)return t.resolve();var i=t.defer(),o=e({url:n.api2Path("balances/gift_cards/retailer/status"),method:"GET"});return r.handle(o),o.then(function(e){200!==e.status?a.activated=!1:a.activated=Boolean(e.data&&("ACTIVE"===e.data.status||e.data.activation_date)),i.resolve()}).catch(function(){a.activated=!1,i.resolve()}),i.promise}};return a}]);var Yu=function(e,t,r){var n;return r(e,function(e,r,a){if(t(e,r,a))return n=r,!1}),n};var Hu=function(e,t){return Yu(e,Jr(t,3),Wa)},Wu=Ju(Ia),Qu=Ju(Hu),Xu=Ju(Za),Zu=Ju(ds);function Ju(e){return e&&e.__esModule?e:{default:e}}angular.module("reports.services").service("GranularityDefinitionsService",["OrderedHash",function(e){var t={granularities:new e,addGranularity:function(e){this.granularities.push(e.key,e)},addGranularities:function(e){var t=this;angular.forEach(e,function(e){t.addGranularity(e)})},all:function(){return(0,Xu.default)(this.granularities.array(),"val")},findByKey:function(e){return(0,Wu.default)(this.granularities.vals(),{key:e})||this.default()},findKey:function(e){return(0,Qu.default)(this.granularities,e)},default:function(){return(0,Wu.default)(this.granularities.vals(),"default")||function(){throw new Error("Default granularity not defined")}()}};return t.addGranularities(Zu.default),t}]);angular.module("reports.services").service("HiReportService",["$http","Router",function(e,t){var r=moment("2017-03-31 00:00:00"),n={startDate:r.toDate(),fetchStartDate:function(){return e({url:t.api2Path("inventory_retailer")})},setStartDate:function(e){var t=moment(e);t.isBefore(r)&&(t=r),n.startDate=t.toDate()}};return n}]);var ed=Math.min;var td=function(e,t,r){for(var n=r?on:an,a=e[0].length,i=e.length,o=i,s=Array(i),l=1/0,c=[];o--;){var u=e[o];o&&t&&(u=Pr(u,Tt(t))),l=ed(u.length,l),s[o]=!r&&(t||a>=120&&u.length>=120)?new Te(o&&u):void 0}u=e[0];var d=-1,f=s[0];e:for(;++d<a&&c.length<l;){var p=u[d],v=t?t(p):p;if(p=r||0!==p?p:0,!(f?Me(f,v):n(c,v,r))){for(o=i;--o;){var g=s[o];if(!(g?Me(g,v):n(e[o],v,r)))continue e}f&&f.push(v),c.push(p)}}return c};var rd=function(e){return In(e)?e:[]},nd=da(function(e){var t=Pr(e,rd);return t.length&&t[0]===e[0]?td(t):[]}),ad=ud(oi),id=ud(Ia),od=ud(Ro),sd=ud(nd),ld=ud(Za),cd=ud(Du);function ud(e){return e&&e.__esModule?e:{default:e}}angular.module("reports.services").service("MetadataDefinitionsService",function(){var e={metadata:{},addMetadata:function(e){this.metadata[e.key]=e},addMetadataCollection:function(e){var t=this;angular.forEach(e,function(e){t.addMetadata(e)})},all:function(){return this.metadata},findByKey:function(e){return(0,ad.default)(this.metadata,function(t){return new RegExp(t.key+"$").test(e)})[0]},default:function(){return(0,id.default)(this.metadata,"default")||function(){throw new Error("Default metadata not defined")}()},requiredForReport:function(e){var t=(0,ld.default)(e.dimensions.row,"key");return(0,ad.default)(this.metadata,function(e){return!!e.required&&(0,sd.default)(t,e.dimension_keys).length})},forReport:function(e){var t=(0,ld.default)(e.dimensions.row,"key");return(0,ad.default)(this.metadata,function(e){return!e.required&&(0,sd.default)(t,e.dimension_keys).length})},keySet:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=(0,od.default)(t),a=(0,ld.default)(n,"key");return(0,cd.default)(a)}};return e});angular.module("reports.services").service("PermissionsService",["$rootScope","FeatureService",function(e,t){return{canAccessDashboard:function(){return Boolean(t.enabledFeatures.plan_component_retail_dashboard)},canViewDashboard:function(){return["manager","admin"].indexOf(e.user.permission_level)>=0},isTrialAccount:function(){return"trialing"===e.retailer.state}}}]);var dd=vd(Ia),fd=vd(Za),pd=vd(wu);function vd(e){return e&&e.__esModule?e:{default:e}}angular.module("reports.services").service("ReportDefinitionsService",function(){var e={reports:{},addReport:function(e){this.reports[e.key]=e},addReports:function(e){var t=this;angular.forEach(e,function(e){t.addReport(e)})},toArray:function(){return(0,pd.default)((0,fd.default)(this.reports),"name")},all:function(){return this.reports},findByKey:function(e){return this.reports[e]||this.default()},default:function(){return(0,dd.default)(this.reports,"default")||function(){throw new Error("Default report not defined")}()}};return e});angular.module("reports.services").service("ReportOptionsService",["DimensionDefinitionsService","GiftCardStatusService",function(e,t){var r={},n={},a={showInactiveProducts:{key:"showInactiveProducts",label:"Show inactive inventory",value:!1,summary:{true:"inactive products are shown",false:"inactive products are hidden"}},groupVariants:{key:"groupVariants",label:"Show variants grouped",value:!1,summary:{true:"variants are grouped",false:"variants are individually listed"}},includeGiftCards:{key:"includeGiftCards",label:"Include Gift Card Sales",value:!1,summary:{true:"gift card sales are included",false:"gift card sales are not included"}}},i=function(t){!0!==t.includeProducts?e.typeSet(t.report.dimensions.row).includes("product")&&(n.groupVariants=a.groupVariants):n.groupVariants=a.groupVariants},o=function(e){"inventory"===e.report.type&&(n.showInactiveProducts=a.showInactiveProducts)},s=function(e){t.activated&&"item"===e.report.type&&(n.includeGiftCards=a.includeGiftCards)};return r.availableOptions=function(e){n={};for(var t=0,r=[i,o,s];t<r.length;t++){(0,r[t])(e)}return n},r.dehydrateOptions=function(e){var t={};for(var r in e){var n=e[r];t[r]=n.value}return t},r.hydrateOptions=function(e){var t={};for(var r in e){var n=e[r],i=a[r];i.value=n,t[r]=i}return t},r}]);var gd="[object Map]",hd="[object Set]",md=Object.prototype.hasOwnProperty;var yd=Dd(function(e){if(null==e)return!0;if(Ut(e)&&(Je(e)||"string"==typeof e||"function"==typeof e.splice||gt(e)||$t(e)||pt(e)))return!e.length;var t=ir(e);if(t==gd||t==hd)return!e.size;if(Gt(e))return!Lt(e).length;for(var r in e)if(md.call(e,r))return!1;return!0}),bd=Dd(Za),wd=Dd(us);function Dd(e){return e&&e.__esModule?e:{default:e}}angular.module("reports.services").service("ReportRouteService",["$state","AggregateDefinitionsService","DatatableDefinition","DatetimeService","FilterTag","GranularityDefinitionsService","GranularityDateSelection","Metrics","OrderRule","ReportDefinitionsService","ReportOptionsService","PersistedOptions","AdvancedReportingService","FlashNotification",function(e,t,r,n,a,i,o,s,l,c,u,d,f,p){return{update:function(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.toParams(t);e.go("reports.show",{slug:t.report.key,definition:JSON.stringify(n)},{reload:!0,notify:r})},toParams:function(e){var t={metric:e.metric&&e.metric.key,constraints:(0,bd.default)(e.filters,function(e){return{id:e.id,name:e.name,type:e.type}}),granularity:e.granularityDateSelection.granularity.key,periodType:e.granularityDateSelection.periodType,periodCount:e.granularityDateSelection.periodCount,order:e.order,includeProducts:e.includeProducts,options:u.dehydrateOptions(e.options),dimensionMetadata:e.dimensionMetadata,optionalAggregates:e.optionalAggregates};return"all"!==t.periodType&&(t.selectedDate=n.slugify(e.granularityDateSelection.getSelectedDate()),t.startDate=n.slugify(e.granularityDateSelection.getPeriodStartDate()),t.endDate=n.slugify(e.granularityDateSelection.getPeriodEndDate())),t},fromRouteParams:function(e){var v,g,h,m;if(null===e.definition)v={};else if(m=[],(v=JSON.parse(e.definition)).constraints){var y=!0,b=!1,w=void 0;try{for(var D,_=v.constraints[Symbol.iterator]();!(y=(D=_.next()).done);y=!0){var C=D.value,S=new a(C);m.push(S)}}catch(N){b=!0,w=N}finally{try{y||null==_.return||_.return()}finally{if(b)throw w}}}var k=c.findByKey(e.slug),R=k.config.datePicker.minDate,T=new o({selectedDate:n.parseKey(v.selectedDate),startDate:v.startDate,endDate:v.endDate,minDate:R?moment(R).toDate():void 0,granularity:i.findByKey(v.granularity),periodType:v.periodType,periodCount:(0,wd.default)(v.periodCount)}),x=new d,M=v.dimensionMetadata||x.getDatatableOption("metadata"),O=v.optionalAggregates||x.getDatatableOption("optionalAggregates"),A=!1,P=t.findByKey(v.metric),E=x.getOption("groupVariants");(0,yd.default)(E)||(x.removeOption("groupVariants"),g=x.getOption("reportOptions"),u.hydrateOptions(g),g.groupVariants=E,u.dehydrateOptions(g),v.options=g,s.increment("legacy_group_variants_transitioned")),v.options?(g=v.options,x.setOption("reportOptions",v.options)):g=x.getOption("reportOptions");if(v.order){h=[];var $=!0,j=!1,F=void 0;try{for(var I,G=v.order[Symbol.iterator]();!($=(I=G.next()).done);$=!0){var B=I.value;h.push(new l(B))}}catch(N){j=!0,F=N}finally{try{$||null==G.return||G.return()}finally{if(j)throw F}}}return f.isDefinitionAccessible(k)||(k=c.default(),A=!0),f.isDefinitionAccessible(P)||(P=t.default(),A=!0),A&&p.display("Sorry that combination of report and measure is only available on an Advanced plan."),v=new r({dimensionMetadata:M,optionalAggregates:O,filters:m,granularityDateSelection:T,includeProducts:v.includeProducts||!1,metric:P,order:h,report:k,options:u.hydrateOptions(g)})}}}]);var _d=function(e){return e&&e.__esModule?e:{default:e}}(Uo);angular.module("reports.services").service("RetailerAttributeService",function(){var e={attributes:{},addAttributes:function(t){return(0,_d.default)(t||{},function(t,r){e.attributes[r]=t})}};return e})}();
//# sourceMappingURL=maps/analytics-2e059e4d.js.map
